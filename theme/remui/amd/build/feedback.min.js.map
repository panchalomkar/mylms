{"version":3,"file":"feedback.min.js","sources":["../src/feedback.js"],"sourcesContent":["/* eslint-disable no-undef */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/feedback\n * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\"jquery\", \"core/ajax\"], function($, Ajax) {\n    $.feedback = function(options) {\n        var settings = $.extend(\n            {\n                ajaxURL: \"\",\n                postBrowserInfo: true,\n                postHTML: true,\n                postURL: true,\n                proxy: undefined,\n                letterRendering: false,\n                initButtonText: \"Send feedback\",\n                strokeStyle: \"black\",\n                shadowColor: \"black\",\n                shadowOffsetX: 1,\n                shadowOffsetY: 1,\n                shadowBlur: 10,\n                lineJoin: \"bevel\",\n                lineWidth: 3,\n                html2canvasURL: \"html2canvas.js\",\n                feedbackButton: \".feedback-btn\",\n                showDescriptionModal: true,\n                isDraggable: true,\n                onScreenshotTaken: function() { },\n                tpl: {\n                    description:\n                        '<div id=\"feedback-welcome\"><div class=\"feedback-logo\">Feedback</div><p>Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.</p><p>Start by writing a brief description:</p><textarea id=\"feedback-note-tmp\"></textarea><p>Next we\\'ll let you identify areas of the page related to your description.</p><button id=\"feedback-welcome-next\" class=\"feedback-next-btn feedback-btn-gray\">Next</button><div id=\"feedback-welcome-error\">Please enter a description.</div><div class=\"feedback-wizard-close\"></div></div>',\n                    highlighter:\n                        '<div id=\"feedback-highlighter\"><div class=\"feedback-logo\">Feedback</div><p>Click and drag on the page to help us better understand your feedback. You can move this dialog if it\\'s in the way.</p><button class=\"feedback-sethighlight feedback-active\"><div class=\"ico\"></div><span>Highlight</span></button><label>Highlight areas relevant to your feedback.</label><button class=\"feedback-setblackout\"><div class=\"ico\"></div><span>Black out</span></button><label class=\"lower\">Black out any personal information.</label><div class=\"feedback-buttons\"><button id=\"feedback-highlighter-next\" class=\"feedback-next-btn feedback-btn-gray\">Next</button><button id=\"feedback-highlighter-back\" class=\"feedback-back-btn feedback-btn-gray\">Back</button></div><div class=\"feedback-wizard-close\"></div></div>',\n                    overview:\n                        '<div id=\"feedback-overview\"><div class=\"feedback-logo\">Feedback</div><div id=\"feedback-overview-description\"><div id=\"feedback-overview-description-text\"><h3>Description</h3><h3 class=\"feedback-additional\">Additional info</h3><div id=\"feedback-additional-none\"><span>None</span></div><div id=\"feedback-browser-info\"><span>Browser Info</span></div><div id=\"feedback-page-info\"><span>Page Info</span></div><div id=\"feedback-page-structure\"><span>Page Structure</span></div></div></div><div id=\"feedback-overview-screenshot\"><h3>Screenshot</h3></div><div class=\"feedback-buttons\"><button id=\"feedback-submit\" class=\"feedback-submit-btn feedback-btn-blue\">Submit</button><button id=\"feedback-overview-back\" class=\"feedback-back-btn feedback-btn-gray\">Back</button></div><div id=\"feedback-overview-error\">Please enter a description.</div><div class=\"feedback-wizard-close\"></div></div>',\n                    submitLoading:\n                        '<div id=\"feedback-submit-loading\"><div class=\"feedback-logo\">Feedback</div><p>Loading...</p></div>',\n                    submitSuccess:\n                        '<div id=\"feedback-submit-success\"><div class=\"feedback-logo\">Feedback</div><p>Thank you for your feedback. We value every piece of feedback we receive.</p></p><button class=\"feedback-close-btn feedback-btn-blue\">OK</button><div class=\"feedback-wizard-close\"></div></div>',\n                    submitError:\n                        '<div id=\"feedback-submit-error\"><div class=\"feedback-logo\">Feedback</div><p>Sadly an error occured while sending your feedback. Please try again.</p><button class=\"feedback-close-btn feedback-btn-blue\">OK</button><div class=\"feedback-wizard-close\"></div></div>',\n                },\n                onClose: function() { },\n                onTrigger: function() { },\n                screenshotStroke: true,\n                highlightElement: true,\n                initialBox: false,\n            },\n            options\n        );\n        var supportedBrowser = !!window.HTMLCanvasElement;\n        var isFeedbackButtonNative = settings.feedbackButton == \".feedback-btn\";\n        var _html2canvas = false;\n        if (supportedBrowser) {\n            if (isFeedbackButtonNative) {\n                $(\"body\").append(\n                    '<button class=\"feedback-btn feedback-btn-gray feedback-btn-native\">' +\n                    settings.initButtonText +\n                    \"</button>\"\n                );\n            }\n            $(document).on(\"click.feedback\", settings.feedbackButton, function() {\n                settings.onTrigger.call(this);\n                if (isFeedbackButtonNative) {\n                    $(this).hide();\n                }\n                if (!_html2canvas) {\n                    $.getScript(settings.html2canvasURL, function() {\n                        _html2canvas = true;\n                    });\n                }\n                var canDraw = false,\n                    img = \"\",\n                    h = $(document).height(),\n                    w = $(document).width(),\n                    tpl = '<div id=\"feedback-module\">';\n\n                if (settings.initialBox) {\n                    tpl += settings.tpl.description;\n                }\n\n                tpl +=\n                    settings.tpl.highlighter +\n                    settings.tpl.overview +\n                    '<canvas id=\"feedback-canvas\"></canvas><div id=\"feedback-helpers\"></div><input id=\"feedback-note\" name=\"feedback-note\" type=\"hidden\"></div>';\n\n                $(\"body\").append(tpl);\n\n                var moduleStyle = {\n                    position: \"absolute\",\n                    left: \"0px\",\n                    top: \"0px\",\n                };\n                var canvasAttr = {\n                    width: w,\n                    height: h,\n                };\n\n                $(\"#feedback-module\").css(moduleStyle);\n                $(\"#feedback-canvas\").attr(canvasAttr).css(\"z-index\", \"30000\");\n\n                if (!settings.initialBox) {\n                    $(\"#feedback-highlighter-back\").remove();\n                    canDraw = true;\n                    $(\"#feedback-canvas\").css(\"cursor\", \"crosshair\");\n                    $(\"#feedback-helpers\").show();\n                    $(\"#feedback-welcome\").hide();\n                    $(\"#feedback-highlighter\").show();\n                }\n\n                if (settings.isDraggable) {\n                    $(\"#feedback-highlighter\")\n                        .on(\"mousedown.feedback\", function(e) {\n                            var $d = $(this).addClass(\"feedback-draggable\"),\n                                drag_h = $d.outerHeight(),\n                                drag_w = $d.outerWidth(),\n                                pos_y = $d.offset().top + drag_h - e.pageY,\n                                pos_x = $d.offset().left + drag_w - e.pageX;\n                            $d.css(\"z-index\", 40000)\n                                .parents()\n                                .on(\"mousemove.feedback\", function(e) {\n                                    _top = e.pageY + pos_y - drag_h;\n                                    _left = e.pageX + pos_x - drag_w;\n                                    _bottom = drag_h - e.pageY;\n                                    _right = drag_w - e.pageX;\n\n                                    if (_left < 0) {\n                                        _left = 0;\n                                    }\n                                    if (_top < 0) {\n                                        _top = 0;\n                                    }\n                                    if (_right > $(window).width()) {\n                                        _left = $(window).width() - drag_w;\n                                    }\n                                    if (_left > $(window).width() - drag_w) {\n                                        _left = $(window).width() - drag_w;\n                                    }\n                                    if (_bottom > $(document).height()) {\n                                        _top = $(document).height() - drag_h;\n                                    }\n                                    if (_top > $(document).height() - drag_h) {\n                                        _top = $(document).height() - drag_h;\n                                    }\n\n                                    $(\".feedback-draggable\")\n                                        .offset({\n                                            top: _top,\n                                            left: _left,\n                                        })\n                                        .on(\"mouseup\", function() {\n                                            $(this).removeClass(\"feedback-draggable\");\n                                        });\n                                });\n                            e.preventDefault();\n                        })\n                        .on(\"mouseup.feedback\", function() {\n                            $(this).removeClass(\"feedback-draggable\");\n                            $(this).parents().off(\"mousemove mousedown\");\n                        });\n                }\n\n                var ctx = $(\"#feedback-canvas\")[0].getContext(\"2d\");\n\n                ctx.fillStyle = \"rgba(102,102,102,0.5)\";\n                ctx.fillRect(\n                    0,\n                    0,\n                    $(\"#feedback-canvas\").width(),\n                    $(\"#feedback-canvas\").height()\n                );\n\n                rect = {};\n                drag = false;\n                highlight = 0; // Made it 0 so default is blackout - remui\n                post = {};\n\n                if (settings.postBrowserInfo) {\n                    post.browser = {};\n                    post.browser.appCodeName = navigator.appCodeName;\n                    post.browser.appName = navigator.appName;\n                    post.browser.appVersion = navigator.appVersion;\n                    post.browser.cookieEnabled = navigator.cookieEnabled;\n                    post.browser.onLine = navigator.onLine;\n                    post.browser.platform = navigator.platform;\n                    post.browser.userAgent = navigator.userAgent;\n                    post.browser.plugins = [];\n\n                    $.each(navigator.plugins, function(i) {\n                        post.browser.plugins.push(navigator.plugins[i].name);\n                    });\n                    $(\"#feedback-browser-info\").show();\n                }\n\n                if (settings.postURL) {\n                    post.url = document.URL;\n                    $(\"#feedback-page-info\").show();\n                }\n\n                if (settings.postHTML) {\n                    post.html = $(\"html\").html();\n                    $(\"#feedback-page-structure\").show();\n                }\n\n                if (\n                    !settings.postBrowserInfo &&\n                    !settings.postURL &&\n                    !settings.postHTML\n                ) {\n                    $(\"#feedback-additional-none\").show();\n                }\n\n                // // We can add the extra data\n                // $(document).ready(function(){\n                //     var serviceName = 'theme_remui_handle_bug_feedback_report';\n                //     var getusagedata = Ajax.call([{\n                //         methodname: serviceName,\n                //         args: {}\n                //     }]);\n                //     getusagedata[0].done(function(response) {\n                //         response = JSON.parse(response);\n                //         post.siteurl = response.siteurl;\n                //         delete response.siteurl;\n\n                //         post.databasename = response.databasename;\n                //         delete response.databasename;\n\n                //         post.php = response.php_version;\n                //         delete response.php_version;\n\n                //         post.web_server = response.web_server;\n                //         delete response.web_server;\n\n                //         post.server_os = response.server_os;\n                //         delete response.server_os;\n\n                //         post.system_version = response.system_version;\n                //         delete response.system_version;\n                //     }).fail(Notification.exception);\n                // });\n\n                $(document).on(\"mousedown.feedback\", \"#feedback-canvas\", function(e) {\n                    if (canDraw) {\n                        rect.startX = e.pageX - $(this).offset().left;\n                        rect.startY = e.pageY - $(this).offset().top;\n                        rect.w = 0;\n                        rect.h = 0;\n                        drag = true;\n                    }\n                });\n\n                $(document).on(\"mouseup.feedback\", function() {\n                    if (canDraw) {\n                        drag = false;\n\n                        var dtop = rect.startY,\n                            dleft = rect.startX,\n                            dwidth = rect.w,\n                            dheight = rect.h;\n                        dtype = \"highlight\";\n\n                        if (dwidth == 0 || dheight == 0) {\n                            return;\n                        }\n\n                        if (dwidth < 0) {\n                            dleft += dwidth;\n                            dwidth *= -1;\n                        }\n                        if (dheight < 0) {\n                            dtop += dheight;\n                            dheight *= -1;\n                        }\n\n                        if (dtop + dheight > $(document).height()) {\n                            dheight = $(document).height() - dtop;\n                        }\n                        if (dleft + dwidth > $(document).width()) {\n                            dwidth = $(document).width() - dleft;\n                        }\n\n                        if (highlight == 0) {\n                            dtype = \"blackout\";\n                        }\n\n                        $(\"#feedback-helpers\").append(\n                            '<div class=\"feedback-helper\" data-type=\"' +\n                            dtype +\n                            '\" data-time=\"' +\n                            Date.now() +\n                            '\" style=\"position:absolute;top:' +\n                            dtop +\n                            \"px;left:\" +\n                            dleft +\n                            \"px;width:\" +\n                            dwidth +\n                            \"px;height:\" +\n                            dheight +\n                            'px;z-index:30000;\"></div>'\n                        );\n\n                        redraw(ctx);\n                        rect.w = 0;\n                    }\n                });\n\n                $(document).on(\"mousemove.feedback\", function(e) {\n                    if (canDraw && drag) {\n                        $(\"#feedback-highlighter\").css(\"cursor\", \"default\");\n\n                        rect.w =\n                            e.pageX - $(\"#feedback-canvas\").offset().left - rect.startX;\n                        rect.h = e.pageY - $(\"#feedback-canvas\").offset().top - rect.startY;\n\n                        ctx.clearRect(\n                            0,\n                            0,\n                            $(\"#feedback-canvas\").width(),\n                            $(\"#feedback-canvas\").height()\n                        );\n                        ctx.fillStyle = \"rgba(102,102,102,0.5)\";\n                        ctx.fillRect(\n                            0,\n                            0,\n                            $(\"#feedback-canvas\").width(),\n                            $(\"#feedback-canvas\").height()\n                        );\n                        $(\".feedback-helper\").each(function() {\n                            if ($(this).attr(\"data-type\") == \"highlight\") {\n                                drawlines(\n                                    ctx,\n                                    parseInt($(this).css(\"left\"), 10),\n                                    parseInt($(this).css(\"top\"), 10),\n                                    $(this).width(),\n                                    $(this).height()\n                                );\n                            }\n                        });\n                        if (highlight == 1) {\n                            drawlines(ctx, rect.startX, rect.startY, rect.w, rect.h);\n                            ctx.clearRect(rect.startX, rect.startY, rect.w, rect.h);\n                        }\n                        $(\".feedback-helper\").each(function() {\n                            if ($(this).attr(\"data-type\") == \"highlight\") {\n                                ctx.clearRect(\n                                    parseInt($(this).css(\"left\"), 10),\n                                    parseInt($(this).css(\"top\"), 10),\n                                    $(this).width(),\n                                    $(this).height()\n                                );\n                            }\n                        });\n                        $(\".feedback-helper\").each(function() {\n                            if ($(this).attr(\"data-type\") == \"blackout\") {\n                                ctx.fillStyle = \"rgba(0,0,0,1)\";\n                                ctx.fillRect(\n                                    parseInt($(this).css(\"left\"), 10),\n                                    parseInt($(this).css(\"top\"), 10),\n                                    $(this).width(),\n                                    $(this).height()\n                                );\n                            }\n                        });\n                        if (highlight == 0) {\n                            ctx.fillStyle = \"rgba(0,0,0,0.5)\";\n                            ctx.fillRect(rect.startX, rect.startY, rect.w, rect.h);\n                        }\n                    }\n                });\n\n                if (settings.highlightElement) {\n                    var highlighted = [],\n                        tmpHighlighted = [],\n                        hidx = 0;\n\n                    $(document).on(\"click.feedback\", \"#feedback-canvas\", function(e) {\n                        if (canDraw) {\n                            redraw(ctx);\n                            tmpHighlighted = [];\n\n                            $(\"#feedback-canvas\").css(\"cursor\", \"crosshair\");\n\n                            $(\n                                \"* :not(body,script,iframe,div,section,.feedback-btn,#feedback-module *)\"\n                            ).each(function() {\n                                if ($(this).attr(\"data-highlighted\") === \"true\") {\n                                    return;\n                                }\n\n                                if (\n                                    e.pageX > $(this).offset().left &&\n                                    e.pageX < $(this).offset().left + $(this).width() &&\n                                    e.pageY >\n                                    $(this).offset().top +\n                                    parseInt($(this).css(\"padding-top\"), 10) &&\n                                    e.pageY <\n                                    $(this).offset().top +\n                                    $(this).height() +\n                                    parseInt($(this).css(\"padding-top\"), 10)\n                                ) {\n                                    tmpHighlighted.push($(this));\n                                }\n                            });\n\n                            var $toHighlight = tmpHighlighted[tmpHighlighted.length - 1];\n\n                            if ($toHighlight && !drag) {\n                                $(\"#feedback-canvas\").css(\"cursor\", \"pointer\");\n\n                                var _x = $toHighlight.offset().left - 2,\n                                    _y = $toHighlight.offset().top - 2,\n                                    _w =\n                                        $toHighlight.width() +\n                                        parseInt($toHighlight.css(\"padding-left\"), 10) +\n                                        parseInt($toHighlight.css(\"padding-right\"), 10) +\n                                        6,\n                                    _h =\n                                        $toHighlight.height() +\n                                        parseInt($toHighlight.css(\"padding-top\"), 10) +\n                                        parseInt($toHighlight.css(\"padding-bottom\"), 10) +\n                                        6;\n\n                                if (highlight == 1) {\n                                    drawlines(ctx, _x, _y, _w, _h);\n                                    ctx.clearRect(_x, _y, _w, _h);\n                                    dtype = \"highlight\";\n                                }\n\n                                $(\".feedback-helper\").each(function() {\n                                    if ($(this).attr(\"data-type\") == \"highlight\") {\n                                        ctx.clearRect(\n                                            parseInt($(this).css(\"left\"), 10),\n                                            parseInt($(this).css(\"top\"), 10),\n                                            $(this).width(),\n                                            $(this).height()\n                                        );\n                                    }\n                                });\n\n                                if (highlight == 0) {\n                                    dtype = \"blackout\";\n                                    ctx.fillStyle = \"rgba(0,0,0,0.5)\";\n                                    ctx.fillRect(_x, _y, _w, _h);\n                                }\n\n                                $(\".feedback-helper\").each(function() {\n                                    if ($(this).attr(\"data-type\") == \"blackout\") {\n                                        ctx.fillStyle = \"rgba(0,0,0,1)\";\n                                        ctx.fillRect(\n                                            parseInt($(this).css(\"left\"), 10),\n                                            parseInt($(this).css(\"top\"), 10),\n                                            $(this).width(),\n                                            $(this).height()\n                                        );\n                                    }\n                                });\n\n                                if (\n                                    e.type == \"click\" &&\n                                    e.pageX == rect.startX &&\n                                    e.pageY == rect.startY\n                                ) {\n                                    $(\"#feedback-helpers\").append(\n                                        '<div class=\"feedback-helper\" data-highlight-id=\"' +\n                                        hidx +\n                                        '\" data-type=\"' +\n                                        dtype +\n                                        '\" data-time=\"' +\n                                        Date.now() +\n                                        '\" style=\"position:absolute;top:' +\n                                        _y +\n                                        \"px;left:\" +\n                                        _x +\n                                        \"px;width:\" +\n                                        _w +\n                                        \"px;height:\" +\n                                        _h +\n                                        'px;z-index:30000;\"></div>'\n                                    );\n                                    highlighted.push(hidx);\n                                    ++hidx;\n                                    redraw(ctx);\n                                }\n                            }\n                        }\n                    });\n                }\n\n                $(document).on(\n                    \"mouseleave.feedback\",\n                    \"body,#feedback-canvas\",\n                    function() {\n                        redraw(ctx);\n                    }\n                );\n\n                $(document).on(\"mouseenter.feedback\", \".feedback-helper\", function() {\n                    redraw(ctx);\n                });\n\n                $(document).on(\"click.feedback\", \"#feedback-welcome-next\", function() {\n                    if ($(\"#feedback-note\").val().length > 0) {\n                        canDraw = true;\n                        $(\"#feedback-canvas\").css(\"cursor\", \"crosshair\");\n                        $(\"#feedback-helpers\").show();\n                        $(\"#feedback-welcome\").hide();\n                        $(\"#feedback-highlighter\").show();\n                    } else {\n                        $(\"#feedback-welcome-error\").show();\n                    }\n                });\n\n                $(document).on(\n                    \"mouseenter.feedback mouseleave.feedback\",\n                    \".feedback-helper\",\n                    function(e) {\n                        if (drag) {\n                            return;\n                        }\n\n                        rect.w = 0;\n                        rect.h = 0;\n\n                        if (e.type === \"mouseenter\") {\n                            $(this).css(\"z-index\", \"30001\");\n                            $(this).append(\n                                '<div class=\"feedback-helper-inner\" style=\"width:' +\n                                ($(this).width() - 2) +\n                                \"px;height:\" +\n                                ($(this).height() - 2) +\n                                'px;position:absolute;margin:1px;\"></div>'\n                            );\n                            $(this).append('<div id=\"feedback-close\"></div>');\n                            $(this)\n                                .find(\"#feedback-close\")\n                                .css({\n                                    top:\n                                        -1 * ($(this).find(\"#feedback-close\").height() / 2) + \"px\",\n                                    left:\n                                        $(this).width() -\n                                        $(this).find(\"#feedback-close\").width() / 2 +\n                                        \"px\",\n                                });\n\n                            if ($(this).attr(\"data-type\") == \"blackout\") {\n                                /* Redraw white */\n                                ctx.clearRect(\n                                    0,\n                                    0,\n                                    $(\"#feedback-canvas\").width(),\n                                    $(\"#feedback-canvas\").height()\n                                );\n                                ctx.fillStyle = \"rgba(102,102,102,0.5)\";\n                                ctx.fillRect(\n                                    0,\n                                    0,\n                                    $(\"#feedback-canvas\").width(),\n                                    $(\"#feedback-canvas\").height()\n                                );\n                                $(\".feedback-helper\").each(function() {\n                                    if ($(this).attr(\"data-type\") == \"highlight\") {\n                                        drawlines(\n                                            ctx,\n                                            parseInt($(this).css(\"left\"), 10),\n                                            parseInt($(this).css(\"top\"), 10),\n                                            $(this).width(),\n                                            $(this).height()\n                                        );\n                                    }\n                                });\n                                $(\".feedback-helper\").each(function() {\n                                    if ($(this).attr(\"data-type\") == \"highlight\") {\n                                        ctx.clearRect(\n                                            parseInt($(this).css(\"left\"), 10),\n                                            parseInt($(this).css(\"top\"), 10),\n                                            $(this).width(),\n                                            $(this).height()\n                                        );\n                                    }\n                                });\n\n                                ctx.clearRect(\n                                    parseInt($(this).css(\"left\"), 10),\n                                    parseInt($(this).css(\"top\"), 10),\n                                    $(this).width(),\n                                    $(this).height()\n                                );\n                                ctx.fillStyle = \"rgba(0,0,0,0.75)\";\n                                ctx.fillRect(\n                                    parseInt($(this).css(\"left\"), 10),\n                                    parseInt($(this).css(\"top\"), 10),\n                                    $(this).width(),\n                                    $(this).height()\n                                );\n\n                                ignore = $(this).attr(\"data-time\");\n\n                                /* Redraw black */\n                                $(\".feedback-helper\").each(function() {\n                                    if ($(this).attr(\"data-time\") == ignore) {\n                                        return true;\n                                    }\n                                    if ($(this).attr(\"data-type\") == \"blackout\") {\n                                        ctx.fillStyle = \"rgba(0,0,0,1)\";\n                                        ctx.fillRect(\n                                            parseInt($(this).css(\"left\"), 10),\n                                            parseInt($(this).css(\"top\"), 10),\n                                            $(this).width(),\n                                            $(this).height()\n                                        );\n                                    }\n                                });\n                            }\n                        } else {\n                            $(this).css(\"z-index\", \"30000\");\n                            $(this).children().remove();\n                            if ($(this).attr(\"data-type\") == \"blackout\") {\n                                redraw(ctx);\n                            }\n                        }\n                    }\n                );\n\n                $(document).on(\"click.feedback\", \"#feedback-close\", function() {\n                    if (\n                        settings.highlightElement &&\n                        $(this).parent().attr(\"data-highlight-id\")\n                    ) {\n                        var _hidx = $(this).parent().attr(\"data-highlight-id\");\n                    }\n\n                    $(this).parent().remove();\n\n                    if (settings.highlightElement && _hidx) {\n                        $('[data-highlight-id=\"' + _hidx + '\"]')\n                            .removeAttr(\"data-highlighted\")\n                            .removeAttr(\"data-highlight-id\");\n                    }\n\n                    redraw(ctx);\n                });\n\n                $(\"#feedback-module\").on(\n                    \"click.feedback\",\n                    \".feedback-wizard-close,.feedback-close-btn\",\n                    function() {\n                        close();\n                    }\n                );\n\n                $(document).on(\"keyup.feedback\", function(e) {\n                    if (e.keyCode == 27) {\n                        close();\n                    }\n                });\n\n                $(document).on(\"selectstart.feedback dragstart.feedback\", function(e) {\n                    e.preventDefault();\n                });\n\n                $(document).on(\n                    \"click.feedback\",\n                    \"#feedback-highlighter-back\",\n                    function() {\n                        canDraw = false;\n                        $(\"#feedback-canvas\").css(\"cursor\", \"default\");\n                        $(\"#feedback-helpers\").hide();\n                        $(\"#feedback-highlighter\").hide();\n                        $(\"#feedback-welcome-error\").hide();\n                        $(\"#feedback-welcome\").show();\n                    }\n                );\n\n                $(document).on(\n                    \"mousedown.feedback\",\n                    \".feedback-sethighlight\",\n                    function() {\n                        highlight = 1;\n                        $(this).addClass(\"feedback-active\");\n                        $(\".feedback-setblackout\").removeClass(\"feedback-active\");\n                    }\n                );\n\n                $(document).on(\n                    \"mousedown.feedback\",\n                    \".feedback-setblackout\",\n                    function() {\n                        highlight = 0;\n                        $(this).addClass(\"feedback-active\");\n                        $(\".feedback-sethighlight\").removeClass(\"feedback-active\");\n                    }\n                );\n\n                $(document).on(\n                    \"click.feedback\",\n                    \"#feedback-highlighter-next\",\n                    function() {\n                        canDraw = false;\n                        $(\"#feedback-canvas\").css(\"cursor\", \"default\");\n                        var sy = $(document).scrollTop(),\n                            dh = $(window).height();\n                        $(\"#feedback-helpers\").hide();\n                        $(\"#feedback-highlighter\").hide();\n                        $(\"#feedback-loading-icon\").show(); // Show loading icon after the next button is pressed on highlighter\n                        if (!settings.screenshotStroke) {\n                            redraw(ctx, false);\n                        }\n                        html2canvas($(\"body\"), {\n                            onrendered: function(canvas) {\n                                if (!settings.screenshotStroke) {\n                                    redraw(ctx);\n                                }\n                                _canvas = $(\n                                    '<canvas id=\"feedback-canvas-tmp\" width=\"' +\n                                    w +\n                                    '\" height=\"' +\n                                    dh +\n                                    '\"/>'\n                                )\n                                    .hide()\n                                    .appendTo(\"body\");\n                                _ctx = _canvas.get(0).getContext(\"2d\");\n                                _ctx.drawImage(canvas, 0, sy, w, dh, 0, 0, w, dh);\n                                img = _canvas.get(0).toDataURL();\n                                $(document).scrollTop(sy);\n                                post.img = img;\n                                settings.onScreenshotTaken(post.img);\n                                if (settings.showDescriptionModal) {\n                                    $(\"#feedback-canvas-tmp\").remove();\n                                    $(\"#feedback-loading-icon\").hide(); // Hide loading icon when the overview modal with screenshot is loaded\n                                    $(\"#feedback-overview\").show();\n                                    $(\"#feedback-overview-description-text>textarea\").remove();\n                                    $(\"#feedback-overview-screenshot>img\").remove();\n                                    $(\n                                        '<textarea class=\"form-control\" id=\"feedback-overview-note\">' +\n                                        $(\"#feedback-note\").val() +\n                                        \"</textarea>\"\n                                    ).insertAfter(\"#feedback-overview-description-text h3:eq(0)\");\n                                    $(\"#feedback-overview-screenshot\").append(\n                                        '<img class=\"feedback-screenshot border-0\" src=\"' +\n                                        img +\n                                        '\" />'\n                                    );\n                                } else {\n                                    $(\"#feedback-module\").remove();\n                                    close();\n                                    _canvas.remove();\n                                }\n                            },\n                            proxy: settings.proxy,\n                            letterRendering: settings.letterRendering,\n                        });\n                    }\n                );\n\n                // Skip screenshot creation via html2canvas and only send text feedback\n                // Bharat\n                // Custom added for RemUI\n                $(document).on(\n                    \"click.feedback\",\n                    \"#feedback-skiphighlighter-next\",\n                    function() {\n                        canDraw = false;\n                        $(\"#feedback-canvas\").css(\"cursor\", \"default\");\n                        // Unset any screenshot data\n                        img = \"\";\n                        post.img = \"\";\n\n                        $(\"#feedback-helpers\").hide();\n                        $(\"#feedback-highlighter\").hide();\n                        $(\"#feedback-loading-icon\").show(); // Show loading icon after the next button is pressed on highlighter\n                        $(\"#feedback-canvas-tmp\").remove();\n                        $(\"#feedback-loading-icon\").hide(); // Hide loading icon when the overview modal with screenshot is loaded\n                        $(\"#feedback-overview\").show();\n                        $(\"#feedback-overview-description-text>textarea\").remove();\n                        $(\"#feedback-overview-screenshot>img\").remove();\n                        $(\n                            '<textarea class=\"form-control\" id=\"feedback-overview-note\">' +\n                            $(\"#feedback-note\").val() +\n                            \"</textarea>\"\n                        ).insertAfter(\"#feedback-overview-description-text h3:eq(0)\");\n                        $(\"#feedback-overview-screenshot\").append(\n                            '<img class=\"feedback-screenshot border-0\" src=\"' +\n                            M.util.image_url(\"no_screenshot\", \"theme_remui\") +\n                            '\" />'\n                        );\n                    }\n                );\n\n                $(document).on(\n                    \"click.feedback\",\n                    \"#feedback-overview-back\",\n                    function() {\n                        canDraw = true;\n                        $(\"#feedback-canvas\").css(\"cursor\", \"crosshair\");\n                        $(\"#feedback-overview\").hide();\n                        $(\"#feedback-helpers\").show();\n                        $(\"#feedback-highlighter\").show();\n                        $(\"#feedback-overview-error\").hide();\n                        $(\"#feedback-email-error\").hide();\n                    }\n                );\n\n                $(document).on(\n                    \"keyup.feedback\",\n                    \"#feedback-note-tmp,#feedback-overview-note\",\n                    function(e) {\n                        var tx;\n                        if (e.target.id === \"feedback-note-tmp\") {\n                            tx = $(\"#feedback-note-tmp\").val();\n                        } else {\n                            tx = $(\"#feedback-overview-note\").val();\n                            $(\"#feedback-note-tmp\").val(tx);\n                        }\n\n                        $(\"#feedback-note\").val(tx);\n                    }\n                );\n\n                $(document).on(\"click.feedback\", \"#feedback-submit\", function() {\n                    canDraw = false;\n\n                    $(\"#feedback-overview-error\").hide();\n                    $(\"#feedback-email-error\").hide();\n\n                    if (\n                        $(\"#feedback-note\").val().length > 0 &&\n                        validateFeedbackEmail(\n                            $(\"#feedback_person_email_id_field\").val()\n                        ) !== false\n                    ) {\n                        $(\"#feedback-submit-success,#feedback-submit-error\").remove();\n                        $(\"#feedback-overview\").hide();\n                        $(\"#feedback-module\").append(settings.tpl.submitLoading);\n\n                        post.img = img;\n                        post.note = $(\"#feedback-note\").val();\n                        post.customer_email = $(\"#feedback_person_email_id_field\").val();\n                        // Var data = {feedback: JSON.stringify(post)};\n                        // $.ajax({\n                        // url: settings.ajaxURL,\n                        // dataType: 'json',\n                        // type: 'POST',\n                        // data: data,\n                        // success: function(response) {\n                        // var success = '<div id=\"feedback-submit-success\"><div class=\"feedback-logo\">Feedback</div><p>Thank you for your feedback. We value every piece of feedback we receive.</p>';\n                        // success += '<p><b>Feedback Reference ID : '+response+' </b></p>';\n                        // success += '<button class=\"feedback-close-btn feedback-btn-blue\">OK</button><div class=\"feedback-wizard-close\"></div></div>';\n                        // $('#feedback-module').append(success);\n                        // },\n                        // error: function(){\n                        // $('#feedback-module').append(settings.tpl.submitError);\n                        // }\n                        // });\n\n                        // Bharat\n                        // Replaces the AJAX send function with Moodle Ajax API\n                        var handle_report = Ajax.call([\n                            {\n                                methodname: settings.ajaxURL,\n                                args: {\n                                    feedbackdata: JSON.stringify(post),\n                                },\n                            },\n                        ]);\n                        handle_report[0]\n                            .done(function(response) {\n                                // Check for feedback ID\n                                if (response != false && response > 0) {\n                                    var success =\n                                        '<div id=\"feedback-submit-success\"><div class=\"feedback-logo\">Feedback</div><p>Thank you for your feedback. We value every piece of feedback we receive.</p>';\n                                    success +=\n                                        \"<p><b>Feedback Reference ID : \" + response + \" </b></p>\";\n                                    success +=\n                                        '<button class=\"feedback-close-btn feedback-btn-blue\">OK</button><div class=\"feedback-wizard-close\"></div></div>';\n                                    $(\"#feedback-module\").append(success);\n                                } else {\n                                    $(\"#feedback-module\").append(settings.tpl.submitError);\n                                }\n                            })\n                            .fail(function() {\n                                // Do something with the exception\n                                $(\"#feedback-module\").append(settings.tpl.submitError);\n                            });\n                    } else {\n                        if ($(\"#feedback-note\").val().length <= 0) {\n                            $(\"#feedback-overview-error\").show();\n                        }\n                        if (\n                            validateFeedbackEmail(\n                                $(\"#feedback_person_email_id_field\").val()\n                            ) === false\n                        ) {\n                            $(\"#feedback-email-error\").show();\n                        }\n                    }\n                });\n            });\n        }\n\n        /**\n         *\n         */\n        function close() {\n            $(document).off(\n                \"mouseenter.feedback mouseleave.feedback\",\n                \".feedback-helper\"\n            );\n            $(document).off(\"mouseup.feedback keyup.feedback\");\n            $(document).off(\"mousedown.feedback\", \".feedback-setblackout\");\n            $(document).off(\"mousedown.feedback\", \".feedback-sethighlight\");\n            $(document).off(\"mousedown.feedback click.feedback\", \"#feedback-close\");\n            $(document).off(\"mousedown.feedback\", \"#feedback-canvas\");\n            $(document).off(\"click.feedback\", \"#feedback-highlighter-next\");\n            $(document).off(\"click.feedback\", \"#feedback-highlighter-back\");\n            $(document).off(\"click.feedback\", \"#feedback-welcome-next\");\n            $(document).off(\"click.feedback\", \"#feedback-overview-back\");\n            $(document).off(\"mouseleave.feedback\", \"body\");\n            $(document).off(\"mouseenter.feedback\", \".feedback-helper\");\n            $(document).off(\"selectstart.feedback dragstart.feedback\");\n            $(\"#feedback-module\").off(\n                \"click.feedback\",\n                \".feedback-wizard-close,.feedback-close-btn\"\n            );\n            $(document).off(\"click.feedback\", \"#feedback-submit\");\n\n            if (settings.highlightElement) {\n                $(document).off(\"click.feedback\", \"#feedback-canvas\");\n                $(document).off(\"mousemove.feedback\", \"#feedback-canvas\");\n            }\n            $('[data-highlighted=\"true\"]')\n                .removeAttr(\"data-highlight-id\")\n                .removeAttr(\"data-highlighted\");\n            $(\"#feedback-module\").remove();\n            $(\".feedback-btn\").show();\n\n            settings.onClose.call(this);\n        }\n\n        /**\n         * @param {String} ctx\n         * @param {String} border\n         */\n        function redraw(ctx, border) {\n            border = typeof border !== \"undefined\" ? border : true;\n            ctx.clearRect(\n                0,\n                0,\n                $(\"#feedback-canvas\").width(),\n                $(\"#feedback-canvas\").height()\n            );\n            ctx.fillStyle = \"rgba(102,102,102,0.5)\";\n            ctx.fillRect(\n                0,\n                0,\n                $(\"#feedback-canvas\").width(),\n                $(\"#feedback-canvas\").height()\n            );\n            $(\".feedback-helper\").each(function() {\n                if ($(this).attr(\"data-type\") == \"highlight\") {\n                    if (border) {\n                        drawlines(\n                            ctx,\n                            parseInt($(this).css(\"left\"), 10),\n                            parseInt($(this).css(\"top\"), 10),\n                            $(this).width(),\n                            $(this).height()\n                        );\n                    }\n                }\n            });\n            $(\".feedback-helper\").each(function() {\n                if ($(this).attr(\"data-type\") == \"highlight\") {\n                    ctx.clearRect(\n                        parseInt($(this).css(\"left\"), 10),\n                        parseInt($(this).css(\"top\"), 10),\n                        $(this).width(),\n                        $(this).height()\n                    );\n                }\n            });\n            $(\".feedback-helper\").each(function() {\n                if ($(this).attr(\"data-type\") == \"blackout\") {\n                    ctx.fillStyle = \"rgba(0,0,0,1)\";\n                    ctx.fillRect(\n                        parseInt($(this).css(\"left\"), 10),\n                        parseInt($(this).css(\"top\"), 10),\n                        $(this).width(),\n                        $(this).height()\n                    );\n                }\n            });\n        }\n\n        /**\n         * @param {String} ctx\n         * @param {String} x\n         * @param {String} y\n         * @param {String} w\n         * @param {String} h\n         */\n        function drawlines(ctx, x, y, w, h) {\n            ctx.strokeStyle = settings.strokeStyle;\n            ctx.shadowColor = settings.shadowColor;\n            ctx.shadowOffsetX = settings.shadowOffsetX;\n            ctx.shadowOffsetY = settings.shadowOffsetY;\n            ctx.shadowBlur = settings.shadowBlur;\n            ctx.lineJoin = settings.lineJoin;\n            ctx.lineWidth = settings.lineWidth;\n\n            ctx.strokeRect(x, y, w, h);\n\n            ctx.shadowOffsetX = 0;\n            ctx.shadowOffsetY = 0;\n            ctx.shadowBlur = 0;\n            ctx.lineWidth = 1;\n        }\n\n        /**\n         * @param {String} sEmail\n         * @returns {boolean} Return value\n         */\n        function validateFeedbackEmail(sEmail) {\n            var reEmail =\n                /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/;\n\n            if (!sEmail.match(reEmail)) {\n                return false;\n            }\n            return true;\n        }\n    };\n});\n"],"names":["define","$","Ajax","feedback","options","settings","extend","ajaxURL","postBrowserInfo","postHTML","postURL","proxy","undefined","letterRendering","initButtonText","strokeStyle","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","lineJoin","lineWidth","html2canvasURL","feedbackButton","showDescriptionModal","isDraggable","onScreenshotTaken","tpl","description","highlighter","overview","submitLoading","submitSuccess","submitError","onClose","onTrigger","screenshotStroke","highlightElement","initialBox","supportedBrowser","window","HTMLCanvasElement","isFeedbackButtonNative","_html2canvas","close","document","off","removeAttr","remove","show","call","this","redraw","ctx","border","clearRect","width","height","fillStyle","fillRect","each","attr","drawlines","parseInt","css","x","y","w","h","strokeRect","validateFeedbackEmail","sEmail","match","append","on","hide","getScript","canDraw","img","canvasAttr","position","left","top","e","$d","addClass","drag_h","outerHeight","drag_w","outerWidth","pos_y","offset","pageY","pos_x","pageX","parents","_top","_left","_bottom","_right","removeClass","preventDefault","getContext","rect","drag","highlight","post","browser","appCodeName","navigator","appName","appVersion","cookieEnabled","onLine","platform","userAgent","plugins","i","push","name","url","URL","html","startX","startY","dtop","dleft","dwidth","dheight","dtype","Date","now","highlighted","tmpHighlighted","hidx","$toHighlight","length","_x","_y","_w","_h","type","val","find","ignore","children","parent","_hidx","keyCode","sy","scrollTop","dh","html2canvas","onrendered","canvas","_canvas","appendTo","_ctx","get","drawImage","toDataURL","insertAfter","M","util","image_url","tx","target","id","note","customer_email","methodname","args","feedbackdata","JSON","stringify","done","response","success","fail"],"mappings":"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"}