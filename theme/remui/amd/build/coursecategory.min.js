/**
 * @module     theme_remui/coursecategory
 * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_remui/coursecategory",["jquery","core/ajax","core/str","core/templates","theme_remui/jquery-toolbar","core/notification","theme_remui/user/repository","theme_remui/bootstrap-select"],(function($,Ajax,str,templates,toolbar,Notification,UserRepository){var filterobj,langstrings,categoryfilter=$("#categoryfilter"),sortfilter=$("select#sortfilter"),cardswrapperarea=$(".course-cards"),cardspagination=$(".cards-pagination"),gridtemplate="theme_remui/course_card_grid",searchfilter=$(".layout-1 .filters-wrapper .simplesearchform"),coursecounter=$(".course-counter span.course-number"),tagswrapper=$(".tag-wrapper"),togglebtn=$(".togglebtn"),courseArchieveFilters={};const SELECTORS_CUSTOM_DROPDOWN_MENU=".edw-custom-dropdown-wrapper .dropdown-menu",SELECTORS_COURSE_SORTING=".edw-custom-dropdown-wrapper.course-shorting",SELECTORS_COURSE_FILTERS=".edw-custom-dropdown-wrapper.course-filters",SELECTORS_MAX_COURSE_SHOWN=".edw-custom-dropdown-wrapper.max-course-shown",SELECTORS_COURSE_FILTER_FORM=".edw-custom-dropdown-wrapper #course-filter-form",SELECTORS_MAXCOURSE_DEFAULT=".edw-custom-dropdown-wrapper.max-course-shown .max-course-default";var courseContent=new function(){this.mycourses=!1,this.courses=!1,this.isLoaded=function(){return this[courseContent.getActive()]},this.loaded=function(state){void 0===state&&(state=!0),this[courseContent.getActive()]=state},this.reset=function(){this.mycourses=!1,this.courses=!1},this.getActive=function(){return!0===filterobj.tab?"mycourses":"courses"}};function updatePage(){$(cardswrapperarea).empty(),filterobj.pagination&&cardspagination.empty(),generateCourseCards()}function populate_tags(){Ajax.call([{methodname:"theme_remui_get_tags",args:{data:JSON.stringify(filterobj)}}])[0].done((function(response){tagswrapper.empty().append(response),generateHorizontalScroller($(".tag_list"))})).fail(Notification.exception)}const generateHorizontalScroller=element=>{if(0==element.length)return;const _main=element[0];if(_main.scrollWidth>_main.clientWidth){$(".left-scroll,.right-scroll").removeClass("d-none");const updateButtons=()=>{$(".left-scroll").disabled=!1,$(".right-scroll").disabled=!1,0==_main.scrollLeft&&($(".left-scroll").disabled=!0);var _scrollWidth=_main.scrollWidth,_clientWidth=_main.clientWidth;_main.scrollLeft==_scrollWidth-_clientWidth&&($(".left-scroll").disabled=!0)},moveRight=function(_ele){let scrollStep=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;_ele.scrollLeft+=scrollStep,updateButtons()},moveLeft=function(_ele){let scrollStep=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;_ele.scrollLeft-=scrollStep,updateButtons()};var _lInterval,_rInterval;$(".left-scroll").on("mouseover",(function(){_lInterval=setInterval((function(){moveLeft(_main,1)}),1)})),$(".right-scroll").on("mouseover",(function(){_rInterval=setInterval((function(){moveRight(_main,1)}),1)})),$(".left-scroll").on("mouseout",(function(){clearInterval(_lInterval)})),$(".right-scroll").on("mouseout",(function(){clearInterval(_rInterval)}))}};function generateCourseCards(){filterobj.isFilterModified&&(toggleContent(!0),function(){$(".courses-tabs .courses-loader-wrap").show();var serviceName="theme_remui_get_courses";Ajax.call([{methodname:serviceName,args:{data:JSON.stringify(filterobj)}}])[0].done((function(response){response=JSON.parse(response),$(coursecounter).text(response.totalcoursescount);var viewobj=void 0===filterobj.view?response.view:filterobj.view,filterbuttonsarray=$(".filters-wrapper .view-buttons .btn"),prefveiwbuttonavailable=filterbuttonsarray.filter((function(){return $(this).attr("data-view")==viewobj})).length>0;prefveiwbuttonavailable||filterbuttonsarray.length>=1&&(viewobj=$(filterbuttonsarray[0]).attr("data-view"));var rendertemplate=gridtemplate;("grid"==viewobj||response.latest_card)&&(rendertemplate=gridtemplate),("list"==viewobj||response.latest_card)&&(rendertemplate="theme_remui/course_card_list"),("summary"==viewobj||response.latest_card)&&(rendertemplate="theme_remui/course_card_summary"),(window.screen.width<=480||response.latest_card)&&(rendertemplate=gridtemplate,viewobj="grid"),prefveiwbuttonavailable?updateView(viewobj):function(view){const viewClasses={grid:"grid-view edw-course-card-grid",list:"list-view list-group edw-course-list-container",summary:"summary-view edw-course-summary-container d-flex flex-column m-0"},allClasses=Object.values(viewClasses).join(" ");cardswrapperarea.removeClass(allClasses).addClass(viewClasses[view])}(viewobj),response.latest_card?(cardswrapperarea.addClass("latest-cards"),$(".viewtoggler").addClass("hidden")):(cardswrapperarea.removeClass("latest-cards"),$(".viewtoggler").removeClass("hidden"));var courses=response.courses;if(courses.length>0){for(var i=0;i<courses.length;i++)templates.render(rendertemplate,courses[i]).then((function(html,js){templates.appendNodeContents(cardswrapperarea,html,js),filterobj.tab||response.latest_card||$(".showoptions").each((function(){$(this).toolbar({content:$(this).data("toolbar"),style:"primary"})}))})).fail(Notification.exception);$(SELECTORS_COURSE_SORTING).removeClass("d-none"),$(SELECTORS_MAX_COURSE_SHOWN).removeClass("d-none")}else{var htmldata='<div class="alert alert-warning alert-dismissible  w-full mx-10" role="alert">';htmldata+='<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>'+langstrings[0]+"</div>",$(SELECTORS_COURSE_SORTING).addClass("d-none"),$(SELECTORS_MAX_COURSE_SHOWN).addClass("d-none"),templates.appendNodeContents(cardswrapperarea,htmldata,"")}filterobj.pagination&&templates.appendNodeContents(cardspagination,response.pagination,""),$(".courses-tabs .courses-loader-wrap").hide(),toggleContent(!1)})).fail(Notification.exception)}())}function toggleContent(hidecontent){hidecontent?($("#course-archive-main-container .tag-wrapper").addClass("d-none"),$("#course-archive-main-container .course-cards").addClass("d-none"),$("#course-archive-main-container .cards-pagination").addClass("d-none"),$("#course-archive-main-container .loader-overlay").addClass("d-flex").removeClass("d-none")):($("#course-archive-main-container .tag-wrapper").removeClass("d-none"),$("#course-archive-main-container .course-cards").removeClass("d-none"),$("#course-archive-main-container .cards-pagination").removeClass("d-none"),$("#course-archive-main-container .loader-overlay").addClass("d-none").removeClass("d-flex"))}function updateView(view){const views={grid:"grid-view edw-course-card-grid",list:"list-view list-group edw-course-list-container",summary:"summary-view edw-course-summary-container d-flex flex-column m-0"},commonRemoveClasses=Object.values(views).join(" "),btnSelector=".".concat(view,"_btn");cardswrapperarea.removeClass(commonRemoveClasses).addClass(views[view]),$(".grid_btn, .list_btn, .summary_btn").removeClass("btn-primary active"),$(btnSelector).addClass("btn-primary active"),"grid"===view&&(filterobj.view="grid")}function courseFilterCommon(){filterobj.page.courses=0,courseArchieveFilters.pageno=0,$(SELECTORS_CUSTOM_DROPDOWN_MENU).removeClass("show"),setCoursePerPageDetails(),sessionStorage.setItem("courseArchieveFilters",JSON.stringify(courseArchieveFilters)),updatePage()}function shortingSelectOption(e){$(SELECTORS_COURSE_SORTING+" .dropdown-toggle .toggle-text").text($(this).text()),$(SELECTORS_COURSE_SORTING+" .select-option").removeClass("active"),$(this).addClass("active"),filterobj.sort=$(this).data("value"),courseArchieveFilters.sort=$(this).data("value"),courseFilterCommon()}function maxCourseSelectOption(e){$(SELECTORS_MAX_COURSE_SHOWN+" .dropdown-toggle .toggle-text").text($(this).text()),$(SELECTORS_MAX_COURSE_SHOWN+" .select-option").removeClass("active"),$(this).addClass("active"),filterobj.courserowperpage=$(this).data("value"),courseArchieveFilters.courserowperpage=$(this).data("value"),courseFilterCommon()}function courseFilterFormSubmit(e){e.preventDefault();var selectedFilters=getCheckedFiltersData(this);Object.keys(selectedFilters).length>0?(filterobj.selectedFilters=selectedFilters,filterobj.isfilterapplied=!0):(filterobj.isfilterapplied=!1,delete filterobj.selectedFilters),courseArchieveFilters.coursefilters=selectedFilters,courseFilterCommon()}function courseFilterFormClear(e){$(SELECTORS_COURSE_FILTER_FORM).find('input[type="checkbox"]').each((function(){$(this).prop("checked",!1)}))}function getCheckedFiltersData($filterform){var selectedFilters={},filterCount=0;return $($filterform).find('input[type="checkbox"]:checked').each((function(){var filterType=$(this).data("filtertype"),value=$(this).val(),name=$(this).attr("name");filterCount++,selectedFilters[filterType]||(selectedFilters[filterType]=[]),selectedFilters[filterType].push({name:name,value:value})})),filterCount?$(SELECTORS_COURSE_FILTERS+" .filter-count-label").removeClass("d-none").text(filterCount):$(SELECTORS_COURSE_FILTERS+" .filter-count-label").addClass("d-none").text(""),selectedFilters}function setCoursePerPageDetails(){let courseperrow=4;"undefined"==typeof window&&(courseperrow=4);var screenWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;if(courseperrow=screenWidth<768?1:screenWidth<1024?2:screenWidth<1200||$("body").hasClass("limitedwidth")?3:4,!filterobj.courserowperpage){let maxCourseDefault=$(SELECTORS_MAXCOURSE_DEFAULT).data("value"),courserowperpage=Math.ceil(maxCourseDefault/courseperrow);filterobj.courserowperpage=courserowperpage;let activeOption=$(SELECTORS_MAX_COURSE_SHOWN+" .select-option[data-value='"+courserowperpage+"']");$(SELECTORS_MAX_COURSE_SHOWN+" .dropdown-toggle .toggle-text").text(activeOption.text()),$(SELECTORS_MAX_COURSE_SHOWN+" .select-option").removeClass("active"),activeOption.addClass("active")}filterobj.courseperrow=courseperrow}$(document).delegate(".tool-item","click",(function(){window.location=$(this).attr("href")})),$(categoryfilter).on("change",(function(e){filterobj.category=e.target.value;var url=M.cfg.wwwroot+"/course/index.php?categoryid="+encodeURI(e.target.value);""!=filterobj.search&&(url+="&search="+filterobj.search),"default"!=filterobj.sort&&-1!=filterobj.sort&&"function"!=typeof filterobj.sort&&(url+="&sort="+filterobj.sort),window.history.replaceState("pagechange",document.title,url),window.location.reload()})),$(searchfilter).on("submit",(function(e){e.preventDefault(),e.stopPropagation(),filterobj.initPagination(),filterobj.search=$("#course-archive-main-container .filters-wrapper .simplesearchform input.form-control").val(),courseContent.reset(),updatePage()})),$("#switch-label1, #switch-label2").on("change.bootstrapSwitch",(function(e,data){filterobj.tab=e.target.checked,updatePage(),populate_tags()})),$(togglebtn).on("click",(function(){var clckviewbtn=$(this).attr("data-view");filterobj.view=clckviewbtn,updateView(filterobj.view),UserRepository.setUserPreference("course_view_state",clckviewbtn,null),courseFilterCommon()})),$(sortfilter).on("changed.bs.select",(function(e){filterobj.sort=e.target.value,updatePage()})),$("#course-archive-main-container").on("click",".menu-picker-select",(function(){$(this).find(".menu-content").toggleClass("d-none"),$(this).find(".edw-icon-Setting").toggleClass("d-none"),$(this).find(".edw-icon-Cancel").toggleClass("d-none")})),$(document).delegate(".cards-pagination .pagination .page-item .page-link","click",(function(e){e.preventDefault();var linkdata=e.target.href;void 0===linkdata&&void 0===(linkdata=e.target.parentElement.href)&&(linkdata=e.target.parentElement.parentElement.href);for(var hash,hashes=linkdata.slice(linkdata.indexOf("?")+1).split("&"),vars=[],i=0;i<hashes.length;i++)hash=hashes[i].split("="),vars.push(hash[0]),vars[hash[0]]=hash[1];filterobj.tab?filterobj.page.mycourses=vars.page:(filterobj.page.courses=vars.page,courseArchieveFilters.pageno=vars.page,sessionStorage.setItem("courseArchieveFilters",JSON.stringify(courseArchieveFilters))),updatePage()}));return{init:function(defaultCategory){$(document).ready((function(){var categorydescription=$(".category-description-container").get();$(".filters-wrapper .category-description-container").remove(),$(categorydescription).insertAfter(".header-wrapper"),$(categorydescription).removeClass("d-none");var summaryheight=$(".category-description-wrapper").height();const $container=$(".category-description-container"),$wrapper=$(".category-description-wrapper"),$readMore=$container.find("#readmorebtn"),$readLess=$container.find("#readlessbtn");function toggleSummary(expand){$wrapper.toggleClass("summary-expanded",expand).toggleClass("summary-collapsed",!expand),$readMore.toggleClass("d-none",expand),$readLess.toggleClass("d-none",!expand)}summaryheight>300&&($readMore.removeClass("d-none"),$wrapper.addClass("summary-collapsed").removeClass("summary-expanded")),$readMore.on("click",(()=>toggleSummary(!0))),$readLess.on("click",(()=>toggleSummary(!1))),$(SELECTORS_CUSTOM_DROPDOWN_MENU).on("click.bs.dropdown",(function(e){e.stopPropagation()})),$(SELECTORS_COURSE_SORTING+" .select-option").on("click",shortingSelectOption),$(SELECTORS_MAX_COURSE_SHOWN+" .select-option").on("click",maxCourseSelectOption),$(SELECTORS_COURSE_FILTER_FORM+" .clear-btn").on("click",courseFilterFormClear),$(SELECTORS_COURSE_FILTER_FORM).on("submit",courseFilterFormSubmit),$(SELECTORS_CUSTOM_DROPDOWN_MENU+" .dropdown-close").on("click",(()=>{$(SELECTORS_CUSTOM_DROPDOWN_MENU).removeClass("show")})),$(".categoryfiltermenu .dropdown-menu .dropdown-close").on("click",(()=>{$(".categoryfiltermenu .dropdown-menu").removeClass("show")}))})),$("[category-filter-link]").on("click",(function(event){return event.preventDefault(),$(categoryfilter).val($(this).data("id")).trigger("change"),!1}));str.get_strings([{key:"nocoursefound",component:"theme_remui"}]).then((function(stringres){langstrings=stringres,filterobj=function(defaultCategory){var _pageobj={courses:0,mycourses:0},_obj={category:defaultCategory,sort:"ASC",search:"",tab:!1,page:_pageobj,pagination:!0,isFilterModified:!0,initAttributes:function(){_obj.category=defaultCategory,_obj.sort="ASC",_obj.search="",_obj.tab=!1,_obj.page=_pageobj,_obj.pagination=!0,_obj.isFilterModified=!0},initPagination:function(){_obj.page={courses:0,mycourses:0}}};return _obj}(defaultCategory);for(var hash,vars=[],hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++)hash=hashes[i].split("="),vars.push(hash[0]),vars[hash[0]]=hash[1];vars.categoryid&&0!=vars.categoryid&&(filterobj.category=vars.categoryid),function(){var _window;courseArchieveFilters=JSON.parse(sessionStorage.getItem("courseArchieveFilters"));let activesort=null,screenWidth=(null===(_window=window)||void 0===_window?void 0:_window.innerWidth)||document.documentElement.clientWidth||document.body.clientWidth;if(courseArchieveFilters){if(courseArchieveFilters.coursefilters&&(Object.keys(courseArchieveFilters.coursefilters).forEach((filterType=>{courseArchieveFilters.coursefilters[filterType].forEach((filter=>{let filterInputField=$(SELECTORS_COURSE_FILTER_FORM+" input[name='"+filter.name+"']");filterInputField&&filterInputField.prop("checked",!0)}))})),filterobj.selectedFilters=getCheckedFiltersData(SELECTORS_COURSE_FILTER_FORM),filterobj.selectedFilters&&Object.keys(filterobj.selectedFilters).length>0&&(filterobj.isfilterapplied=!0)),courseArchieveFilters.courserowperpage){let activepage=$(SELECTORS_MAX_COURSE_SHOWN+" .select-option[data-value='"+courseArchieveFilters.courserowperpage+"']");$(SELECTORS_MAX_COURSE_SHOWN+" .dropdown-toggle .toggle-text").text(activepage.text()),$(SELECTORS_MAX_COURSE_SHOWN+" .select-option").removeClass("active"),activepage.addClass("active"),filterobj.courserowperpage=courseArchieveFilters.courserowperpage}courseArchieveFilters.sort&&(activesort=$(SELECTORS_COURSE_SORTING+" .select-option[data-value='"+courseArchieveFilters.sort+"']")),(courseArchieveFilters.hasOwnProperty("pageno")||void 0!==courseArchieveFilters.pageno)&&(filterobj.page.courses=courseArchieveFilters.pageno),courseArchieveFilters.courserowperpage||courseArchieveFilters.maxCourseDefault==$(SELECTORS_MAXCOURSE_DEFAULT).data("value")||(courseArchieveFilters.maxCourseDefault=$(SELECTORS_MAXCOURSE_DEFAULT).data("value"),filterobj.page.courses=0,courseArchieveFilters.pageno=0),courseArchieveFilters.islimitedwidth===$("body").hasClass("limitedwidth")&&courseArchieveFilters.windowWidth===screenWidth||(courseArchieveFilters.islimitedwidth=$("body").hasClass("limitedwidth"),courseArchieveFilters.windowWidth=screenWidth,filterobj.page.courses=0,courseArchieveFilters.pageno=0),courseArchieveFilters.category!=filterobj.category&&(courseArchieveFilters.category=filterobj.category,filterobj.page.courses=0,courseArchieveFilters.pageno=0)}else(courseArchieveFilters={}).islimitedwidth=$("body").hasClass("limitedwidth"),courseArchieveFilters.maxCourseDefault=$(SELECTORS_MAXCOURSE_DEFAULT).data("value"),courseArchieveFilters.windowWidth=screenWidth,courseArchieveFilters.category=filterobj.category;activesort&&0!=activesort.length||(activesort=$(SELECTORS_COURSE_SORTING+" .select-option[data-value='none']"),courseArchieveFilters.sort="none"),sessionStorage.setItem("courseArchieveFilters",JSON.stringify(courseArchieveFilters)),$(SELECTORS_COURSE_SORTING+" .dropdown-toggle .toggle-text").text(activesort.text()),$(SELECTORS_COURSE_SORTING+" .select-option").removeClass("active"),activesort.addClass("active"),setCoursePerPageDetails(),filterobj.sort=courseArchieveFilters.sort}(),vars.hasOwnProperty("sort")&&"function"!=typeof vars.sort&&(filterobj.sort=vars.sort),null!=vars.search&&(filterobj.search=decodeURI(vars.search)),function(filterdata){if($(".selectpicker").each((function(){$(this).selectpicker()})),""!==filterdata.category&&$.isNumeric(filterdata.category)){var targetElement=$('.categoryfiltermenu .dropdown-menu a[data-cat-id="'+filterdata.category+'"]');$(".categoryfiltermenu .categoryfilter span").text(targetElement.text())}1==filterdata.tab?$("#switch-label1, #switch-label2").prop("checked",!0):$("#switch-label1, #switch-label2").prop("checked",!1),null!==filterdata.sort&&null!=filterdata.sort&&"function"!=typeof filterdata.sort&&$("#sortfilter.selectpicker").selectpicker("val",filterdata.sort),""!==filterdata.search&&$(searchfilter).find('input[type="text"]').val(filterdata.search)}(filterobj),generateCourseCards(),populate_tags()}))}}}));

//# sourceMappingURL=coursecategory.min.js.map