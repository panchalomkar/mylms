/**
 * @module     theme_remui/edw_aw_helper
 * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_remui/edw_aw_helper",["jquery","core/ajax","core/str","core/toast","theme_remui/feedbackcollection","core_user/repository"],(function($,Ajax,Str,Toast,feedbackcollection,UserRepository){var SELECTOR_ENABLEAW='a[href="#enable_aw"]',SELECTOR_DISABLEAW='a[href="#disable_aw"]',SELECTOR_ASWMENUSETTINGDROPDOWNBTN="#aw_settingsDropdown",SELECTOR_ADMINSETTINGURL=".adminsettingurl",SELECTOR_PREFSETTINGURL=".prefsettingurl",SELECTOR_ASWCONTAINER=".asw-container";const registerCommonEvents=(issiteadmin,feedbackstatus,isloggedin)=>{$(document).on("click",SELECTOR_ENABLEAW+","+SELECTOR_DISABLEAW,(function(e){e.preventDefault();var $this=$(this);let message="";if("#enable_aw"==$this.attr("href")){updateAWState($this,{href:"#disable_aw",string:"enable-aw-for-me",value:!1}),message=M.util.get_string("enable-aw-for-me-notice","theme_remui")}else{updateAWState($this,{href:"#enable_aw",string:"disable-aw-for-me",value:!0}),message=M.util.get_string("disable-aw-for-me-notice","theme_remui")}localStorage.setItem("awNotification",message),setTimeout((()=>{window.location.reload()}),200)})),$(document).on("click","".concat(SELECTOR_ASWCONTAINER,",").concat(SELECTOR_ASWMENUSETTINGDROPDOWNBTN),(function(e){var siteadminurl=M.cfg.wwwroot+"/admin/settings.php?section=themesettingremui#admin-enableaccessibilitytools",prefurl=M.cfg.wwwroot+"/user/preferences.php";$(SELECTOR_ADMINSETTINGURL).attr("href",siteadminurl),$(SELECTOR_PREFSETTINGURL).attr("href",prefurl),issiteadmin?$(SELECTOR_ADMINSETTINGURL).show():$(SELECTOR_ADMINSETTINGURL).hide(),feedbackstatus||setTimeout((()=>{$(".asw-footer").removeClass("d-none")}),3e3)})),$(document).on("click","#aw_feedbackcollection-form .aw-feedback-close",(async function(e){removeFeedbackOption()})),$(document).on("change",'#aw_feedbackcollection-form .feedback-item input[type="radio"]',(async function(){var question=$('#aw_feedbackcollection-form input[name="question"]').val(),questionName=$('#aw_feedbackcollection-form input[name="questionname"]').val(),submitData={question:question,answer:$('#aw_feedbackcollection-form input[name="answer"]:checked').val(),usercomment:""};removeFeedbackOption(!0),feedbackHandler(questionName,submitData)})),$(document).on("submit","#aw_feedbackcollection-form",(async function(e){e.preventDefault();const formData=new FormData(this),question=formData.get("question");feedbackHandler(formData.get("questionname"),{question:question,answer:$('#aw_feedbackcollection-form input[name="answer"]:checked').val(),usercomment:"submit"===$(e.target).find('button[type="submit"]:focus').data("type")?formData.get("feedback"):""},!0)}))};function update_aw_feedback(submiteddata){let isgetfeedback=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ajax.call([{methodname:"theme_remui_do_feedbackcollection_action",args:{action:"update_aw_feedback",config:JSON.stringify({feedback:submiteddata,isgetfeedback:isgetfeedback})}}])[0]}function updateAWState($element,state){$element.attr("href",state.href).text(M.util.get_string(state.string,"theme_remui")),require(["core_user/repository"],(function(UserRepository){UserRepository.setUserPreference("acs-widget-status",state.value)}))}function removeFeedbackOption(){let onlyHide=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(onlyHide)return $(".asw-footer").css("padding",0),void $(".feedback-question-wrapper").removeClass("d-flex").addClass("d-none");var feedback_option=$(".asw-footer");feedback_option.remove()}async function feedbackHandler(questionName,submitData){let isgetfeedback=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var aw_feedbacks=await update_aw_feedback(submitData,isgetfeedback);aw_feedbacks=JSON.parse(aw_feedbacks);var feedbackString=String(aw_feedbacks);aw_feedbacks=JSON.parse(feedbackString),feedbackString=Object.entries(aw_feedbacks.counts).map((_ref=>{let[key,value]=_ref;return"".concat(key,": ").concat(value)})).join(", "),submitData.answer=feedbackString,feedbackcollection.submit_feedback(questionName,submitData,!0);var feedbackcommentdata={question:"Accessibility widget feedbacks",answer:JSON.stringify(aw_feedbacks.accessibilityfeedbacks)};feedbackcollection.submit_feedback("accessibilitywidgetfeedback",feedbackcommentdata,!0),UserRepository.setUserPreference("acs-feedback-status",!0),isgetfeedback&&removeFeedbackOption()}return $(document).ready((function(){let notificationMessage=localStorage.getItem("awNotification");notificationMessage&&(Toast.add(notificationMessage,{delay:5e3,closeButton:!0,type:"warning edw_aw_toast"}),localStorage.removeItem("awNotification"))})),{init:function(){let issiteadmin=arguments.length>0&&void 0!==arguments[0]&&arguments[0],feedbackstatus=arguments.length>1&&void 0!==arguments[1]&&arguments[1];registerCommonEvents(issiteadmin,feedbackstatus)}}}));

//# sourceMappingURL=edw_aw_helper.min.js.map