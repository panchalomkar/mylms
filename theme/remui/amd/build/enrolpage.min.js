/**
 * @module     theme_remui/enrolpage
 * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_remui/enrolpage",["jquery","core/ajax","core/templates","core/notification","core_message/message_user_button","core/custom_interaction_events","core_message/message_drawer_helper"],(function($,Ajax,Templates,Notification,Messageuserbutton,CustomEvents,MessageDrawerHelper){const showenrollbtn="show-enrol-option-btn",hideenrollbtn="hide-enrol-option-btn",activateContentLoading=_thispane=>{var serviceName=$(_thispane).attr("data-service"),templateName=$(_thispane).attr("data-template");serviceName&&Ajax.call([{methodname:serviceName,args:{courseid:M.cfg.courseId}}])[0].done((function(response){response=JSON.parse(response),Templates.renderForPromise(templateName,response).then((_ref=>{let{html:html,js:js}=_ref;$(_thispane).find(".tab-pane-area").empty(),Templates.appendNodeContents(_thispane,html,js),$('.nav-link[href="#'+$(_thispane).attr("id")+'"]').removeClass("loading"),$(_thispane).removeClass("loading")})).catch((ex=>(ex=>{console.error(ex)})(ex)))})).fail(Notification.exception)},updateenrolloption=status=>{Ajax.call([{methodname:"theme_remui_enrol_page_action",args:{action:"update_enroll_option",config:JSON.stringify({courseid:M.cfg.courseId,enrolloptionshidden:status})},done:function(response){JSON.parse(response).enrolloptionshidden?($("."+hideenrollbtn).removeClass("d-flex").addClass("d-none"),$("."+showenrollbtn).removeClass("d-none").addClass("d-flex"),$(".enrol-main-area-wrapper").addClass("d-none"),$(".enrol-mainarea-hidden-contentainer").removeClass("d-none")):($("."+showenrollbtn).removeClass("d-flex").addClass("d-none"),$("."+hideenrollbtn).removeClass("d-none").addClass("d-flex"),$(".enrol-main-area-wrapper").removeClass("d-none"),$(".enrol-mainarea-hidden-contentainer").addClass("d-none"))},fail:function(ex){Notification.exception(ex)}}])},registerCommonEvents=()=>{$("#enrol_instructorscount").click((function(e){$('a[href="#linkinstructors"]').tab("show")})),$("#enroll-now-btn-form").submit((function(event){event.preventDefault(),((title,link,customprice)=>{Ajax.call([{methodname:"theme_remui_enrol_page_action",args:{action:"update_enroll_now_btn",config:JSON.stringify({courseid:M.cfg.courseId,title:title,link:link,customprice:customprice})},done:function(response){var data=JSON.parse(response);$(".enroll-btn-wrapper a.btn").html(data.buttontext),data.customprice?($("#custom-price-box").removeClass("d-none"),$("#custom-price-box .pricing--price").html(data.customprice),$(".default-pricing-section").addClass("disabled")):($("#custom-price-box").addClass("d-none"),$(".default-pricing-section").removeClass("disabled"))},fail:function(ex){Notification.exception(ex)}}])})($(this).find("#enrolbtntext").val(),$(this).find("#enrolbtnurl").val(),$(this).find("#custompricetext").val()),$(".enroll-btn-upd-dropdown").removeClass("show")})),$("#enable-default-pricing").on("click",(function(){Ajax.call([{methodname:"theme_remui_enrol_page_action",args:{action:"clear_ustomprice_and_link",config:JSON.stringify({courseid:M.cfg.courseId})},done:function(response){var data=JSON.parse(response);console.log(data),$("#custom-price-box").addClass("d-none"),$("#custom-price-box .pricing--price").text(""),$(".default-pricing-section").removeClass("disabled"),$("#custompricetext").val(""),$("#enrolbtnurl").val("#")},fail:function(ex){Notification.exception(ex)}}])})),$(".enroll-btn-upd-dropdown").on("click.bs.dropdown",(function(e){e.stopPropagation()})),$(".cancel-enroll-dropdown-btn").on("click",(function(){$(".enroll-btn-upd-dropdown").removeClass("show")})),$("."+showenrollbtn+", ."+hideenrollbtn).on("click",(function(e){e.preventDefault(),$(this).hasClass(showenrollbtn)?updateenrolloption(!1):$(this).hasClass(hideenrollbtn)&&updateenrolloption(!0)})),$(document).on("click",".enrol-instructor-msg-btn",(function(e){var element=$(this);if($(this).hasClass("active"))MessageDrawerHelper.hide(),$(this).removeClass("active");else{$(".enrol-instructor-msg-btn").removeClass("active"),$(this).addClass("active");var args={conversationid:parseInt(element.attr("data-conversationid")),buttonid:element.attr("id"),userid:parseInt(element.attr("data-userid"))};args.conversationid?MessageDrawerHelper.showConversation(args):MessageDrawerHelper.createConversationWithUser(args)}})),$(document).on("click",".modal-close-btn, .modal",(function(){var video=document.getElementById("customfieldinfovideo");video.pause(),video.currentTime=0}))};return{init:function(){$(document).ready((function(){activateContentLoading(".tab-pane.active.loading"),$(document).on("click",".nav-link.loading",(function(){var loadContentForPane=$(this).attr("href");activateContentLoading(loadContentForPane)}))})),registerCommonEvents()}}}));

//# sourceMappingURL=enrolpage.min.js.map