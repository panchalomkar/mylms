{"version":3,"file":"enrolpage.min.js","sources":["../src/enrolpage.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/enrolpage\n * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/templates',\n    'core/notification',\n    'core_message/message_user_button',\n    'core/custom_interaction_events',\n    'core_message/message_drawer_helper',\n], function(\n    $,\n    Ajax,\n    Templates,\n    Notification,\n    Messageuserbutton,\n    CustomEvents,\n    MessageDrawerHelper) {\n    const linkcoursecontent = '#linkcoursecontent';\n    // Const activeloading = \".loading.active\";\n    const activeloadingpane = \".tab-pane.active.loading\";\n    const loadingnavlink = \".nav-link.loading\";\n    const tabpanearea = \".tab-pane-area\";\n    const enrolinstructorscount = \"#enrol_instructorscount\";\n    const enrollnowbtnform = \"#enroll-now-btn-form\";\n    const enrolbtn = \".enroll-btn-wrapper a.btn\";\n    const showenrollbtn = 'show-enrol-option-btn';\n    const hideenrollbtn = 'hide-enrol-option-btn';\n    const enrollbtnupddropdown = '.enroll-btn-upd-dropdown';\n    const cancelenrolldropdownbtn = '.cancel-enroll-dropdown-btn';\n    const defaultpricing = '.default-pricing-section';\n    const custompricetextinput = '#custompricetext';\n    const enabledefaultpricing = '#enable-default-pricing';\n    const custompricebox = '#custom-price-box';\n    const enrolbtnurl = '#enrolbtnurl';\n    const displayException = (ex) => {\n        console.error(ex);\n    };\n\n    const activateContentLoading = (_thispane) => {\n        var serviceName = $(_thispane).attr(\"data-service\");\n        var templateName = $(_thispane).attr(\"data-template\");\n        if (serviceName) {\n            var autoservice = Ajax.call([{\n                methodname: serviceName,\n                args: {courseid: M.cfg.courseId}\n            }]);\n            autoservice[0].done(function(response) {\n                response = JSON.parse(response);\n                Templates.renderForPromise(templateName, response)\n                    .then(({html, js}) => {\n                        $(_thispane).find(tabpanearea).empty();\n                        Templates.appendNodeContents(_thispane, html, js);\n                        $('.nav-link[href=\"#' + $(_thispane).attr('id') + '\"]').removeClass('loading');\n                        $(_thispane).removeClass('loading');\n                    }).catch(ex => displayException(ex));\n            }).fail(Notification.exception);\n        }\n    };\n\n    // Add functionality to update the enroll now button\n    const updateEnrollNowBtn = (title, link, customprice) => {\n        Ajax.call([{\n            methodname: 'theme_remui_enrol_page_action',\n            args: {\n                action: \"update_enroll_now_btn\",\n                config: JSON.stringify({\n                    'courseid': M.cfg.courseId,\n                    'title': title,\n                    'link': link,\n                    'customprice': customprice\n                })\n            },\n            done: function(response) {\n                var data = JSON.parse(response);\n\n                $(enrolbtn).html(data.buttontext);\n                // $(enrolbtn).attr('href',data.buttonlink);\n\n                if (data.customprice) {\n                    $(custompricebox).removeClass(\"d-none\");\n                    $(custompricebox + \" .pricing--price\").html(data.customprice);\n                    $(defaultpricing).addClass(\"disabled\");\n                } else {\n                    $(custompricebox).addClass(\"d-none\");\n                    $(defaultpricing).removeClass(\"disabled\");\n                }\n            },\n            fail: function (ex) {\n                Notification.exception(ex);\n            }\n        }]);\n\n    };\n\n    const clearCustomPriceAndLink = () => {\n        Ajax.call([{\n            methodname: 'theme_remui_enrol_page_action',\n            args: {\n                action: \"clear_ustomprice_and_link\",\n                config: JSON.stringify({\n                    'courseid': M.cfg.courseId,\n                })\n            },\n            done: function(response) {\n                var data = JSON.parse(response);\n                console.log(data);\n                $(custompricebox).addClass(\"d-none\");\n                $(custompricebox + \" .pricing--price\").text(\"\");\n                $(defaultpricing).removeClass(\"disabled\");\n\n                $(custompricetextinput).val(\"\");\n                $(enrolbtnurl).val(\"#\");\n            },\n            fail: function (ex) {\n                Notification.exception(ex);\n            }\n        }]);\n    };\n\n    // Add functionality to show/hide the enroll option\n    const updateenrolloption = (status) => {\n        Ajax.call([{\n            methodname: 'theme_remui_enrol_page_action',\n            args: {\n                action: \"update_enroll_option\",\n                config: JSON.stringify({\n                    'courseid': M.cfg.courseId,\n                    'enrolloptionshidden': status\n                })\n            },\n            done: function(response) {\n                var data = JSON.parse(response);\n                if(data.enrolloptionshidden){\n                    $('.'+hideenrollbtn).removeClass('d-flex').addClass('d-none');\n                    $('.'+showenrollbtn).removeClass('d-none').addClass('d-flex');\n                    $('.enrol-main-area-wrapper').addClass('d-none');\n                    $('.enrol-mainarea-hidden-contentainer').removeClass('d-none');\n                }else{\n                    $('.'+showenrollbtn).removeClass('d-flex').addClass('d-none');\n                    $('.'+hideenrollbtn).removeClass('d-none').addClass('d-flex');\n                    $('.enrol-main-area-wrapper').removeClass('d-none');\n                    $('.enrol-mainarea-hidden-contentainer').addClass('d-none');\n                }\n            },\n            fail: function (ex) {\n                Notification.exception(ex);\n            }\n        }]);\n\n    };\n\n    const registerCommonEvents = () =>{\n        $(enrolinstructorscount).click(function(e){\n            $('a[href=\"#linkinstructors\"]').tab('show');\n        });\n        $(enrollnowbtnform).submit(function(event) {\n            // Prevent the default form submission\n            event.preventDefault();\n            var buttontext = $(this).find('#enrolbtntext').val();\n            var buttonurl = $(this).find('#enrolbtnurl').val();\n            var customprice = $(this).find(custompricetextinput).val();\n            updateEnrollNowBtn(buttontext, buttonurl, customprice);\n            $(enrollbtnupddropdown).removeClass('show');\n        });\n\n        $(enabledefaultpricing).on('click', function() {\n            clearCustomPriceAndLink();\n        });\n\n        // $(custompricetextinput).on('input', function() {\n        //     let value = $(this).val();\n        //     if (value.length > 17) {\n        //         $(this).val(value.slice(0, 17));\n        //     }\n        // });\n\n        $(enrollbtnupddropdown).on('click.bs.dropdown', function(e) {\n            e.stopPropagation();\n        });\n\n        $(cancelenrolldropdownbtn).on('click', function() {\n            $(enrollbtnupddropdown).removeClass('show');\n        });\n\n        $('.' + showenrollbtn + ', .' + hideenrollbtn).on('click', function (e) {\n            e.preventDefault();\n            // Check the class of the clicked button\n            if ($(this).hasClass(showenrollbtn)) {\n                updateenrolloption(false);\n\n            } else if ($(this).hasClass(hideenrollbtn)) {\n                updateenrolloption(true);\n            }\n          });\n\n        // Handle messagin feature in instructor tab.\n        $(document).on('click','.enrol-instructor-msg-btn',  function (e) {\n            var element = $(this);\n            if($(this).hasClass('active')){\n                MessageDrawerHelper.hide();\n                $(this).removeClass('active');\n            }\n            else{\n                $('.enrol-instructor-msg-btn').removeClass('active');\n                $(this).addClass('active');\n                var args = {\n                    conversationid: parseInt(element.attr('data-conversationid')),\n                    buttonid: element.attr('id'),\n                    userid: parseInt(element.attr('data-userid'))\n                };\n                if (args.conversationid) {\n                    MessageDrawerHelper.showConversation(args);\n                } else {\n                    MessageDrawerHelper.createConversationWithUser(args);\n                }\n            }\n        });\n         // Pause video when the modal is closed\n        $(document).on('click','.modal-close-btn, .modal', function () {\n            var video = document.getElementById('customfieldinfovideo');\n            video.pause();\n            video.currentTime = 0;\n        });\n    };\n    return {\n        init: function() {\n            $(document).ready(function() {\n                activateContentLoading(activeloadingpane);\n                $(document).on('click', loadingnavlink, function() {\n                    var loadContentForPane = $(this).attr(\"href\");\n                    activateContentLoading(loadContentForPane);\n                });\n            });\n            registerCommonEvents();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","Notification","Messageuserbutton","CustomEvents","MessageDrawerHelper","showenrollbtn","hideenrollbtn","activateContentLoading","_thispane","serviceName","attr","templateName","call","methodname","args","courseid","M","cfg","courseId","done","response","JSON","parse","renderForPromise","then","_ref","html","js","find","empty","appendNodeContents","removeClass","catch","ex","console","error","displayException","fail","exception","updateenrolloption","status","action","config","stringify","enrolloptionshidden","addClass","registerCommonEvents","click","e","tab","submit","event","preventDefault","title","link","customprice","data","buttontext","custompricebox","updateEnrollNowBtn","this","val","on","log","text","stopPropagation","hasClass","document","element","hide","conversationid","parseInt","buttonid","userid","showConversation","createConversationWithUser","video","getElementById","pause","currentTime","init","ready","loadContentForPane"],"mappings":"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"}