{"version":3,"file":"blockmovehandler.min.js","sources":["../src/blockmovehandler.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n/* eslint-disable jsdoc/require-jsdoc*/\n/* eslint-disable jsdoc/require-jsdoc*/\n/* eslint-disable jsdoc/require-jsdoc*/\n/* eslint-disable no-restricted-globals */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/blockhandler\n * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/str'], function ($, Ajax, Str) {\n    /**\n * Selectors\n */\n    var SELECTOR = {\n        BLOCKCONTROLS: '.block-controls',\n        MOVETOP: '.block-controls .move-top',\n        MOVEBOTTOM: '.block-controls .move-bottom',\n        BLOCK: 'section.block'\n    };\n\n    // Blockregions is comming from data_for _js from php\n\n    var blockregionarr = {};\n\n    var blockregionidarr = [];\n\n    var currentelement = '';\n    var nextelement = '';\n    var prevelement = '';\n    var currentelementid = '';\n    var movingelementid = '';\n    var curentregion = '';\n    var previousregion = '';\n    var nextregion = '';\n    var regionlastblock = '';\n    var regionfirstblock = '';\n    const noblockregion = 'noblockregion';\n    const swapdirectonup = 'up';\n    const swapdirectondown = 'down';\n    const notfound = 'na';\n    const firstblock = 'firstblock';\n    const lastblock = 'lastblock';\n    const sidepreregion = '#block-region-side-pre';\n\n    const getCurrentBlockRegion = (clickedElement) => {\n        for (var i = 0; i < blockregionidarr.length; i++) {\n            if (clickedElement.closest(blockregionidarr[i]).length) {\n                return blockregionidarr[i];\n                break;\n            }\n        }\n        return noblockregion;\n    };\n\n    const getBlockInRegion = (blockregion, blockorder) => {\n        var regionBlock = 'blocknotfound';\n        if (blockorder == lastblock) {\n            if ($(blockregion).children('.block').length > 0) {\n                regionBlock = $(blockregion).children(\".block:last\");\n            }\n        }\n        if (blockorder == firstblock) {\n            if ($(blockregion).children('.block').length > 0) {\n                regionBlock = $(blockregion).children(\".block:first\");\n            }\n        }\n        return regionBlock;\n    };\n\n    const getRegion = (element, regiondirecton) => {\n        var region = 'noregion';\n        var index = blockregionidarr.indexOf(element);\n        if (regiondirecton == 'up') {\n            if (index > 0) {\n                var previousElement = blockregionidarr[index - 1];\n                region = previousElement;\n            }\n        }\n        if (regiondirecton == 'down') {\n            if (index > -1 && index < blockregionidarr.length - 1) {\n                var nextElement = blockregionidarr[index + 1];\n                region = nextElement;\n            }\n        }\n        return region;\n    };\n    const checkidtype = (id) => {\n        if (typeof (id) === \"undefined\") {\n            return false;\n        }\n        return true;\n    };\n\n    const swapBlocks = ($block1, $block2) => {\n        var block1clone = $block1.clone();\n        var block2clone = $block2.clone();\n        $block1.replaceWith(block2clone);\n        $block2.replaceWith(block1clone);\n    };\n\n    const transparentheaderhanlder = () => {\n        var transparentheader = false;\n        if ($('.navbar').hasClass('trasnparent-home-nav')) {\n            transparentheader = true;\n        }\n        $(\"body.pagelayout-frontpage\").removeClass(\"transparent-header\");\n        if (transparentheader) {\n            var windowtop = $(window).scrollTop();\n            if (windowtop < 45) {\n                var hasedwcarouselclass = $('#block-region-full-width-top').children().first().find('div').hasClass('edw-carousel');\n                var hascarouselclass = $('#block-region-full-width-top').children().first().find('div').hasClass('carousel');\n                var hastestimonial = false;\n                var hashomepagetestimonial = $('#block-region-full-width-top').children().first().find('section').hasClass('section-testimonial');\n                if (hasedwcarouselclass) {\n                    var firstChild = $('#block-region-full-width-top').children().first();\n                    var divWithCarouselClass = firstChild.find('div.edw-carousel');\n                    var idAttribute = divWithCarouselClass.attr('id');\n                    if (idAttribute && idAttribute.indexOf('testimonial') !== -1) {\n                        hastestimonial = true;\n                    }\n\n                }\n                if (((hascarouselclass || hasedwcarouselclass) && !hashomepagetestimonial && !hastestimonial) && $(\".old-frontpage\").length === 0 ) {\n                    $(\"body.pagelayout-frontpage\").addClass(\"transparent-header\");\n                }\n                if ($('.old-frontpage .frontpage-sections #edwiser-slider').children().first().hasClass('carousel')) {\n                    $(\"body.pagelayout-frontpage\").addClass(\"transparent-header\");\n                }\n                return;\n            }\n            $(\"body.pagelayout-frontpage\").removeClass(\"transparent-header\");\n        }\n    };\n\n    const registerCommonEvents = () => {\n        $(document).on('click', SELECTOR.MOVETOP, function () {\n            currentelement = $(this).closest(SELECTOR.BLOCK);\n            prevelement = currentelement.prevAll('.block:first');\n            currentelementid = checkidtype(currentelement.attr('data-instance-id')) ? currentelement.attr('data-instance-id') : 'na';\n            movingelementid = checkidtype(prevelement.attr('data-instance-id')) ? prevelement.attr('data-instance-id') : 'na';\n            curentregion = getCurrentBlockRegion(currentelement);\n            if (movingelementid == notfound && curentregion != sidepreregion) {\n                if (curentregion != noblockregion) {\n                    previousregion = getRegion(curentregion, swapdirectonup);\n                    regionlastblock = getBlockInRegion(previousregion, lastblock);\n                    if (previousregion != 'noregion') {\n                        if (regionlastblock != 'blocknotfound') {\n                            movingelementid = checkidtype(regionlastblock.attr('data-instance-id')) ? regionlastblock.attr('data-instance-id') : 'na';\n                            blockmover(currentelementid, movingelementid, 'move', blockregionarr[previousregion], true, 'moveblockup');\n                        } else {\n                            blockmover(currentelementid, movingelementid, 'move', blockregionarr[previousregion], false, 'moveblockup');\n                        }\n                    }\n                }\n            } else {\n                blockmover(currentelementid, movingelementid, swapdirectonup, blockregionarr[curentregion]);\n            }\n        });\n\n        $(document).on('click', SELECTOR.MOVEBOTTOM, function () {\n            currentelement = $(this).closest(SELECTOR.BLOCK);\n            nextelement = currentelement.nextAll('.block:first');\n            currentelementid = checkidtype(currentelement.attr('data-instance-id')) ? currentelement.attr('data-instance-id') : 'na';\n            movingelementid = checkidtype(nextelement.attr('data-instance-id')) ? nextelement.attr('data-instance-id') : 'na';\n            curentregion = getCurrentBlockRegion(currentelement);\n            if (movingelementid == notfound && curentregion != sidepreregion) {\n                if (curentregion != noblockregion ) {\n                    nextregion = getRegion(curentregion, swapdirectondown);\n                    regionfirstblock = getBlockInRegion(nextregion, firstblock);\n                    if (nextregion != 'noregion') {\n                        if (regionfirstblock != 'blocknotfound') {\n                            movingelementid = checkidtype(regionfirstblock.attr('data-instance-id')) ? regionfirstblock.attr('data-instance-id') : 'na';\n                            blockmover(currentelementid, movingelementid, 'move', blockregionarr[nextregion], true, 'moveblockdown');\n                        } else {\n                            blockmover(currentelementid, movingelementid, 'move', blockregionarr[nextregion], false, 'moveblockdown');\n                        }\n                    }\n                }\n            } else {\n                blockmover(currentelementid, movingelementid, swapdirectondown, blockregionarr[curentregion]);\n            }\n        });\n    };\n\n    const blockmover = (currentelementid, moveelementid, type, blockregion = 'noregion', blockfoundflag = false, blockmovedirection = false) => {\n        Ajax.call([{\n            methodname: 'theme_remui_set_block_pos',\n            args: {\n                currentblockid: currentelementid,\n                movingblockid: moveelementid,\n                region: blockregion,\n                blockfoundstatus: blockfoundflag,\n                operationtype: type,\n                movedirection: blockmovedirection,\n                contextid: M.cfg.contextid\n            },\n            done: function (data) {\n                if (data) {\n                    if (type == swapdirectonup) {\n                        swapBlocks(currentelement, prevelement);\n                        console.log(\"swapping done sucessfully\");\n                    }\n                    if (type == swapdirectondown) {\n                        swapBlocks(currentelement, nextelement);\n                        console.log(\"swapping done sucessfully\");\n                    }\n                    if (type == 'move') {\n                        if (blockmovedirection == 'moveblockup') {\n                            currentelement.detach().appendTo(`[data-blockregion=\"${blockregion}\"]`);\n                            console.log(\"moveblockup\");\n                        }\n                        if (blockmovedirection == 'moveblockdown') {\n                            currentelement.detach().prependTo(`[data-blockregion=\"${blockregion}\"]`);\n                            console.log(\"moveblockdown\");\n                        }\n                    }\n                    transparentheaderhanlder();\n                } else {\n                    console.log(\"not allowed\");\n                }\n            },\n            fail: function () {\n                console.log(Notification.exception);\n            }\n        }]);\n    };\n    return {\n        init: function () {\n            availableblockregions.forEach(function (element, index) {\n                blockregionarr[`#block-region-${element}`] = element;\n                blockregionidarr[index] = `#block-region-${element}`;\n            });\n            var secondArrayFixedOrder = [\n                \"#block-region-full-width-top\",\n                \"#block-region-side-top\",\n                \"#block-region-content\",\n                \"#block-region-side-bottom\",\n                \"#block-region-full-bottom\"\n              ];\n              blockregionidarr.sort(function(a, b) {\n                var aIndex = secondArrayFixedOrder.indexOf(a);\n                var bIndex = secondArrayFixedOrder.indexOf(b);\n                return aIndex - bIndex;\n              });\n            registerCommonEvents();\n        },\n    };\n});\n"],"names":["define","$","Ajax","Str","SELECTOR","blockregionarr","blockregionidarr","currentelement","nextelement","prevelement","currentelementid","movingelementid","curentregion","previousregion","nextregion","regionlastblock","regionfirstblock","getCurrentBlockRegion","clickedElement","i","length","closest","getBlockInRegion","blockregion","blockorder","regionBlock","children","getRegion","element","regiondirecton","region","index","indexOf","checkidtype","id","swapBlocks","$block1","$block2","block1clone","clone","block2clone","replaceWith","transparentheaderhanlder","transparentheader","hasClass","removeClass","window","scrollTop","hasedwcarouselclass","first","find","hascarouselclass","hastestimonial","hashomepagetestimonial","idAttribute","attr","addClass","registerCommonEvents","document","on","this","prevAll","blockmover","nextAll","moveelementid","type","blockfoundflag","blockmovedirection","call","methodname","args","currentblockid","movingblockid","blockfoundstatus","operationtype","movedirection","contextid","M","cfg","done","data","console","log","detach","appendTo","prependTo","fail","Notification","exception","init","availableblockregions","forEach","secondArrayFixedOrder","sort","a","b"],"mappings":";;;;;AA4BAA,sCAAO,CAAC,SAAU,YAAa,aAAa,SAAUC,EAAGC,KAAMC,SAIvDC,iBAES,4BAFTA,oBAGY,+BAHZA,eAIO,gBAKPC,eAAiB,GAEjBC,iBAAmB,GAEnBC,eAAiB,GACjBC,YAAc,GACdC,YAAc,GACdC,iBAAmB,GACnBC,gBAAkB,GAClBC,aAAe,GACfC,eAAiB,GACjBC,WAAa,GACbC,gBAAkB,GAClBC,iBAAmB,SASjBC,sBAAyBC,qBACtB,IAAIC,EAAI,EAAGA,EAAIb,iBAAiBc,OAAQD,OACrCD,eAAeG,QAAQf,iBAAiBa,IAAIC,cACrCd,iBAAiBa,SAXd,iBAkBhBG,iBAAmB,CAACC,YAAaC,kBAC/BC,YAAc,sBAdJ,aAeVD,YACIvB,EAAEsB,aAAaG,SAAS,UAAUN,OAAS,IAC3CK,YAAcxB,EAAEsB,aAAaG,SAAS,gBAlB/B,cAqBXF,YACIvB,EAAEsB,aAAaG,SAAS,UAAUN,OAAS,IAC3CK,YAAcxB,EAAEsB,aAAaG,SAAS,iBAGvCD,aAGLE,UAAY,CAACC,QAASC,sBACpBC,OAAS,WACTC,MAAQzB,iBAAiB0B,QAAQJ,SACf,MAAlBC,iBACIE,MAAQ,IAERD,OADsBxB,iBAAiByB,MAAQ,KAIjC,QAAlBF,iBACIE,OAAS,GAAKA,MAAQzB,iBAAiBc,OAAS,IAEhDU,OADkBxB,iBAAiByB,MAAQ,YAI5CD,QAELG,YAAeC,SACG,IAARA,GAMVC,WAAa,CAACC,QAASC,eACrBC,YAAcF,QAAQG,QACtBC,YAAcH,QAAQE,QAC1BH,QAAQK,YAAYD,aACpBH,QAAQI,YAAYH,cAGlBI,yBAA2B,SACzBC,mBAAoB,KACpB1C,EAAE,WAAW2C,SAAS,0BACtBD,mBAAoB,GAExB1C,EAAE,6BAA6B4C,YAAY,sBACvCF,kBAAmB,IACH1C,EAAE6C,QAAQC,YACV,GAAI,KACZC,oBAAsB/C,EAAE,gCAAgCyB,WAAWuB,QAAQC,KAAK,OAAON,SAAS,gBAChGO,iBAAmBlD,EAAE,gCAAgCyB,WAAWuB,QAAQC,KAAK,OAAON,SAAS,YAC7FQ,gBAAiB,EACjBC,uBAAyBpD,EAAE,gCAAgCyB,WAAWuB,QAAQC,KAAK,WAAWN,SAAS,0BACvGI,oBAAqB,KAGjBM,YAFarD,EAAE,gCAAgCyB,WAAWuB,QACxBC,KAAK,oBACJK,KAAK,MACxCD,cAAuD,IAAxCA,YAAYtB,QAAQ,iBACnCoB,gBAAiB,UAInBD,mBAAoBH,qBAAyBK,wBAA2BD,gBAAkD,IAA/BnD,EAAE,kBAAkBmB,QACjHnB,EAAE,6BAA6BuD,SAAS,2BAExCvD,EAAE,sDAAsDyB,WAAWuB,QAAQL,SAAS,aACpF3C,EAAE,6BAA6BuD,SAAS,uBAIhDvD,EAAE,6BAA6B4C,YAAY,wBAI7CY,qBAAuB,KACzBxD,EAAEyD,UAAUC,GAAG,QAASvD,kBAAkB,WACtCG,eAAiBN,EAAE2D,MAAMvC,QAAQjB,gBACjCK,YAAcF,eAAesD,QAAQ,gBACrCnD,iBAAmBuB,YAAY1B,eAAegD,KAAK,qBAAuBhD,eAAegD,KAAK,oBAAsB,KACpH5C,gBAAkBsB,YAAYxB,YAAY8C,KAAK,qBAAuB9C,YAAY8C,KAAK,oBAAsB,KAC7G3C,aAAeK,sBAAsBV,gBArG5B,MAsGLI,iBAnGU,0BAmGqBC,aAzGrB,iBA0GNA,eACAC,eAAiBc,UAAUf,aA1GpB,MA2GPG,gBAAkBO,iBAAiBT,eAvGjC,aAwGoB,YAAlBA,iBACuB,iBAAnBE,iBACAJ,gBAAkBsB,YAAYlB,gBAAgBwC,KAAK,qBAAuBxC,gBAAgBwC,KAAK,oBAAsB,KACrHO,WAAWpD,iBAAkBC,gBAAiB,OAAQN,eAAeQ,iBAAiB,EAAM,gBAE5FiD,WAAWpD,iBAAkBC,gBAAiB,OAAQN,eAAeQ,iBAAiB,EAAO,iBAKzGiD,WAAWpD,iBAAkBC,gBAtHlB,KAsHmDN,eAAeO,kBAIrFX,EAAEyD,UAAUC,GAAG,QAASvD,qBAAqB,WACzCG,eAAiBN,EAAE2D,MAAMvC,QAAQjB,gBACjCI,YAAcD,eAAewD,QAAQ,gBACrCrD,iBAAmBuB,YAAY1B,eAAegD,KAAK,qBAAuBhD,eAAegD,KAAK,oBAAsB,KACpH5C,gBAAkBsB,YAAYzB,YAAY+C,KAAK,qBAAuB/C,YAAY+C,KAAK,oBAAsB,KAC7G3C,aAAeK,sBAAsBV,gBA7H5B,MA8HLI,iBA3HU,0BA2HqBC,aAjIrB,iBAkINA,eACAE,WAAaa,UAAUf,aAjId,QAkITI,iBAAmBM,iBAAiBR,WAhIjC,cAiIe,YAAdA,aACwB,iBAApBE,kBACAL,gBAAkBsB,YAAYjB,iBAAiBuC,KAAK,qBAAuBvC,iBAAiBuC,KAAK,oBAAsB,KACvHO,WAAWpD,iBAAkBC,gBAAiB,OAAQN,eAAeS,aAAa,EAAM,kBAExFgD,WAAWpD,iBAAkBC,gBAAiB,OAAQN,eAAeS,aAAa,EAAO,mBAKrGgD,WAAWpD,iBAAkBC,gBA7IhB,OA6ImDN,eAAeO,mBAKrFkD,WAAa,SAACpD,iBAAkBsD,cAAeC,UAAM1C,mEAAc,WAAY2C,uEAAwBC,2EACzGjE,KAAKkE,KAAK,CAAC,CACPC,WAAY,4BACZC,KAAM,CACFC,eAAgB7D,iBAChB8D,cAAeR,cACflC,OAAQP,YACRkD,iBAAkBP,eAClBQ,cAAeT,KACfU,cAAeR,mBACfS,UAAWC,EAAEC,IAAIF,WAErBG,KAAM,SAAUC,MACRA,MAhKO,MAiKHf,OACA9B,WAAW5B,eAAgBE,aAC3BwE,QAAQC,IAAI,8BAlKP,QAoKLjB,OACA9B,WAAW5B,eAAgBC,aAC3ByE,QAAQC,IAAI,8BAEJ,QAARjB,OAC0B,eAAtBE,qBACA5D,eAAe4E,SAASC,sCAA+B7D,mBACvD0D,QAAQC,IAAI,gBAEU,iBAAtBf,qBACA5D,eAAe4E,SAASE,uCAAgC9D,mBACxD0D,QAAQC,IAAI,mBAGpBxC,4BAEAuC,QAAQC,IAAI,gBAGpBI,KAAM,WACFL,QAAQC,IAAIK,aAAaC,sBAI9B,CACHC,KAAM,WACFC,sBAAsBC,SAAQ,SAAU/D,QAASG,OAC7C1B,uCAAgCuB,UAAaA,QAC7CtB,iBAAiByB,+BAA0BH,gBAE3CgE,sBAAwB,CACxB,+BACA,yBACA,wBACA,4BACA,6BAEFtF,iBAAiBuF,MAAK,SAASC,EAAGC,UACnBH,sBAAsB5D,QAAQ8D,GAC9BF,sBAAsB5D,QAAQ+D,MAG/CtC"}