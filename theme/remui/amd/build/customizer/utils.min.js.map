{"version":3,"file":"utils.min.js","sources":["../../src/customizer/utils.js"],"sourcesContent":["/* eslint-disable no-console */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Theme customizer utils js\n * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    Yogesh Shirsath\n */\n\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Fragment from 'core/fragment';\nimport 'core/modal_save_cancel';\n\n/**\n * Selectors\n */\nvar SELECTOR = {\n    COMPONENT: 'theme_remui',\n    FORMLABEL: '.col-form-label',\n    HMTLEDITOR: 'customizer_htmleditor',\n    CONTROLS: '#customize-controls',\n    IFRAME: '#customizer-frame',\n    WRAP: '#customizer-wrap',\n    IFRAME_OVERLAY: '#preview-overlay'\n};\n\n/**\n * Promises list.\n */\nvar PROMISES = {\n    /**\n     * Get file url using itemid\n     * @param {number} itemid Item id\n     * @return {Promise}\n     */\n    GET_FILE_URL: function(itemid) {\n        return Ajax.call([{\n            methodname: 'theme_remui_customizer_get_file_from_setting',\n            args: {\n                itemid: itemid\n            }\n        }])[0];\n    }\n};\n\n/**\n * Device widths\n */\nvar deviceWidth = {\n    sm: 540,\n    md: 800,\n};\n\n/**\n * Get contentDocument of iframe\n * @return {DOM} contentDocument\n */\nfunction getDocument() {\n    return $(SELECTOR.IFRAME)[0].contentDocument;\n}\n\n/**\n * Get contentWindow of iframe\n * @return {DOM} contentWindow\n */\nfunction getWindow() {\n    return $(SELECTOR.IFRAME)[0].contentWindow;\n}\n\n/**\n * Put style in style tag.\n * @param {String} id      Id for style tag\n * @param {String} content Style content\n */\nfunction putStyle(id, content) {\n    id += '_style';\n    let bodyDOM = $(getDocument()).find('body');\n\n    if ($(bodyDOM).find('#' + id).length == 0) {\n        $(bodyDOM).append(`<style id=\"${id}\"></style>`);\n    }\n    $(bodyDOM).find('#' + id).html(content);\n}\n\n/**\n * Load font on iframe.\n * @param {string} fontName Font name\n */\nfunction loadFont(fontName) {\n    let id = fontName.replace(' ', '');\n    id += '_js';\n    let bodyDOM = $(getDocument()).find('body');\n    if ($(bodyDOM).find('#' + id).length != 0) {\n        return;\n    }\n    let js = document.createElement('script');\n    js.type = 'text/javascript';\n    js.id = id;\n    js.textContent = `require(['theme_remui/webfont'], function(webFont) {\n        webFont.load({\n            google: {\n                families: ['${fontName}:100,200,300,400,500,600,700,800,900']\n            }\n        });\n    });`;\n    $(bodyDOM).append(js);\n}\n\n/**\n * Put Jscode in script tag.\n * @param {String} id      Id for js tag\n * @param {String} content Js content\n */\nfunction putJs(id, content) {\n    id += '_js';\n    let bodyDOM = $(getDocument()).find('body');\n    let js = document.createElement('script');\n    js.type = 'text/javascript';\n    js.id = id;\n    js.textContent = content;\n    if ($(bodyDOM).find('#' + id).length != 0) {\n        $(bodyDOM).find('#' + id).remove();\n    }\n    $(bodyDOM).append(js);\n}\n\n/**\n * Get file user from itemid\n * @param {Number} itemid file itemid\n * @return {Promise}\n */\nfunction getFileURL(itemid) {\n    return PROMISES.GET_FILE_URL(itemid).fail(Notification.exception);\n}\n\n/**\n * File observer.\n * @param {DOM} targetNode Node on which observer will be applied\n * @param {function} callBack Callback method\n */\nfunction fileObserver(targetNode, callBack) {\n    // Create an observer instance linked to the callback function\n    const observer = new MutationObserver(function() {\n        $(SELECTOR.CONTROLS).data('unsaved', true);\n        callBack();\n    });\n\n    // Start observing the target node for configured mutations\n    observer.observe(targetNode, {\n        attributes: true,\n        attributeFilter: ['class'],\n        childList: false,\n        characterData: false\n    });\n}\n\n/**\n * Show loader.\n */\nfunction showLoader() {\n    $(SELECTOR.IFRAME_OVERLAY).show();\n}\n\n/**\n * Hide loader/\n */\nfunction hideLoader() {\n    $(SELECTOR.IFRAME_OVERLAY).hide();\n}\n\n/**\n * Expand html editor in modal to get more area.\n * @param {String} name Setting name.\n */\nfunction htmlEditorExpand(name) {\n    $(`#fitem_id_${name} .icon-expand`).on('click', function() {\n        let content = $(`#id_${name}`).val();\n        ModalFactory.create({\n            title: $(`#fitem_id_${name} ${SELECTOR.FORMLABEL}`).text(),\n            body: Fragment.loadFragment(SELECTOR.COMPONENT, SELECTOR.HMTLEDITOR, 1, {\n                content: content\n            }),\n            type: ModalFactory.types.SAVE_CANCEL\n        }, $('#create')).done(function(modal) {\n            modal.show();\n            $(modal.getModal()).addClass('modal-lg');\n            var root = modal.getRoot();\n            root.on(ModalEvents.save, function(event) {\n                event.preventDefault();\n                content = $(`#${SELECTOR.COMPONENT}_${SELECTOR.HMTLEDITOR}`).val();\n                $(`#id_${name}`).val(content).trigger('change');\n                $(`#id_${name}editable`).html(content);\n                modal.hide();\n            });\n\n            // Destroy modal on hidden.\n            root.on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n        });\n    });\n}\n\n/**\n * Trigger resize event on iframe.\n */\nfunction triggerResize() {\n    getWindow().dispatchEvent(new Event('resize'));\n}\n\nexport default {\n    putStyle,\n    putJs,\n    loadFont,\n    getDocument,\n    getWindow,\n    deviceWidth,\n    getFileURL,\n    fileObserver,\n    showLoader,\n    hideLoader,\n    htmlEditorExpand,\n    triggerResize\n};\n"],"names":["SELECTOR","PROMISES","itemid","Ajax","call","methodname","args","getDocument","contentDocument","getWindow","contentWindow","putStyle","id","content","bodyDOM","find","length","append","html","putJs","js","document","createElement","type","textContent","remove","loadFont","fontName","replace","deviceWidth","sm","md","getFileURL","fail","Notification","exception","fileObserver","targetNode","callBack","MutationObserver","data","observe","attributes","attributeFilter","childList","characterData","showLoader","show","hideLoader","hide","htmlEditorExpand","name","on","val","create","title","text","body","Fragment","loadFragment","ModalFactory","types","SAVE_CANCEL","done","modal","getModal","addClass","root","getRoot","ModalEvents","save","event","preventDefault","trigger","hidden","destroy","triggerResize","dispatchEvent","Event"],"mappings":";;;;;;+WAkCIA,mBACW,cADXA,mBAEW,kBAFXA,oBAGY,wBAHZA,kBAIU,sBAJVA,gBAKQ,oBALRA,wBAOgB,mBAMhBC,sBAMc,SAASC,eACZC,cAAKC,KAAK,CAAC,CACdC,WAAY,+CACZC,KAAM,CACFJ,OAAQA,WAEZ,aAgBHK,qBACE,mBAAEP,iBAAiB,GAAGQ,yBAOxBC,mBACE,mBAAET,iBAAiB,GAAGU,2BAgJlB,CACXC,kBAzIcC,GAAIC,SAClBD,IAAM,aACFE,SAAU,mBAAEP,eAAeQ,KAAK,QAEI,IAApC,mBAAED,SAASC,KAAK,IAAMH,IAAII,4BACxBF,SAASG,4BAAqBL,sCAElCE,SAASC,KAAK,IAAMH,IAAIM,KAAKL,UAmI/BM,eAnGWP,GAAIC,SACfD,IAAM,UACFE,SAAU,mBAAEP,eAAeQ,KAAK,QAChCK,GAAKC,SAASC,cAAc,UAChCF,GAAGG,KAAO,kBACVH,GAAGR,GAAKA,GACRQ,GAAGI,YAAcX,QACuB,IAApC,mBAAEC,SAASC,KAAK,IAAMH,IAAII,4BACxBF,SAASC,KAAK,IAAMH,IAAIa,6BAE5BX,SAASG,OAAOG,KA0FlBM,kBA7HcC,cACVf,GAAKe,SAASC,QAAQ,IAAK,IAC/BhB,IAAM,UACFE,SAAU,mBAAEP,eAAeQ,KAAK,WACI,IAApC,mBAAED,SAASC,KAAK,IAAMH,IAAII,kBAG1BI,GAAKC,SAASC,cAAc,UAChCF,GAAGG,KAAO,kBACVH,GAAGR,GAAKA,GACRQ,GAAGI,uJAGuBG,4GAIxBb,SAASG,OAAOG,KA6GlBb,YAAAA,YACAE,UAAAA,UACAoB,YAxKc,CACdC,GAAI,IACJC,GAAI,KAuKJC,oBAtFgB9B,eACTD,sBAAsBC,QAAQ+B,KAAKC,sBAAaC,YAsFvDC,sBA9EkBC,WAAYC,UAEb,IAAIC,kBAAiB,+BAChCvC,mBAAmBwC,KAAK,WAAW,GACrCF,cAIKG,QAAQJ,WAAY,CACzBK,YAAY,EACZC,gBAAiB,CAAC,SAClBC,WAAW,EACXC,eAAe,KAmEnBC,0CA3DE9C,yBAAyB+C,QA4D3BC,0CArDEhD,yBAAyBiD,QAsD3BC,0BA/CsBC,8CACPA,uBAAqBC,GAAG,SAAS,eACxCvC,SAAU,iCAASsC,OAAQE,6BAClBC,OAAO,CAChBC,OAAO,uCAAeJ,iBAAQnD,qBAAsBwD,OACpDC,KAAMC,kBAASC,aAAa3D,mBAAoBA,oBAAqB,EAAG,CACpEa,QAASA,UAEbU,KAAMqC,uBAAaC,MAAMC,cAC1B,mBAAE,YAAYC,MAAK,SAASC,OAC3BA,MAAMjB,2BACJiB,MAAMC,YAAYC,SAAS,gBACzBC,KAAOH,MAAMI,UACjBD,KAAKf,GAAGiB,sBAAYC,MAAM,SAASC,OAC/BA,MAAMC,iBACN3D,SAAU,8BAAMb,+BAAsBA,sBAAuBqD,wCACpDF,OAAQE,IAAIxC,SAAS4D,QAAQ,4CAC7BtB,kBAAgBjC,KAAKL,SAC9BmD,MAAMf,UAIVkB,KAAKf,GAAGiB,sBAAYK,QAAQ,WACxBV,MAAMW,oBAyBlBC,yBAfAnE,YAAYoE,cAAc,IAAIC,MAAM"}