{"version":3,"file":"floating_add_block_handler.min.js","sources":["../src/floating_add_block_handler.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n/* eslint-disable jsdoc/require-jsdoc*/\n/* eslint-disable jsdoc/require-jsdoc*/\n/* eslint-disable jsdoc/require-jsdoc*/\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/floating_add_block_handler\n * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/toast'], function($, Ajax, Toast) {\n    /**\n     * Selectors\n     */\n    var SELECTOR = {\n        ADDBLOCKFLOATMENU: '#add-block-float-menu ',\n        ADDBLOCKSPLITICONBTN: '#add-block-float-menu .add-block-split-icon-btn',\n        FLOATADDBLOCKBUTTON: '#add-block-float-menu .floating-add-block-button',\n        DNONE: 'd-none'\n    };\n    var elements = ['.side-pre-link', '.side-bottom-link', '.side-top-link', '.content-link', '.full-width-top-link', '.full-bottom-link'];\n    var activeregionlink = '.full-width-top-link';\n    var blockregions = [];\n    var blockinviewport = [];\n    var getSelectedregion = (blocksectiondata, currentitem) => {\n        var data = '';\n        blocksectiondata.forEach(element => {\n            if ($(currentitem).attr('data-region') == element.regionid) {\n                data = element;\n                return false;\n            }\n        });\n        return data;\n    };\n    var callAllFunctions = (blocksectiondata, currentclickedelement, scroll = false) => {\n        var currentsectionlink = getSelectedregion(blocksectiondata, currentclickedelement);\n        if (scroll) {\n            scrolltoelement(currentsectionlink);\n        }\n        activeregionclassaddition(currentclickedelement);\n        getAaddblockData(currentsectionlink.regionaddblockbutton);\n    };\n\n    var getAaddblockData = (currentactiveregoninfo) => {\n        var html = $(currentactiveregoninfo).html();\n        $(SELECTOR.FLOATADDBLOCKBUTTON).attr({\n            'href': $(html).attr('href'),\n            'data-key': $(html).attr('data-key'),\n            'data-url': $(html).attr('data-url'),\n            'id': $(html).attr('id'),\n        });\n    };\n\n    var activeregionclassaddition = (currentactiveregionlink) => {\n        $(SELECTOR.ADDBLOCKFLOATMENU).find('.dropdown-item').removeClass('activeregion');\n        $(currentactiveregionlink).addClass('activeregion');\n    };\n    var scrolltoelement = (element) => {\n        var targetOffset = '';\n        if (element.regionid == '#block-region-side-pre') {\n            if (!$('.drawer-right').hasClass('show')) {\n                $('.drawer-toggler.drawer-right-toggle [data-action=\"toggle\"]').click();\n            }\n        } else {\n            targetOffset = $(`${element.regionid}-indicator`).offset().top;\n            var scrollPosition = targetOffset - ($(window).height() / 2) + ($((`${element.regionid}-indicator`)).height() / 2);\n            $(\"html, body\").animate({ scrollTop: scrollPosition }, 1000);\n        }\n        var msg = M.util.get_string('floataddblockbtnregionselectionmsg', 'theme_remui', element.regionname);\n        Toast.add(msg, {\n            delay: 3000,\n            closeButton: true,\n            type: 'warning edw_toast'\n        });\n        // $(SELECTOR.FLOATADDBLOCKBUTTON).tooltip('hide').attr('data-original-title', 'block will be added in' + ' ' + element.regionname + ' ' + 'region').tooltip('show');\n    };\n// Function to check if the element is in the viewport\nfunction isElementInViewport(elem) {\n    var $elem = $(elem);\n    var $window = $(window);\n\n    var docViewTop = $window.scrollTop();\n    var docViewBottom = docViewTop + $window.height();\n\n    var elemTop = $elem.offset().top;\n    var elemBottom = elemTop + $elem.height();\n\n    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\n}\n\n// Function to calculate the distance between two points\nfunction getDistance(x1, y1, x2, y2) {\n    var dx = x1 - x2;\n    var dy = y1 - y2;\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\nfunction isViewportAtTop() {\n    var scrollPosition = $(window).scrollTop();\n    var threshold = 10; // Adjust this threshold as needed\n\n    return scrollPosition <= threshold;\n}\n\n// Function to find the ID closest to the viewport for a given selector\nfunction findClosestID(ids) {\n    var viewportCenterX = $(window).scrollLeft() + $(window).width() / 2;\n    var viewportCenterY = $(window).scrollTop() + $(window).height() / 2;\n\n    var closestID = null;\n    var closestDistance = Infinity;\n\n    // Loop through each ID in the array\n    $.each(ids, function (index, id) {\n        var $element = $(id);\n\n        // Check if the element exists\n        if ($element.length > 0) {\n            var elementOffset = $element.offset();\n            var elementCenterX = elementOffset.left + $element.width() / 2;\n            var elementCenterY = elementOffset.top + $element.height() / 2;\n\n            var distance = getDistance(\n                viewportCenterX,\n                viewportCenterY,\n                elementCenterX,\n                elementCenterY\n            );\n\n            if (distance < closestDistance) {\n                closestDistance = distance;\n                closestID = id;\n            }\n        }\n    });\n\n    return closestID;\n}\nconst registerCommonEvents = () => {\n    $(SELECTOR.ADDBLOCKSPLITICONBTN).click(function () {\n        $(`${SELECTOR.ADDBLOCKSPLITICONBTN} .edw-icon-Down-Arrow`).toggleClass(SELECTOR.DNONE);\n        $(`${SELECTOR.ADDBLOCKSPLITICONBTN} .edw-icon-UpArrow`).toggleClass(SELECTOR.DNONE);\n    });\n\n    $(document).on(\"click\", elements[0], function () {\n        callAllFunctions(blocksectiondata, this, true);\n    });\n    $(document).on(\"click\", elements[1], function () {\n        callAllFunctions(blocksectiondata, this, true);\n    });\n    $(document).on(\"click\", elements[2], function () {\n        callAllFunctions(blocksectiondata, this, true);\n    });\n    $(document).on(\"click\", elements[3], function () {\n        callAllFunctions(blocksectiondata, this, true);\n    });\n    $(document).on(\"click\", elements[4], function () {\n        callAllFunctions(blocksectiondata, this, true);\n    });\n    $(document).on(\"click\", elements[5], function () {\n        callAllFunctions(blocksectiondata, this, true);\n    });\n\n    // $(window).on('resize scroll', function () {\n    //     blockinviewport = [];\n    //     var closestID = findClosestID(blockregions);\n    //     blockinviewport.push(closestID);\n    //     if (blockinviewport.length > 0) {\n    //         callAllFunctions(blocksectiondata, `a[data-region=\"${blockinviewport[0]}\"]`);\n    //     }\n    // });\n};\n\nreturn {\n    init: function () {\n        $(document).ready(function () {\n            // Blocksectiondata is comming from data_for_js\n            registerCommonEvents();\n            // Check if each div is in the viewport\n            blocksectiondata.forEach(function (divID) {\n                var id = divID.regionid;\n                blockregions.push(id);\n            });\n            var closestID = findClosestID(blockregions);\n            blockinviewport.push(closestID);\n            if (blockinviewport.length > 0) {\n                callAllFunctions(blocksectiondata, `a[data-region=\"${blockinviewport[0]}\"]`);\n            } else {\n                callAllFunctions(blocksectiondata, `a[data-region=#region-fullwidthtop-blocks`);\n            }\n        });\n    },\n};\n});\n"],"names":["define","$","Ajax","Toast","SELECTOR","elements","blockregions","blockinviewport","getSelectedregion","blocksectiondata","currentitem","data","forEach","element","attr","regionid","callAllFunctions","currentclickedelement","scroll","currentsectionlink","scrolltoelement","activeregionclassaddition","getAaddblockData","regionaddblockbutton","currentactiveregoninfo","html","currentactiveregionlink","find","removeClass","addClass","hasClass","click","scrollPosition","offset","top","window","height","animate","scrollTop","msg","M","util","get_string","regionname","add","delay","closeButton","type","findClosestID","ids","viewportCenterX","scrollLeft","width","viewportCenterY","closestID","closestDistance","Infinity","each","index","id","dx","dy","$element","length","elementOffset","elementCenterX","left","elementCenterY","distance","Math","sqrt","registerCommonEvents","toggleClass","document","on","this","init","ready","divID","push"],"mappings":"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"}