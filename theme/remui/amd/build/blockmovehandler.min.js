/**
 * @module     theme_remui/blockhandler
 * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_remui/blockmovehandler",["jquery","core/ajax","core/str"],(function($,Ajax,Str){var SELECTOR_MOVETOP=".block-controls .move-top",SELECTOR_MOVEBOTTOM=".block-controls .move-bottom",SELECTOR_BLOCK="section.block",blockregionarr={},blockregionidarr=[],currentelement="",nextelement="",prevelement="",currentelementid="",movingelementid="",curentregion="",previousregion="",nextregion="",regionlastblock="",regionfirstblock="";const getCurrentBlockRegion=clickedElement=>{for(var i=0;i<blockregionidarr.length;i++)if(clickedElement.closest(blockregionidarr[i]).length)return blockregionidarr[i];return"noblockregion"},getBlockInRegion=(blockregion,blockorder)=>{var regionBlock="blocknotfound";return"lastblock"==blockorder&&$(blockregion).children(".block").length>0&&(regionBlock=$(blockregion).children(".block:last")),"firstblock"==blockorder&&$(blockregion).children(".block").length>0&&(regionBlock=$(blockregion).children(".block:first")),regionBlock},getRegion=(element,regiondirecton)=>{var region="noregion",index=blockregionidarr.indexOf(element);"up"==regiondirecton&&(index>0&&(region=blockregionidarr[index-1]));"down"==regiondirecton&&(index>-1&&index<blockregionidarr.length-1&&(region=blockregionidarr[index+1]));return region},checkidtype=id=>void 0!==id,swapBlocks=($block1,$block2)=>{var block1clone=$block1.clone(),block2clone=$block2.clone();$block1.replaceWith(block2clone),$block2.replaceWith(block1clone)},transparentheaderhanlder=()=>{var transparentheader=!1;if($(".navbar").hasClass("trasnparent-home-nav")&&(transparentheader=!0),$("body.pagelayout-frontpage").removeClass("transparent-header"),transparentheader){if($(window).scrollTop()<45){var hasedwcarouselclass=$("#block-region-full-width-top").children().first().find("div").hasClass("edw-carousel"),hascarouselclass=$("#block-region-full-width-top").children().first().find("div").hasClass("carousel"),hastestimonial=!1,hashomepagetestimonial=$("#block-region-full-width-top").children().first().find("section").hasClass("section-testimonial");if(hasedwcarouselclass){var idAttribute=$("#block-region-full-width-top").children().first().find("div.edw-carousel").attr("id");idAttribute&&-1!==idAttribute.indexOf("testimonial")&&(hastestimonial=!0)}return!hascarouselclass&&!hasedwcarouselclass||hashomepagetestimonial||hastestimonial||0!==$(".old-frontpage").length||$("body.pagelayout-frontpage").addClass("transparent-header"),void($(".old-frontpage .frontpage-sections #edwiser-slider").children().first().hasClass("carousel")&&$("body.pagelayout-frontpage").addClass("transparent-header"))}$("body.pagelayout-frontpage").removeClass("transparent-header")}},registerCommonEvents=()=>{$(document).on("click",SELECTOR_MOVETOP,(function(){currentelement=$(this).closest(SELECTOR_BLOCK),prevelement=currentelement.prevAll(".block:first"),currentelementid=checkidtype(currentelement.attr("data-instance-id"))?currentelement.attr("data-instance-id"):"na",movingelementid=checkidtype(prevelement.attr("data-instance-id"))?prevelement.attr("data-instance-id"):"na",curentregion=getCurrentBlockRegion(currentelement),"na"==movingelementid&&"#block-region-side-pre"!=curentregion?"noblockregion"!=curentregion&&(previousregion=getRegion(curentregion,"up"),regionlastblock=getBlockInRegion(previousregion,"lastblock"),"noregion"!=previousregion&&("blocknotfound"!=regionlastblock?(movingelementid=checkidtype(regionlastblock.attr("data-instance-id"))?regionlastblock.attr("data-instance-id"):"na",blockmover(currentelementid,movingelementid,"move",blockregionarr[previousregion],!0,"moveblockup")):blockmover(currentelementid,movingelementid,"move",blockregionarr[previousregion],!1,"moveblockup"))):blockmover(currentelementid,movingelementid,"up",blockregionarr[curentregion])})),$(document).on("click",SELECTOR_MOVEBOTTOM,(function(){currentelement=$(this).closest(SELECTOR_BLOCK),nextelement=currentelement.nextAll(".block:first"),currentelementid=checkidtype(currentelement.attr("data-instance-id"))?currentelement.attr("data-instance-id"):"na",movingelementid=checkidtype(nextelement.attr("data-instance-id"))?nextelement.attr("data-instance-id"):"na",curentregion=getCurrentBlockRegion(currentelement),"na"==movingelementid&&"#block-region-side-pre"!=curentregion?"noblockregion"!=curentregion&&(nextregion=getRegion(curentregion,"down"),regionfirstblock=getBlockInRegion(nextregion,"firstblock"),"noregion"!=nextregion&&("blocknotfound"!=regionfirstblock?(movingelementid=checkidtype(regionfirstblock.attr("data-instance-id"))?regionfirstblock.attr("data-instance-id"):"na",blockmover(currentelementid,movingelementid,"move",blockregionarr[nextregion],!0,"moveblockdown")):blockmover(currentelementid,movingelementid,"move",blockregionarr[nextregion],!1,"moveblockdown"))):blockmover(currentelementid,movingelementid,"down",blockregionarr[curentregion])}))},blockmover=function(currentelementid,moveelementid,type){let blockregion=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"noregion",blockfoundflag=arguments.length>4&&void 0!==arguments[4]&&arguments[4],blockmovedirection=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Ajax.call([{methodname:"theme_remui_set_block_pos",args:{currentblockid:currentelementid,movingblockid:moveelementid,region:blockregion,blockfoundstatus:blockfoundflag,operationtype:type,movedirection:blockmovedirection,contextid:M.cfg.contextid},done:function(data){data?("up"==type&&(swapBlocks(currentelement,prevelement),console.log("swapping done sucessfully")),"down"==type&&(swapBlocks(currentelement,nextelement),console.log("swapping done sucessfully")),"move"==type&&("moveblockup"==blockmovedirection&&(currentelement.detach().appendTo('[data-blockregion="'.concat(blockregion,'"]')),console.log("moveblockup")),"moveblockdown"==blockmovedirection&&(currentelement.detach().prependTo('[data-blockregion="'.concat(blockregion,'"]')),console.log("moveblockdown"))),transparentheaderhanlder()):console.log("not allowed")},fail:function(){console.log(Notification.exception)}}])};return{init:function(){availableblockregions.forEach((function(element,index){blockregionarr["#block-region-".concat(element)]=element,blockregionidarr[index]="#block-region-".concat(element)}));var secondArrayFixedOrder=["#block-region-full-width-top","#block-region-side-top","#block-region-content","#block-region-side-bottom","#block-region-full-bottom"];blockregionidarr.sort((function(a,b){return secondArrayFixedOrder.indexOf(a)-secondArrayFixedOrder.indexOf(b)})),registerCommonEvents()}}}));

//# sourceMappingURL=blockmovehandler.min.js.map