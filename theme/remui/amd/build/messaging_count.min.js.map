{"version":3,"file":"messaging_count.min.js","sources":["../src/messaging_count.js"],"sourcesContent":["/* eslint-disable no-console*/\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/messaging_count\n * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n    ['jquery',\n        'core/ajax',\n        'core/notification',\n        'core/pubsub',\n        'core_message/message_drawer_router',\n        'core_message/message_drawer_routes',\n        'core_message/message_drawer_events',\n    ],\n    function (\n        $,\n        Ajax,\n        Notification,\n        PubSub,\n        Router,\n        Routes,\n        MessageDrawerEvents,\n    ) {\n\n        let getUserCountListPromise = null;\n\n        const setUserCount = function(data) {\n            $('.show-contacts-section span').remove();\n            $('.show-contacts-section').append(data.showmsgcount);\n            $('[data-action=\"show-requests-section\"] span').remove();\n            $('[data-action=\"show-requests-section\"]').append(data.showrequestcount);\n        };\n\n        const getUserCount = function() {\n            if (!getUserCountListPromise) {\n                getUserCountListPromise = new Promise((resolve) => {\n                    Ajax.call([{\n                        methodname: 'theme_remui_get_msg_contact_list_count',\n                        args: {\n                            userid: 1\n                        },\n                        done: function(data) {\n                            const parsedData = $.parseJSON(data);\n                            resolve(parsedData);\n                        },\n                        fail: function() {\n                            console.log(Notification.exception);\n                        }\n                    }]);\n                });\n            }\n\n            // eslint-disable-next-line promise/always-return\n            getUserCountListPromise.then(data => {\n                setUserCount(data);\n            }).catch(error => {\n                console.error(\"Error fetching user count:\", error);\n            });\n        };\n\n        const getLogInUserdetails = function () {\n            Ajax.call([{\n                methodname: 'theme_remui_get_login_user_detail',\n                args: {},\n                done: function (data) {\n                    $(\".send .messager-info .messager-img-container\").remove();\n                    $(\".send .messager-info .username\").remove();\n                    $(\".send .messager-info\").append(data);\n                },\n                fail: function () {\n                    console.log(Notification.exception);\n                }\n            }]);\n        };\n\n        const init = function () {\n            $(document).ready(function () {\n                getUserCount();\n                PubSub.subscribe(MessageDrawerEvents.CONVERSATION_READ, function () {\n                    getLogInUserdetails();\n                });\n\n                // This events are used to handle the contact counts on contacts page.\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_ADDED, function () {\n                    getUserCount();\n                });\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_REMOVED, function () {\n                    getUserCount();\n                });\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED, getUserCount());\n\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED, getUserCount());\n\n                $(\"[data-action='decline-contact-request']\").on('click', function () {\n                    setTimeout(getUserCount, 100);\n                });\n\n            });\n        };\n        return {\n            init: init\n        };\n    });\n"],"names":["define","$","Ajax","Notification","PubSub","Router","Routes","MessageDrawerEvents","getUserCountListPromise","getUserCount","Promise","resolve","call","methodname","args","userid","done","data","parsedData","parseJSON","fail","console","log","exception","then","remove","append","showmsgcount","showrequestcount","setUserCount","catch","error","init","document","ready","subscribe","CONVERSATION_READ","CONTACT_ADDED","CONTACT_REMOVED","CONTACT_REQUEST_ACCEPTED","CONTACT_REQUEST_DECLINED","on","setTimeout"],"mappings":";;;;;AAsBAA,qCACI,CAAC,SACG,YACA,oBACA,cACA,qCACA,qCACA,uCAEJ,SACIC,EACAC,KACAC,aACAC,OACAC,OACAC,OACAC,yBAGIC,wBAA0B,WASxBC,aAAe,WACZD,0BACDA,wBAA0B,IAAIE,SAASC,UACnCT,KAAKU,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,OAAQ,GAEZC,KAAM,SAASC,YACLC,WAAajB,EAAEkB,UAAUF,MAC/BN,QAAQO,aAEZE,KAAM,WACFC,QAAQC,IAAInB,aAAaoB,mBAOzCf,wBAAwBgB,MAAKP,QA3BZ,SAASA,MAC1BhB,EAAE,+BAA+BwB,SACjCxB,EAAE,0BAA0ByB,OAAOT,KAAKU,cACxC1B,EAAE,8CAA8CwB,SAChDxB,EAAE,yCAAyCyB,OAAOT,KAAKW,kBAwBnDC,CAAaZ,SACda,OAAMC,QACLV,QAAQU,MAAM,6BAA8BA,iBA2C7C,CACHC,KAzBS,WACT/B,EAAEgC,UAAUC,OAAM,WACdzB,eACAL,OAAO+B,UAAU5B,oBAAoB6B,mBAAmB,WAjB5DlC,KAAKU,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,GACNE,KAAM,SAAUC,MACZhB,EAAE,gDAAgDwB,SAClDxB,EAAE,kCAAkCwB,SACpCxB,EAAE,wBAAwByB,OAAOT,OAErCG,KAAM,WACFC,QAAQC,IAAInB,aAAaoB,kBAa7BnB,OAAO+B,UAAU5B,oBAAoB8B,eAAe,WAChD5B,kBAEJL,OAAO+B,UAAU5B,oBAAoB+B,iBAAiB,WAClD7B,kBAEJL,OAAO+B,UAAU5B,oBAAoBgC,yBAA0B9B,gBAE/DL,OAAO+B,UAAU5B,oBAAoBiC,yBAA0B/B,gBAE/DR,EAAE,2CAA2CwC,GAAG,SAAS,WACrDC,WAAWjC,aAAc"}