define(["jquery","block_customnavigation/nestedSortable"],function(s,e){function n(){""!=s("#label").val()&&(void 0!==a[s("#select_language").val()]?s("#select_index_language").val(a[s("#select_language").val()]):s("#select_index_language").val(""))}function t(n){var a=[];""==n&&(n=""),s.getJSON(M.cfg.wwwroot+"/theme/remui/json/font-awesome-data.json",function(e){s.each(e,function(e,t){title=e.replace("fa-",""),""!=n?-1!=e.indexOf(n)&&a.push("<li> <a title = '"+title+"' data-font='"+e+"'><i class='fa "+e+"'></i></a></li>"):a.push("<li> <a title = '"+title+"' data-font='"+e+"'><i class='fa "+e+"'></i></a></li>")}),s("#listicons").html(a)})}var a=new Array;return{init:function(){s(document).ready(function(){ns=s("ol.sortable").nestedSortable({forcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:5,isTree:!0,expandOnHover:700,startCollapsed:!1,change:function(e,t){}}),s(".editMenu").click(function(){editing=!0;var t=s(this).parents("li").attr("id").split("_");s.ajax({type:"GET",url:"get_data.php",dataType:"JSON",data:"item="+t[1],success:function(e){if(a=e.languages,null!==e||"undefined"!==e){s("#item_cancel").show();s("input[name=label]").val();font=/fa-/,null!==e.icon&&(fa_icon=e.icon.search(font)),s("#fa-type").css("display","block"),s("#fa-type input").attr("value",e.icon),"link"==e.type?(s("input:radio[name='type']")[0].checked=!0,s("#tr_href, #tr_target").show(),s("#tr_module").hide(),s("#tr_label input").focus(),s("select[name=target]").val(e.target)):"module"==e.type?(s("input:radio[name=type]")[2].checked=!0,s("#tr_href, #tr_target").hide(),s("#tr_module").show(),s("#tr_label input").focus(),s("select[name=module]").val(e.module)):(s("input:radio[name=type]")[1].checked=!0,s("#tr_href, #tr_target").hide(),s("#tr_module").show(),s("#tr_label input").focus()),s("input[name=id_item]").val(t[1]),s("input[name=h_icon]").val(e.icon),s("input[name=h_sort]").val(e.sort),s("input[name=h_roleid]").val(e.roleid),s("input[name=h_parent]").val(e.parent),s("input[name=type]").val(e.type),s("input[name=module]").val(e.module),s("input[name=label]").val(e.label),s("input[name=href]").val(e.href),s("input[name=inst_id]").val(e.inst_id),s("#roles").val(e.roleid).trigger("change"),s("#item_add").val("Update"),s("input[name=action]").val("edit_item"),editing=!0,n(),s("html, body").animate({scrollTop:s("body").offset().top},1e3)}}})}),s("#select_language").change(function(){n()}),s("#tr_label input").focus(),s("#save_menu").click(function(){var e=s("ol.sortable").nestedSortable("toArray",{startDepthCount:0}),t=e.length,n=[];for(i=1;i<t;i++){var a=e[i],l=a.id,o=a.parent_id,c=s("#menuItem_"+l+" .itemObject").html();if(c)var r=jQuery.parseJSON(c);else r={};r.id=l,r.parent_id=o,n.push(r)}return s("#customnavigation_structure").val(json_encode(n)),s("#customnavigation_structure_form").submit(),!0}),s("#type_link").click(function(){s("#tr_href, #tr_target").show(),s("#tr_module").hide(),s("#tr_label input").focus()}),s("#type_container").click(function(){s("#tr_href, #tr_target").hide(),s("#tr_module").hide(),s("#tr_label input").focus()}),s("#type_module").click(function(){s("#tr_href, #tr_target").hide(),s("#tr_module").show(),s("#tr_label input").focus()}),s(".deleteMenu").unbind("click").click(function(){var e=s(this).parents("li").attr("id");s("#"+e).remove()})}),s("#clearall").on("click",function(){s("#roles").val(null).trigger("change")}),s("#save_menu").click(),s("#item_cancel").click(function(){s(this).css("display","none"),s("#item_add").val("Add"),s("#roles").val("").trigger("change"),editing=!1}),s("#icon_font").click(function(){s("#icon-type").css("display","none"),s("#fa-type").css("display","block")}),s("#icon_image").click(function(){s("#fa-type").css("display","none"),s("#icon-type").css("display","block")}),s("#edit-font").click(function(){s("#search_icon").val(""),t(""),s("#icon-fonts div ul li a").removeClass("selected");var e=s("#fa-type input[type=text]").attr("value");void 0!==e&&(e=e.replace(" ",""),s('#icon-fonts div ul li a[data-font="'+e+'"]').addClass("selected")),s("#icon-fonts").css("display","block")}),s(document).on("click","#icon-fonts div .close-fa",function(e){s("#icon-fonts").css("display","none")}),s(document).on("click","#icon-fonts ul li a",function(e){s("#fa-type-text").attr("value",s(this).data("font")),s("#icon-fonts").css("display","none")}),s("#search_icon").keyup(function(e){s("#listicons").html(""),t(s(this).val())})}}});