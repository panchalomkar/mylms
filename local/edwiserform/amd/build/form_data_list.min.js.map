{"version":3,"sources":["form_data_list.js"],"names":["define","$","Ajax","Notification","Templates","updateSeparator","length","each","index","tr","find","remove","actions","slice","after","showErrors","errors","list","i","append","Formeo","dom","alert","get","init","formid","allowed","table","PROMISES","DELETE_SUBMISSION","ids","call","methodname","args","id","submissions","GET_FORM_SUBMISSIONS","search","start","sort","deleteSubmissions","multiActions","M","util","get_string","title","type","action","loading","done","response","status","msg","draw","prop","loadingClose","fail","ex","exception","fn","dataTable","ext","errMode","document","ready","addClass","DataTable","paging","bProcessing","bServerSide","rowId","bDeferRender","scrollY","scrollX","scrollCollapse","autoWidth","classes","sScrollHeadInner","order","columnDefs","orderable","targets","orderSequence","language","sSearch","emptyTable","info","end","total","infoEmpty","paginate","first","last","next","previous","lengthMenu","menu","buttons","ajax","data","callback","settings","value","dir","drawCallback","removeClass","render","wwwroot","cfg","license","html","js","replaceNode","on","parent","this","closest","is","text","columns","adjust","window","open","location","href","val","toaster","e","push","event","preventDefault"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edwiser Form form_data_list js\n * @package   local_edwiserform\n * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    Yogesh Shirsath\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'local_edwiserform/jquery.dataTables',\n    'local_edwiserform/dataTables.bootstrap4',\n    'local_edwiserform/buttons.bootstrap4',\n    'local_edwiserform/fixedColumns.bootstrap4',\n    'local_edwiserform/formviewer'\n], function($, Ajax, Notification, Templates) {\n    var updateSeparator = function() {\n        if ($('.efb-form-submissions-table tr').length == 0) {\n            return;\n        }\n        $('.efb-form-submissions-table tr').each(function(index, tr) {\n            $(tr).find('.efb-data-actions span').remove();\n            var actions = $(tr).find('.efb-data-action.show');\n            if (actions.length < 2) {\n                return;\n            }\n            actions.slice(0, actions.length - 1).after('<span> | </span>');\n        });\n    };\n\n    /**\n     * Show errors as a list in modal\n     * @param {Array} errors Errors string list\n     */\n    var showErrors = function(errors) {\n        var list = $('<ul></ul>');\n        for (var i = 0; i < errors.length; i++) {\n            list.append($('<li>' + errors[i] + '</li>'));\n        }\n        // eslint-disable-next-line no-undef\n        Formeo.dom.alert(\n            'warning',\n            list.get(0)\n        );\n    };\n\n    /**\n     * Initizalize.\n     * @param {Number} formid Form id\n     * @param {Boolean} allowed Is allowed\n     */\n    function init(formid, allowed) {\n        var table;\n        var PROMISES = {\n            /**\n             * Ajax promise to delete form submission by ids\n             * @param  {Array}   ids Ids array of submission\n             * @return {Promise}     Ajax promise\n             */\n            DELETE_SUBMISSION: function(ids) {\n                return Ajax.call([{\n                    methodname: 'edwiserform_delete_submissions',\n                    args: {\n                        id: formid,\n                        submissions: ids\n                    }\n                }])[0];\n            },\n\n            /**\n             * Get form data using ajax\n             * @param  {String}  search Search query\n             * @param  {Number}  start  Start index of courses\n             * @param  {Number}  length Number of courses\n             * @param  {String}  sort   Sorting order of date column\n             * @return {Promise}        Ajax promise\n             */\n            GET_FORM_SUBMISSIONS: function(search, start, length, sort) {\n                return Ajax.call([{\n                    methodname: 'edwiserform_get_form_submissions',\n                    args: {\n                        formid: formid,\n                        search: search,\n                        start: start,\n                        length: length,\n                        sort: sort\n                    }\n                }])[0];\n            },\n        };\n\n        $.fn.dataTable.ext.errMode = 'none';\n\n        $(document).ready(function() {\n            if (!allowed) {\n                $('body').addClass('user-view');\n            }\n            table = $(\"#efb-form-submissions\").DataTable({\n                paging: true,\n                bProcessing: true,\n                bServerSide: true,\n                rowId: 'DT_RowId',\n                bDeferRender: true,\n                scrollY: \"400px\",\n                scrollX: true,\n                scrollCollapse: true,\n                autoWidth: true,\n                classes: {\n                    sScrollHeadInner: 'efb_dataTables_scrollHeadInner'\n                },\n                order: [\n                    [2, 'asc']\n                ],\n                columnDefs: [\n                    { orderable: false, targets: 'sorting_disabled' },\n                    { orderable: true, targets: 'sorting', 'orderSequence': ['desc', 'asc'] }\n                ],\n                dom: '<\"efb-top\"<\"efb-listing\"l><\"efb-list-filtering\"f>>t<\"efb-bottom\"<' +\n                    '\"efb-list-pagination\"p><B>' + (allowed ? '<\"efb-bulk\">' : '') + '>i',\n                language: {\n                    sSearch: M.util.get_string('search-entry', 'local_edwiserform'),\n                    emptyTable: M.util.get_string('listformdata-empty', 'local_edwiserform'),\n                    info: M.util.get_string(\n                        'efb-heading-listforms-showing',\n                        'local_edwiserform', { 'start': '_START_', 'end': '_END_', 'total': '_TOTAL_' }\n                    ),\n                    infoEmpty: M.util.get_string(\n                        'efb-heading-listforms-showing',\n                        'local_edwiserform', { 'start': '0', 'end': '0', 'total': '0' }\n                    ),\n                    paginate: {\n                        first: M.util.get_string('first', 'local_edwiserform'),\n                        last: M.util.get_string('last', 'local_edwiserform'),\n                        next: M.util.get_string('next', 'local_edwiserform'),\n                        previous: M.util.get_string('previous', 'local_edwiserform')\n                    },\n                    lengthMenu: M.util.get_string('show-entries', 'local_edwiserform', { 'menu': '_MENU_' }),\n                },\n                buttons: [],\n                // eslint-disable-next-line no-unused-vars\n                ajax: function(data, callback, settings) {\n                    PROMISES.GET_FORM_SUBMISSIONS(\n                        data.search.value,\n                        data.start,\n                        data.length,\n                        data.order[0].dir\n                    ).done(function(response) {\n                        if (response.errors.length != 0) {\n                            showErrors(response.errors);\n                        }\n                        delete response.errors;\n                        callback(response);\n                        updateSeparator();\n                    }).fail(Notification.exception);\n                },\n                // eslint-disable-next-line no-unused-vars\n                drawCallback: function(settings) {\n                    updateSeparator();\n                    if (allowed) {\n                        $('.efb-bottom .dt-buttons').removeClass('btn-group');\n                        Templates.render('local_edwiserform/bulk-actions', {\n                                formid: formid,\n                                wwwroot: M.cfg.wwwroot,\n                                // eslint-disable-next-line no-undef\n                                license: license == 'available' ? '' : M.util.get_string('activate-license', 'local_edwiserform')\n                            }, 'theme_remui')\n                            .done(function(html, js) {\n                                Templates.replaceNode($('.efb-bulk'), html, js);\n                            })\n                            .fail(Notification.exception);\n                    }\n                }\n            });\n\n            // Toggle long data in table cells.\n            $('body').on('click', '.data-toggler', function() {\n                let parent = $(this).closest('.efb-table-data-expand');\n                if (parent.is('.expanded')) {\n                    parent.removeClass('expanded');\n                    parent.find('.table-data').html(parent.data('short'));\n                    $(this).text(M.util.get_string('readmore', 'local_edwiserform'));\n                } else {\n                    parent.addClass('expanded');\n                    parent.find('.table-data').html(parent.data('long'));\n                    $(this).text(M.util.get_string('readless', 'local_edwiserform'));\n                }\n                table.columns.adjust();\n            });\n        });\n\n        /**\n         * Delete submission from ids passed in parameter\n         * @param  {Array} ids Ids array of submissions\n         */\n        function deleteSubmissions(ids) {\n            // eslint-disable-next-line no-undef\n            Formeo.dom.multiActions(\n                'warning',\n                M.util.get_string('deletesubmission', 'local_edwiserform'),\n                M.util.get_string('deletesubmissionmsg', 'local_edwiserform'), [{\n                    title: M.util.get_string('proceed', 'local_edwiserform'),\n                    type: 'danger',\n                    action: function() {\n                        // eslint-disable-next-line no-undef\n                        Formeo.dom.loading();\n                        PROMISES.DELETE_SUBMISSION(ids).done(function(response) {\n                            if (response.status == true) {\n                                // eslint-disable-next-line no-undef\n                                Formeo.dom.alert('success', '<div class=\"col-12\">' + response.msg + '</div>');\n                                table.draw();\n                                $('.submission-check-all').prop('checked', false);\n                            }\n                            // eslint-disable-next-line no-undef\n                            Formeo.dom.loadingClose();\n                        }).fail(function(ex) {\n                            Notification.exception(ex);\n                            // eslint-disable-next-line no-undef\n                            Formeo.dom.loadingClose();\n                        });\n                    }\n                }, {\n                    title: M.util.get_string('cancel', 'local_edwiserform'),\n                    type: 'success'\n                }]\n            );\n        }\n\n        $('body').on('click', '.efb-csv-export', function() {\n            // eslint-disable-next-line no-undef\n            if (license != 'available') {\n                window.location.href = M.cfg.wwwroot +\n                    '/admin/settings.php?section=local_edwiserform&activetab=local_edwiserform_license_status';\n                return;\n            }\n            window.open(M.cfg.wwwroot + \"/local/edwiserform/export.php?id=\" + formid + \"&action=data\");\n        });\n\n        // Select All/None checkbox.\n        $('body').on('change', '.submission-check-all', function() {\n            $('.submission-check').prop('checked', $(this).is(':checked'));\n        });\n\n        // Apply bulk actions.\n        $('body').on('click', '#efb-apply-actions', function() {\n            switch ($('#efb-bulk-actions').val()) {\n                case 'bulkaction':\n                    // Show toaster if bulk action is not selected.\n                    // eslint-disable-next-line no-undef\n                    Formeo.dom.toaster(M.util.get_string('selectbulkaction', 'local_edwiserform'));\n                    break;\n                case 'delete':\n                    // Show toaster if deletiong submission without selecting any.\n                    if (!$('.submission-check').is(':checked')) {\n                        // eslint-disable-next-line no-undef\n                        Formeo.dom.toaster(M.util.get_string('emptysubmission', 'local_edwiserform'));\n                        return;\n                    }\n\n                    var ids = [];\n                    // Prepare ids array to delete.\n                    $('.submission-check:checked').each(function(i, e) {\n                        ids.push($(e).data('value'));\n                    });\n                    deleteSubmissions(ids);\n                    break;\n            }\n        });\n\n        $('body').on('click', '.efb-data-action.delete-action', function() {\n            deleteSubmissions([$(this).data('value')]);\n        });\n\n        $('body').on('click', '.efb-data-action', function(event) {\n            event.preventDefault();\n            return;\n        });\n    }\n    return {\n        updateSeparator: updateSeparator,\n        init: init\n    };\n});"],"file":"form_data_list.min.js"}