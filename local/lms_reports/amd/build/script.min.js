define(["jquery","core/str","local_lms_reports/notify","local_lms_reports/bootstrap_wizard"],function(l,r){return{init:function(){var e=new Date;e.setDate(e.getDate()-1);r.get_strings([{key:"run_repo_schedule",component:"local_lms_reports"},{key:"at_repo_schedule",component:"local_lms_reports"},{key:"category_repo_schedule",component:"local_lms_reports"},{key:"required_field_empty",component:"local_lms_reports"},{key:"recipients_repo_schedule_help",component:"local_lms_reports"}]);l("#slms-course-wizard").bootstrapWizard({tabClas:"wz-steps",nextSelector:".next",previousSelector:".previous",onTabClick:function(e,r,a){return!0},onInit:function(){},onTabShow:function(e,r,a){var s=!0;l("#slms-course-wizard ul li").each(function(e,r){1==s&&(s=!l(this).hasClass("active"),l("span",this).addClass("ready"))});var o=r.find("li").length,t=a+1,i=a/o*95.2,n=120/o/2;l("#slms-course-wizard").find(".progress-bar-co").css({width:i+"%",margin:"0px "+n+"%",transition:"all .3s"}),r.find("li:eq("+a+") a").trigger("focus"),o<=t?(l("#slms-course-wizard").find(".next").hide(),l("#slms-course-wizard").find(".finish").show(),l("#slms-course-wizard").find(".finish").prop("disabled",!1)):(l("#slms-course-wizard").find(".next").show(),l("#slms-course-wizard").find(".finish").hide().prop("disabled",!0));1==t?(l("#slms-course-wizard").find(".previous").prop("disabled",!0),l("#slms-course-wizard").find(".previous").css({opacity:.5})):(l("#slms-course-wizard").find(".previous").prop("disabled",!1),l("#slms-course-wizard").find(".previous").css({opacity:1})),3==t?"virtualclass"!=l("input[name=classtype]:radio:checked").val()&&"classroom"!=l("input[name=classtype]:radio:checked").val()||(l("#slms-course-wizard").find(".next").hide(),l("#slms-course-wizard").find(".finish").show(),l("#slms-course-wizard").find(".finish").prop("disabled",!1)):o<=t?(l("#slms-course-wizard").find(".next").hide(),l("#slms-course-wizard").find(".finish").show(),l("#slms-course-wizard").find(".finish").prop("disabled",!1)):(l("#slms-course-wizard").find(".next").show(),l("#slms-course-wizard").find(".finish").hide().prop("disabled",!0))},onNext:function(){if(l("#slms-course-wizard1").hasClass("active")){var e=l("#slms-course-wizard form input[name=label]").val();l("textarea#description_id").val();if(null==e||0==e.length||/^\s*$/.test(e)){var r=M.util.get_string("required_field_empty","local_lms_reports");return l("#errorlabel").text()!=r&&l("#label_id").after('<div id="errorlabel">'+r+"</div>"),l("#slms-course-wizard form input[name=label]").css("border-color","#ef5d84"),l("#slms-course-wizard form input[name=label]").focus(),!1}l("#slms-course-wizard form input[name=label]").css("border-color","none")}if(l("#slms-course-wizard2").hasClass("active")&&l("#slms-course-wizard form input[name=run]").css("border-color","#ad1319"),l("#slms-course-wizard4").hasClass("active")){if(null==(e=l("#slms-course-wizard form input[name=format]").val())||0==e.length||/^\s*$/.test(e))return l("#slms-course-wizard form input[name=format]").css("border-color","#ad1319"),l("#slms-course-wizard form input[name=format]").focus(),!1;l("#slms-course-wizard form input[name=format]").css("border-color","none")}if(l("#slms-course-wizard5").hasClass("active")){if(null==(e=l("#slms-course-wizard form input[name=recipients]").val())||0==e.length||/^\s*$/.test(e)){r=M.util.get_string("required_field_empty","local_lms_reports");return l("#errorreceipent").text()!=r&&l("#receipent_id").after('<div id="errorreceipent">'+r+"</div>"),l("#slms-course-wizard form input[name=recipients]").css("border-color","#ad1319"),l("#slms-course-wizard form input[name=recipients]").focus(),!1}l("#slms-course-wizard form input[name=recipients]").css("border-color","none");var a=document.getElementById("form-wizard-reports").elements,s="";s+="<div style='display: inline-block; text-align: left;'>",s+="<strong>"+M.util.get_string("info_to_save_repo_schedule","local_lms_reports")+"</strong><br/><br/>";for(var o=1;o<=a.length;o++){var t=l(a[o]).attr("name");l(a[o]).attr("class");if("label"==t)var i=l("#slms-course-wizard form input[name=label]").val();else if("description"==t)i=l("textarea#description_id").val();else if("category"==t)i=l("#slms-course-wizard form select[name=category] option:selected").text();else if("run"==t)i=l("#slms-course-wizard form select[name=run]").val();else if("at"==t)i=l("#slms-course-wizard form select[name=at] option:selected").html();else if("recipients"==t)i=l("#slms-course-wizard form input[name=recipients]").val();else if("message"==t)i=l("textarea#message_id").val();(t||i)&&("label"!=t&&"description"!=t&&"category"!=t&&"run"!=t&&"at"!=t&&"recipients"!=t&&"message"!=t||(s+="<strong>"+(t=M.util.get_string(t+"_repo_schedule","local_lms_reports"))+"</strong>: "+i+"<br />"))}s+="</div>",document.getElementById("final-data-form").innerHTML=s}},onPrevious:function(){if(l("#slms-course-wizard1").hasClass("active")){if(null==(e=l("#slms-course-wizard form input[name=label]").val())||0==e.length||/^\s*$/.test(e))return l("#slms-course-wizard form input[name=label]").css("border-color","#ad1319"),l("#slms-course-wizard form input[name=label]").focus(),!1;l("#slms-course-wizard form input[name=label]").css("border-color","none")}if(l("#slms-course-wizard2").hasClass("active"))var e=l("#slms-course-wizard form input[name=start_date]").val();if(l("#slms-course-wizard4").hasClass("active")){if(null==(e=l("#slms-course-wizard form input[name=format]").val())||0==e.length||/^\s*$/.test(e))return l("#slms-course-wizard form input[name=format]").css("border-color","#ad1319"),l("#slms-course-wizard form input[name=format]").focus(),!1;l("#slms-course-wizard form input[name=format]").css("border-color","none")}if(l("#slms-course-wizard5").hasClass("active")){if(null==(e=l("#slms-course-wizard form input[name=recipients]").val())||0==e.length||/^\s*$/.test(e))return l("#slms-course-wizard form input[name=recipients]").css("border-color","#ad1319"),l("#slms-course-wizard form input[name=recipients]").focus(),!1;l("#slms-course-wizard form input[name=recipients]").css("border-color","none");var r=document.getElementById("form-wizard-reports").elements,a="<strong>"+M.util.get_string("info_to_save_repo_schedule","local_lms_reports")+"</strong><br/><br/>";a+="<div class='col-lg-7 left' style='float: right;'>";for(var s=1;s<=r.length;s++){var o=l(r[s]).attr("name"),t=l(r[s]).attr("value");"start_date"!=o&&"end_date"!=o||(document.getElementById("hidden_"+o).value=t),(o||t)&&("label"!=o&&"description"!=o&&"start_date"!=o&&"end_date"!=o&&"recipients"!=o&&"message"!=o||(newname=M.util.get_string(o+"_repo_schedule","local_lms_reports"),a+="<strong>"+newname+"</strong>: "+t+"<br />"))}a+="</div>",document.getElementById("final-data-form").innerHTML=a}}})},myfavoritereport:function(){l("#report_accordion .panel-title").click(function(e){e.preventDefault(),e.stopPropagation();var r=l(this).find("a").attr("href");0<l(r).length&&("none"==l(r).css("display")?(l(this).find("a").eq(0).find("i").removeClass("fa-angle-down").addClass("fa-angle-up"),l(this).find("a").addClass("active")):(l(this).find("a").eq(0).find("i").removeClass("fa-angle-up").addClass("fa-angle-down"),l(this).find("a").removeClass("active")),l(r).slideToggle("slow",function(){l("#report_accordion .panel-collapse:not([id='"+r.replace(/\#/,"")+"'])").slideUp(),l("#report_accordion .panel-title").each(function(e){l(this).find("a").attr("href")!=r&&(l(this).find("a").eq(0).find("i").removeClass("fa-angle-up").addClass("fa-angle-down"),l(this).find("a").removeClass("active"))})}))}),l("body").delegate("a.star","click",function(e){var s,o,r,a,t;e.preventDefault(),e.stopPropagation(),s=this,r=M.cfg.wwwroot+"/local/lms_reports/actions.php",a=l(s).attr("alt").split("-"),t={id:a[0],fav:a[1],task:"dest",mfd:o=l("#my_favorites").length?1:0},jQuery.getJSON(r,t,function(e){if(e.success){var r="";if(1===e.fav)if(0===o)l("#report_accordion").html(e.mfd),l("#"+l(s).closest(".show").attr("id")).addClass("show");else{r="fa fa-star";var a=e.id+"-"+e.fav;l(s).attr("alt",a),l(s).children("i").attr("class",r),$clone=l(s).parents(".item-menu").clone(!0),l("#my_favorites #collapsef .panel-body").prepend($clone)}else r="fa fa-star-o",a=e.id+"-"+e.fav,l(s).attr("alt",a),l(s).children("i").attr("class",r),$parent=l("#my_favorites #collapsef .panel-body").find("[rel="+e.id+"]"),0<$parent.length?($report=l(".panel .panel-body .item-menu").find("[rel="+e.id+"]"),$report.attr("alt",a),$report.children("i").attr("class",r),l("#my_favorites #collapsef .panel-body").find("[rel="+e.id+"]").parents(".item-menu").remove()):$parent=l(s).parents(".panel"),l("#my_favorites #collapsef .panel-body .row").length<1&&l("#my_favorites").remove()}})})},searchReport:function(){function r(){var e=l("#txt").val();e=e.trim();var r=M.cfg.wwwroot+"/local/lms_reports/actions.php",a={};a.txt=e,a.task="searchreport",jQuery.getJSON(r,a,function(e){e.success&&l(".accordion#accordion").html(e.menu)})}l("#txt").on("keyup",function(){var e=document.getElementById("txt").value.toLowerCase();(console.log(e),""!=e.replace(/\s/,""))?(l("#report_accordion .panel-collapse").hide(),l("#report_accordion .item-menu").hide(),0<l("#report_accordion a[search*='"+e+"']").length&&l("#report_accordion a[search*='"+e+"']").each(function(e){l(this).show(),l(this).closest("div .item-menu").show(),l(this).closest("div .panel-collapse").show(),l(this).closest("div .panel").eq(0).find("i.reports-dropdown").removeClass("fa-angle-down").addClass("fa-angle-up")})):(l("#report_accordion div.panel-collapse").hide(),l("#report_accordion .item-menu").show(),l("#report_accordion .panel").find("i.reports-dropdown").removeClass("fa-angle-up").addClass("fa-angle-down"))}),l("#searchform").submit(function(e){return e.preventDefault(),e.stopPropagation(),r(),!1}),l("#searchbutton").click(function(e){return e.preventDefault(),e.stopPropagation(),r(),!1})}}});