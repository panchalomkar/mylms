define("local_edwiserpagebuilder/addblockaddedlistners",["exports","core/str","core/ajax","jquery","core/notification"],(function(_exports,_str,_ajax,_jquery,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Show an add block modal instead of doing it on a separate page.
   *
   * @module     theme_remui/addblockaddedlistners
   * @copyright  2016 Damyon Wiese <damyon@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){let scrollInterval;document.addEventListener("click",(e=>{const selecteditem=e.target.closest(".add-block-grid-view");templatefile="theme_remui/add_block_body_cards",selecteditem&&(activeclassview="grid-view",notactiveclassview="list-view",userprefclass=SELECTORS_ADDBLOCKGRIDVIEW,usernotprefclass=SELECTORS_ADDBLOCKLISTVIEW,(0,_jquery.default)(userprefclass).addClass("active"),(0,_jquery.default)(usernotprefclass).removeClass("active"),(0,_jquery.default)(SELECTORS_DEFAULTBLOCKWRAPPER).removeClass(notactiveclassview).addClass(activeclassview))})),document.addEventListener("click",(e=>{e.target.closest(".add-block-list-view")&&(activeclassview="list-view",notactiveclassview="grid-view",userprefclass=SELECTORS_ADDBLOCKLISTVIEW,usernotprefclass=SELECTORS_ADDBLOCKGRIDVIEW,(0,_jquery.default)(userprefclass).addClass("active"),(0,_jquery.default)(usernotprefclass).removeClass("active"),(0,_jquery.default)(SELECTORS_DEFAULTBLOCKWRAPPER).removeClass(notactiveclassview).addClass(activeclassview))})),document.addEventListener("click",(e=>{e.target.closest(".edwiseradvancedblocktab")&&(activeadvancedtab=!0,(0,_jquery.default)(".moodleblock").addClass("d-none"),(0,_jquery.default)(".advanceblockblocks").removeClass("d-none"),(0,_jquery.default)(".advancedblocktab").addClass("active show"),(0,_jquery.default)(".moodleblocktab").removeClass("active show"),(0,_jquery.default)(".action-buttons-modal").removeClass("d-none"),(0,_jquery.default)(".edw-tabs-navigation.edwiser-custom-blocks-nav").removeClass("d-none"),"undefined"!=typeof edwremuithemeinfo&&"available"==edwremuithemeinfo&&(0,_jquery.default)(".modal-subheader").addClass("p-mb-2").removeClass("p-mb-6"))})),document.addEventListener("click",(e=>{e.target.closest(".edwmoodleblockstab")&&(activeadvancedtab=!1,(0,_jquery.default)(".moodleblock").removeClass("d-none"),(0,_jquery.default)(".advanceblockblocks").addClass("d-none"),(0,_jquery.default)(".moodleblocktab").addClass("active show"),(0,_jquery.default)(".advancedblocktab").removeClass("active show"),(0,_jquery.default)(".action-buttons-modal").addClass("d-none"),(0,_jquery.default)(".modal-subheader").addClass("p-mb-6").removeClass("p-mb-2"),(0,_jquery.default)(".edw-tabs-navigation.edwiser-custom-blocks-nav").addClass("d-none"))})),document.addEventListener("click",(e=>{const selecteditem=e.target.closest("#static-blocks-btn");if(selecteditem){(0,_jquery.default)(SELECTORS_DEFAULTBLOCKWRAPPER).removeClass("".concat(SELECTORS_DYNAMICBLOCKSWRAPPER," ").concat(SELECTORS_BLOCKLAYOUTWRAPPER)).addClass(SELECTORS_STATICBLOCKSWRAPPER),(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN)).removeClass().addClass("".concat(SELECTORS_LEFTSIDEBARMIDREGIN," ").concat(SELECTORS_STATICBLOCKSFILTERS));var filtercategory=(0,_jquery.default)(selecteditem).data("filter"),filteritem=(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN," .").concat(filtercategory,".active"));applySelectedCategory(filteritem),applyFilterOnBlocks((0,_jquery.default)(filteritem))}})),document.addEventListener("click",(e=>{const selecteditem=e.target.closest("#dynamic-blocks-btn");if(selecteditem){(0,_jquery.default)(SELECTORS_DEFAULTBLOCKWRAPPER).removeClass("".concat(SELECTORS_STATICBLOCKSWRAPPER," ").concat(SELECTORS_BLOCKLAYOUTWRAPPER)).addClass(SELECTORS_DYNAMICBLOCKSWRAPPER),(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN)).removeClass().addClass("".concat(SELECTORS_LEFTSIDEBARMIDREGIN," ").concat(SELECTORS_DYNAMICBLOCKSFILTERS));var filtercategory=(0,_jquery.default)(selecteditem).data("filter"),filteritem=(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN," .").concat(filtercategory,".active"));applySelectedCategory(filteritem),applyFilterOnBlocks((0,_jquery.default)(filteritem))}})),document.addEventListener("click",(e=>{const selecteditem=e.target.closest("#layout-blocks-btn");if(selecteditem){(0,_jquery.default)(SELECTORS_DEFAULTBLOCKWRAPPER).removeClass("".concat(SELECTORS_DYNAMICBLOCKSWRAPPER," ").concat(SELECTORS_STATICBLOCKSWRAPPER)).addClass(SELECTORS_BLOCKLAYOUTWRAPPER),(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN)).removeClass().addClass("".concat(SELECTORS_LEFTSIDEBARMIDREGIN," ").concat(SELECTORS_BLOCKLAYOUTFILTERS));var filtercategory=(0,_jquery.default)(selecteditem).data("filter"),filteritem=(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN," .").concat(filtercategory,".active"));applySelectedCategory(filteritem),applyFilterOnBlocks((0,_jquery.default)(filteritem))}})),(0,_jquery.default)(document).on("mouseenter",".addblock-modal-body .block-page-layout",(function(){const cardHeight=(0,_jquery.default)(this).find(".card").height(),img=(0,_jquery.default)(this).find(".card img");let scrollHeight=img.height()-cardHeight+40;if(img.css("animation","unset"),scrollHeight>0){let scrolltime=scrollHeight/100;scrolltime<1&&(scrolltime=1),img.css("transition","top ".concat(scrolltime,"s ease-in-out")),img.css("top","".concat(-scrollHeight,"px")),img.one("transitionend",(function(){img.css("top","0px")})),scrollInterval=setInterval((function(){img.css("top","".concat(-scrollHeight,"px")),img.one("transitionend",(function(){img.css("top","0px")}))}),2e3*scrolltime)}})),(0,_jquery.default)(document).on("mouseleave",".addblock-modal-body .block-page-layout",(function(){const img=(0,_jquery.default)(this).find(".card img");img.css("transition","unset"),img.css("top","0px"),clearInterval(scrollInterval)})),(0,_jquery.default)(document).on("click",".advancedblocktab .left-sidebar .category-list-item .edw-icon",(function(e){e.stopPropagation(),e.preventDefault();var categoryFilter=(0,_jquery.default)(this).closest(".category-list-item").data("filter"),selectedElement=(0,_jquery.default)(".".concat(SELECTORS_LEFTSIDEBARMIDREGIN,' .category-list-item[data-filter="').concat(categoryFilter,'"][data-target="all"]'));selectedElement.addClass("active").siblings('[data-filter="'+categoryFilter+'"]').removeClass("active"),applyFilterOnBlocks(selectedElement),(0,_jquery.default)(".block-category-list-desktop").animate({scrollTop:0},{duration:"smooth",complete:function(){(0,_jquery.default)(this).stop(!0,!0)}})})),(0,_jquery.default)(document).on("click",".advancedblocktab .left-sidebar .category-selector",(function(){applySelectedCategory(this),applyFilterOnBlocks((0,_jquery.default)(this))})),(0,_jquery.default)(document).off("click",".block_exporter_btn").on("click",".block_exporter_btn",(async function(e){e.stopPropagation(),e.preventDefault();try{const blockid=(0,_jquery.default)(this).data("blockid"),request={methodname:"local_edwiserpagebuilder_do_import_export_action",args:{action:"export_blocks_data",config:JSON.stringify({blockid:blockid})}};let response=await _ajax.default.call([request])[0];if(response=JSON.parse(response),response.error)return void alert("Error: "+response.message);const blob=new Blob([JSON.stringify(response,null,2)],{type:"application/json"}),filename="block_".concat(blockid,".json"),link=document.createElement("a");link.href=URL.createObjectURL(blob),link.download=filename,document.body.appendChild(link),link.click(),document.body.removeChild(link),URL.revokeObjectURL(link.href),console.log("Export successful")}catch(error){console.error("Export failed:",error)}})),(0,_jquery.default)(document).off("submit",".block_json_upload_form").on("submit",".block_json_upload_form",(function(e){e.preventDefault();const form=(0,_jquery.default)(this),submitButton=form.find('button[type="submit"]');submitButton.prop("disabled",!0);const file=form.find(".jsonfileholder")[0].files[0],blockid=form.closest("section.block_edwiseradvancedblock").attr("data-instance-id");if(file){const reader=new FileReader;reader.onload=async function(event){let fileContent=event.target.result;try{fileContent=JSON.parse(fileContent)}catch(err){return console.error("Invalid JSON file content"),alert("The selected file contains invalid JSON."),void submitButton.prop("disabled",!1)}const request={methodname:"local_edwiserpagebuilder_do_import_export_action",args:{action:"import_blocks_data",config:JSON.stringify({blockid:blockid,blockdata:fileContent})}};try{let response=await _ajax.default.call([request])[0];if(response=JSON.parse(response),"success"==response.status)window.location.reload();else{form.find(".block_import_exporterrormsg").remove();const errorMessage='<p class="block_import_exporterrormsg " style="margin-top: 16px;margin-bottom: 0px;color: #B60011;font-size: 12px;font-style: normal;font-weight: 400">'.concat(response.message,"</p>");submitButton.before(errorMessage)}}catch(err){console.error("Error with AJAX request:",err)}finally{submitButton.prop("disabled",!1)}},reader.onerror=function(){console.error("Error reading the file"),submitButton.prop("disabled",!1)},reader.readAsText(file)}else submitButton.prop("disabled",!1)})),(0,_jquery.default)(document).ready((function(){(0,_jquery.default)("section.block_edwiseradvancedblock").each((function(){(0,_jquery.default)(this).find("[data-edwiser-dynamic]").length>0&&(0,_jquery.default)(this).find(".block_exporter_btn").hide()}))}))},_ajax=_interopRequireDefault(_ajax),_jquery=_interopRequireDefault(_jquery);const SELECTORS_DEFAULTBLOCKWRAPPER=".modal-body  .default-blocks-wrapper",SELECTORS_ADDBLOCKGRIDVIEW=".add-block-grid-view",SELECTORS_ADDBLOCKLISTVIEW=".add-block-list-view",SELECTORS_DYNAMICBLOCKSWRAPPER="dynamic-blocks-wrapper",SELECTORS_STATICBLOCKSWRAPPER="static-blocks-wrapper",SELECTORS_BLOCKLAYOUTWRAPPER="block-layout-wrapper",SELECTORS_DYNAMICBLOCKSFILTERS="dynamic-blocks-filters",SELECTORS_STATICBLOCKSFILTERS="static-blocks-filters",SELECTORS_BLOCKLAYOUTFILTERS="block-layout-filters",SELECTORS_LEFTSIDEBARMIDREGIN="left-sidebar-mid-region",SELECTORS_COMMONBLOCKWRAPPER="common-block-wrapper";let activeclassview="grid-view",notactiveclassview="list-view",userprefclass=SELECTORS_ADDBLOCKGRIDVIEW,usernotprefclass=SELECTORS_ADDBLOCKLISTVIEW,templatefile="theme_remui/add_block_body_cards",activeadvancedtab=!0;function applySelectedCategory(category){var categoryFilter=(0,_jquery.default)(category).data("filter"),categorytarget=(0,_jquery.default)(category).data("target"),categoryListItem=(0,_jquery.default)('.block-category-list-desktop .category-list-item[data-target="'+categorytarget+'"][data-filter="'+categoryFilter+'"]'),categoryDropdownItem=(0,_jquery.default)('.block-category-select-mob .dropdown-item[data-target="'+categorytarget+'"][data-filter="'+categoryFilter+'"]');(0,_jquery.default)(categoryListItem).addClass("active").siblings('[data-filter="'+categoryFilter+'"]').removeClass("active"),categoryDropdownItem.length>1&&(categoryDropdownItem.slice(1).remove(),categoryDropdownItem=categoryDropdownItem.first());var text=(0,_jquery.default)(categoryDropdownItem).text();(0,_jquery.default)(".block-category-select-mob .dropdown-toggle").text(text),(0,_jquery.default)(categoryDropdownItem).addClass("active").siblings('[data-filter="'+categoryFilter+'"]').removeClass("active")}function applyFilterOnBlocks(selector){var target=selector.data("target"),categoryselector=target+"-blocks";"all"==target?((0,_jquery.default)(".".concat(SELECTORS_COMMONBLOCKWRAPPER)).addClass("show").removeClass("hide"),(0,_jquery.default)(".addblock-modal-body .tab-content").scrollTop("0px")):((0,_jquery.default)(".".concat(categoryselector)).addClass("show").removeClass("hide").siblings().addClass("hide").removeClass("show"),(0,_jquery.default)(".addblock-modal-body .tab-content").scrollTop("0px"))}}));

//# sourceMappingURL=addblockaddedlistners.min.js.map