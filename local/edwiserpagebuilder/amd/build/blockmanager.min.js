define("local_edwiserpagebuilder/blockmanager",["local_edwiserpagebuilder/jquery","core/ajax","core/templates","core/modal_factory","core/modal_events","core/str"],(function($,Ajax,Templates,ModalFactory,ModalEvents,Str){var refaddBlockModalUrl="",blockpagetype="";const load=()=>{$(document).ready((function(){let epbcustommodal=".epb_custom_modal.modal",layoutContainer=epbcustommodal+" .modal-body .addblock-modal-body.layout-list",blockContainer=epbcustommodal+" .modal-body .addblock-modal-body.blocks-list",categoriesListDesktop=epbcustommodal+" .modal-content .left-sidebar .block-category-list-desktop",categoriesListMob=epbcustommodal+" .modal-content .left-sidebar .block-category-select-mob .dropdown-menu",updateinfoalertext=".updateinfoalert .updateinfotext";function updateBlockContent(ele,islayout){$(ele).attr("disabled",!0),$(ele).find(".edw-icon").addClass(" rotate"),Ajax.call([{methodname:"edwiserpagebuilder_update_block_content",args:{blockname:$(ele).attr("data-blockname"),islayout:islayout},done:function(data){$(ele).find(".edw-icon").removeClass("rotate"),0==data.status?updateButton(ele):$(ele).attr("disabled",!1)},fail:function(){$(ele).find(".edw-icon").removeClass("rotate"),$(ele).attr("disabled",!1),$(updateinfoalertext).text("Something Went Wrong"),$(".updateinfoalert").removeClass("d-none").removeClass("bg-success").addClass("bg-danger"),setTimeout((function(){$(".updateinfoalert").addClass("d-none bg-success").removeClass("bg-danger")}),1500)}}])}function delete_content(id,islayout){Ajax.call([{methodname:"local_edwiserpagebuilder_delete_block",args:{id:id,islayout:islayout},done:function(data){if(islayout)var element=layoutContainer;else element=blockContainer;$(element).find('[data-blockid="'+id+'"]').remove(),$(updateinfoalertext).text("Successfully deleted!"),$(".updateinfoalert").removeClass("d-none"),setTimeout((function(){$(".updateinfoalert").addClass("d-none")}),1500)},fail:function(data){console.log("We are failure"),console.log(data),$(updateinfoalertext).text("Deletion failure"),$(".updateinfoalert").removeClass("d-none").removeClass("bg-success").addClass("bg-danger"),setTimeout((function(){$(".updateinfoalert").addClass("d-none bg-success").removeClass("bg-danger")}),1500)}}])}function updateButton(button){$(button).find(".edw-icon").removeClass("edw-icon-Refresh").addClass("edw-icon-Check").css("color","green")}$("#epbaddblockbutton").on("click",(function(){$(epbcustommodal).removeClass("d-none")})),$(document).on("click",".epb_custom_modal.modal .modal-content .show-layouts",(function(){$("#epb_custom_modal .modal-content").removeClass("blocklist").addClass("layoutlist")})),$(document).on("click",".epb_custom_modal.modal .modal-content .show-blocks",(function(){$("#epb_custom_modal .modal-content").removeClass("layoutlist").addClass("blocklist")})),$(document).on("click",".epb_custom_modal.modal .modal-body .addblock-modal-body.layout-list .islayout a",(function(e){e.preventDefault()})),$(document).on("click","#epbaddblockbutton",(function(){$(epbcustommodal).removeClass("d-none")})),$(".epb_custom_modal.modal .modal-content .close,.epb_custom_modal.modal .modal-content .cancel").on("click",(function(){$(epbcustommodal).addClass("d-none")})),$(document).on("click",".epb_custom_modal.modal .modal-content .blocks-list .card-footer .update-content",(function(){updateBlockContent(this,!1)})),$(document).on("click",".epb_custom_modal.modal .modal-content .left-sidebar .card-footer .update-content",(function(){updateBlockContent(this,!1)})),$(document).on("click",".epb_custom_modal.modal .modal-content .layout-list .card-footer .update-content",(function(){updateBlockContent(this,!0)})),$(document).one("click",".epb_custom_modal.modal .modal-content .action-buttons-modal .updateblocklist",(function(){let _this=this;$(_this).attr("disabled",!0),$(_this).find(".fa").removeClass("fa-download").addClass("rotate");$(_this).next().val();Ajax.call([{methodname:"edwiserpagebuilder_fetch_blocks_list",args:{edwpageurl:refaddBlockModalUrl,contextid:M.cfg.contextid,blockpage:blockpagetype},done:function(data){var categoryfilter,target,categoryselector;$(_this).find(".fa").removeClass("rotate"),1==data.status?($(blockContainer+" .edwblock-content").empty(),$(categoriesListDesktop).empty(),$(categoriesListMob).empty(),$(blockContainer+" .edwblock-content").html(data.html),$(categoriesListDesktop).html(data.categoriesDesktophtml),$(categoriesListMob).html(data.categoriesMobHtml),categoryfilter=$(".edwiser-custom-blocks-nav .nav-link.active").data("filter"),target=$('.left-sidebar-mid-region .category-list-item.active[data-filter="'+categoryfilter+'"]').data("target"),categoryselector=target+"-blocks","all"==target?$(".common-block-wrapper").addClass("show").removeClass("hide"):$(".".concat(categoryselector)).addClass("show").removeClass("hide").siblings().addClass("hide").removeClass("show"),$(_this).removeClass("btn-primary").addClass("btn-success d-none"),$(".updateinfoalert").removeClass("d-none"),setTimeout((function(){$(".updateinfoalert").addClass("d-none")}),1500),console.log($(".edwiseradvancedblocktab").hasClass("active")),$(".edwiseradvancedblocktab").hasClass("active")||$(".advanceblockblocks").addClass("d-none")):($(_this).attr("disabled",!1),$(updateinfoalertext).text("Something Went Wrong"),$(".updateinfoalert").removeClass("d-none"))},fail:function(){$(_this).find(".fa").removeClass("rotate"),$(_this).attr("disabled",!1)}}])})),$(document).on("click",".epb_custom_modal.modal .modal-content .action-buttons-modal .updatelayoutlist",(function(){let _this=this;$(_this).attr("disabled",!0),$(_this).find(".fa").removeClass("fa-download").addClass("fa-refresh rotate"),Ajax.call([{methodname:"edwiserpagebuilder_fetch_layout_list",args:{},done:function(data){$(_this).find(".fa").removeClass("rotate"),1==data.status?($(layoutContainer+" .block-cards").empty().prepend(data.html),updateButton(_this)):$(_this).attr("disabled",!1)},fail:function(){$(_this).find(".fa").removeClass("rotate"),$(_this).attr("disabled",!1)}}])})),$(document).on("click",".epb_custom_modal.modal .modal-body .addblock-modal-body.blocks-list .card .delete-content",(function(){delete_content($(this).data("blockid"),!1)})),$(document).on("click",".epb_custom_modal.modal .modal-body .addblock-modal-body.layout-list .card .delete-content",(function(){delete_content($(this).data("blockid"),!0)})),$(document).on("click",".block-page-layout-btn",(function(){var blockregion=$(this).attr("data-block-region"),blocklayout=$(this).attr("data-block"),blockpagetype=$(this).attr("block-pagetypepattern"),pagesubtype="",blockregionvisiblename=blockregion;"undefined"!=typeof currentpagesubtype&&(pagesubtype=currentpagesubtype),"undefined"!=typeof regionsnamearray&&(blockregionvisiblename=regionsnamearray[blockregion]),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:Str.get_string("showblocklayoutaddhead","local_edwiserpagebuilder"),body:Str.get_string("showblocklayoutaddbody","local_edwiserpagebuilder",blockregionvisiblename)}).done((function(modal){modal.setSaveButtonText("Yes"),modal.getRoot().on(ModalEvents.save,(function(){!function(blocklayout,blockpagetype,blockregion,pagesubtype){Ajax.call([{methodname:"local_edwiserpagebuilder_add_adv_block_layout",args:{layout:blocklayout,pagetype:blockpagetype,region:blockregion,subpagetypepattern:pagesubtype,courseid:M.cfg.courseId,contextinstanceid:M.cfg.contextInstanceId},done:function(data){data.status&&location.reload(!0),data.status||ModalFactory.create({title:Str.get_string("showblocklayoutaddhead","local_edwiserpagebuilder"),body:data.msg}).done((function(modal){modal.show()}))},fail:function(data){console.log("We are failure"),console.log(data)}}])}(blocklayout,blockpagetype,blockregion,pagesubtype)})),modal.show()}))}))}))};return{load:function(addBlockModalUrl,pageType){refaddBlockModalUrl=addBlockModalUrl,blockpagetype=pageType,load()}}}));

//# sourceMappingURL=blockmanager.min.js.map