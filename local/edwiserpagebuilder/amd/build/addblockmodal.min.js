define("local_edwiserpagebuilder/addblockmodal",["exports","local_edwiserpagebuilder/jquery","core/modal_factory","core/modal_events","core/templates","core/str","core/ajax","local_edwiserpagebuilder/blockmanager"],(function(_exports,_jquery,_modal_factory,_modal_events,_templates,_str,_ajax,_blockmanager){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Show an add block modal instead of doing it on a separate page.
   *
   * @module     core/addblockmodal
   * @copyright  2016 Damyon Wiese <damyon@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax),_blockmanager=_interopRequireDefault(_blockmanager);const SELECTORS_ADD_BLOCK='[data-key="addblock"]';let listenerEventsRegistered=!1;const registerListenerEvents=async(pageType,pageLayout,addBlockUrl,subPage,issiteadmin,edwepbf,pbfnotenable)=>{document.addEventListener("click",(e=>{const addBlock=e.target.closest(SELECTORS_ADD_BLOCK);if(addBlock){e.preventDefault();let addBlockModal=null,addBlockModalUrl=null!=addBlockUrl?addBlockUrl:addBlock.dataset.url;buildAddBlockModal().then((modal=>{modal.getRoot().addClass("epb_custom_modal"),modal.getRoot().on(_modal_events.default.cancel,(function(e){e.preventDefault(),modal.destroy()})),addBlockModal=modal;const modalBody=renderBlocks(addBlockModalUrl,pageType,pageLayout,subPage,issiteadmin,edwepbf,pbfnotenable);return modal.setBody(modalBody),modal.show(),_blockmanager.default.load(addBlockModalUrl,pageType),modalBody})).catch((()=>{addBlockModal.destroy()}))}}))},buildAddBlockModal=()=>_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:(0,_str.get_string)("addblock")}),renderBlocks=async(addBlockUrl,pageType,pageLayout,subPage,issiteadmin,edwepbf,pbfnotenable)=>{var _blockscontext,_blockscontext2,_blockscontext3,_blockscontext4;let blockscontext=await getAddableBlocks(pageType,pageLayout,subPage);blockscontext=JSON.parse(blockscontext);var filterplugindata=!1,showfilterreleaseinfo=!1;if(edwepbf&&!pbfnotenable){filterplugindata=await getfilterpluginstatus();(filterplugindata=JSON.parse(filterplugindata)).release<="4.2.2"&&(pbfnotenable=!1,showfilterreleaseinfo=!0)}var showmodalsecondnav=!1;"undefined"!=typeof edwremuithemeinfo&&"available"==edwremuithemeinfo&&(showmodalsecondnav=!0);var match=addBlockUrl.match(/[?&]bui_blockregion=([^&]+)/),region=match?match[1]:"";return _templates.default.render("local_edwiserpagebuilder/add_block_body",{blockscontext:null===(_blockscontext=blockscontext)||void 0===_blockscontext?void 0:_blockscontext.blockscontext,htmlblock:null===(_blockscontext2=blockscontext)||void 0===_blockscontext2?void 0:_blockscontext2.htmlblock,importblock:null===(_blockscontext3=blockscontext)||void 0===_blockscontext3?void 0:_blockscontext3.importblock,categories:null===(_blockscontext4=blockscontext)||void 0===_blockscontext4?void 0:_blockscontext4.categories,moodleblock:blockscontext.moodleblock,url:addBlockUrl,isadmin:issiteadmin,pbfpluginexist:edwepbf,edwpbfnotenable:pbfnotenable,blockpagetype:pageType,blockregion:region,showsecondmenu:showmodalsecondnav,showfilterreleasenotice:showfilterreleaseinfo})},getAddableBlocks=async(pageType,pageLayout,subPage)=>{const request={methodname:"local_edwiserpagebuilder_fetch_addable_blocks",args:{pagecontextid:M.cfg.contextid,pagetype:pageType,pagelayout:pageLayout,subpage:subPage}};return _ajax.default.call([request])[0]},getfilterpluginstatus=async(pageType,pageLayout,subPage)=>_ajax.default.call([{methodname:"local_edwiserpagebuilder_get_filter_plugin_status",args:{config:""}}])[0];_exports.init=function(pageType,pageLayout){let addBlockUrl=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,subPage=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",issiteadmin=arguments.length>4&&void 0!==arguments[4]&&arguments[4],edwepbf=arguments.length>5&&void 0!==arguments[5]&&arguments[5],pbfnotenable=arguments.length>6&&void 0!==arguments[6]&&arguments[6];edwepbf=0!=edwepbf,issiteadmin=0!=issiteadmin,pbfnotenable=0!=pbfnotenable,listenerEventsRegistered||(registerListenerEvents(pageType,pageLayout,addBlockUrl,subPage,issiteadmin,edwepbf,pbfnotenable),listenerEventsRegistered=!0)}}));

//# sourceMappingURL=addblockmodal.min.js.map