define("local_edwiserpagebuilder/custompages",["local_edwiserpagebuilder/jquery","core/ajax","core/templates","core/modal_factory","core/modal_events","core/str","core/notification"],(function($,Ajax,Templates,ModalFactory,ModalEvents,str,Notification){const SELECTORS_ADDNEWPAGESEL=".epb-addnewpage",SELECTORS_TITLEINPUT="epbpagetitle",SELECTORS_TITLEINPUTSEL="#epbpagetitle",SELECTORS_NEXTBTN="activatepagecreation",SELECTORS_NEXTBTNSEL=".activatepagecreation",SELECTORS_PAGELAYOUTWRAPPERSEL=".page-layouts-wrapper",SELECTORS_LAYOUTSRADIOBTNSEL='input[name="layoutsradiobtn"]',SELECTORS_PREVIEWLAYOUTBTNSEL=".btn_view_icon",SELECTORS_PREVIEWLAYOUT=".layout-preview",SELECTORS_CLOSELAYOUTBTNSEL=".layout_close_btn",SELECTORS_CHOOSEDEFAULTLAYOUTSEL=".default .btn_add_block",SELECTORS_LAYOUTBODYSEL=".modal_card_body",strings=[{key:"addnewpage",component:"local_edwiserpagebuilder"},{key:"next",component:"local_edwiserpagebuilder"},{key:"pagetitle",component:"local_edwiserpagebuilder"},{key:"back",component:"local_edwiserpagebuilder"},{key:"create",component:"local_edwiserpagebuilder"},{key:"select",component:"local_edwiserpagebuilder"},{key:"chooselayout",component:"local_edwiserpagebuilder"}];var LANGS,titlemodal,layoutmodal;const fetchLanguages=()=>{str.get_strings(strings).then((function(results){return LANGS=results,results}))},createpagefromscratch=(title,layoutid)=>{Ajax.call([{methodname:"local_edwiserpagebuilder_do_page_action",args:{action:"add_new_page_with_layoutid",config:JSON.stringify({title:title,layoutid:layoutid})},done:function(response){id=JSON.parse(response);let newUrl=M.cfg.wwwroot+"/local/edwiserpagebuilder/pagedraft.php?id="+id;window.location.href=newUrl},fail:function(ex){Notification.exception(ex)}}])};function addBlankLayoutOnExistingPage(pageid,layoutid){Ajax.call([{methodname:"local_edwiserpagebuilder_do_page_action",args:{action:"add_layout_on_exisiting_page",config:JSON.stringify({pageid:pageid,layoutid:layoutid})},done:function(response){id=JSON.parse(response);let newUrl=M.cfg.wwwroot+"/local/edwiserpagebuilder/pagedraft.php?id="+id;window.location.href=newUrl},fail:function(ex){Notification.exception(ex)}}])}const openLayoutSelector=async function(callback){let onlylayout=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var loaderurl=M.cfg.wwwroot+"/local/edwiserpagebuilder/pix/siteinnerloader.svg";layoutmodal=await ModalFactory.create({title:onlylayout?LANGS[6]:LANGS[0],type:ModalFactory.types.SAVE_CANCEL,body:'\n            <div class="page-layouts-wrapper section-modal-body">\n                <div class="addnewpageform d-flex justify-content-center align-items-center">\n                    <img src="'.concat(loaderurl,'" alt="spinner"/>\n                </div>\n            </div>\n            ')}).done((function(modal){onlylayout?modal.setButtonText("save",LANGS[5]):(modal.setButtonText("cancel",LANGS[3]),$(modal.getActionSelector("cancel")).addClass("border-0"),modal.setButtonText("save",LANGS[4]));var extraclasses="fullwidth-modal layout-chooser";extraclasses+=onlylayout?" onlylayout":"",modal.getModal().parent().addClass(extraclasses),modal.show()})),$(layoutmodal.getActionSelector("save")).addClass("btn-disabled"),$(document).on("change",SELECTORS_LAYOUTSRADIOBTNSEL,(function(){$(layoutmodal.getActionSelector("save")).removeClass("btn-disabled")})),$(document).on("click",SELECTORS_LAYOUTBODYSEL,(function(){let layoutid=$(this).data("layoutid");$("".concat(SELECTORS_LAYOUTSRADIOBTNSEL,"[value=").concat(layoutid,"]")).prop("checked",!0),$(layoutmodal.getActionSelector("save")).removeClass("btn-disabled")})),$(document).on("click",SELECTORS_CHOOSEDEFAULTLAYOUTSEL,(function(){var title=$(SELECTORS_TITLEINPUTSEL).val(),pageclassdata=$("body").attr("class").match(/epb-showlayout-(\d+)/);null!=pageclassdata&&pageclassdata.length>0?addBlankLayoutOnExistingPage(pageclassdata[1],0):createpagefromscratch(title,0)})),layoutmodal.getRoot().on(ModalEvents.destroyed,(()=>{titlemodal.destroy()})),layoutmodal.getRoot().on(ModalEvents.save,(e=>{var layoutid=$(SELECTORS_LAYOUTSRADIOBTNSEL+":checked").val();callback(layoutid),onlylayout&&titlemodal.destroy()})),fetchLayoutTemplates("local_edwiserpagebuilder/select_page_layout").then((layouts=>{$(SELECTORS_PAGELAYOUTWRAPPERSEL).empty().append(layouts.pagelayoutjson)}))},fetchLayoutTemplates=async function(){let templatename=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";var param={templatename:templatename};const request={methodname:"local_edwiserpagebuilder_epb_fetch_layout_templates",args:param};return Ajax.call([request])[0]},addLayoutOnPage=(pageid,layoutid)=>{Ajax.call([{methodname:"local_edwiserpagebuilder_do_page_action",args:{action:"edw_publish_page_on_pageid",config:JSON.stringify({pageid:pageid,layoutid:layoutid})},done:function(response){id=JSON.parse(response);let newUrl=M.cfg.wwwroot+"/local/edwiserpagebuilder/pagedraft.php?id="+id;window.location.href=newUrl},fail:function(ex){Notification.exception(ex)}}])},registerEvents=()=>{$(SELECTORS_ADDNEWPAGESEL).on("click",(function(){(async()=>{(titlemodal=await ModalFactory.create({title:LANGS[0],body:'\n            <div class="addnewpageform">\n                <div class="form-group">\n                    <label for="'.concat(SELECTORS_TITLEINPUT,'" class="label h-semibold-6">').concat(LANGS[2],'</label>\n                    <input id="').concat(SELECTORS_TITLEINPUT,'" name="').concat(SELECTORS_TITLEINPUT,'" class="form-control"/>\n                </div>\n                <button class="btn btn-primary btn-disabled float-right ').concat(SELECTORS_NEXTBTN,'" disabled="true">\n                    ').concat(LANGS[1],'\n                    <span class="edw-icon edw-icon-Right-Arrow font-size-16">\n                </button>\n            </div>\n            ')})).show()})()})),$(document).on("click",SELECTORS_NEXTBTNSEL,(function(){var title=$(SELECTORS_TITLEINPUTSEL).val();openLayoutSelector((function(layoutid){createpagefromscratch(title,layoutid)}))})),$(document).on("keyup",SELECTORS_TITLEINPUTSEL,(function(){0==$(this).val().length?$(SELECTORS_NEXTBTNSEL).addClass("btn-disabled").prop("disabled",!0):$(SELECTORS_NEXTBTNSEL).removeClass("btn-disabled").prop("disabled",!1)})),$(document).on("click",SELECTORS_PREVIEWLAYOUTBTNSEL,(function(){let layoutid=$(this).data("layoutid");$("".concat(SELECTORS_PREVIEWLAYOUT,"-").concat(layoutid)).removeClass("d-none")})),$(document).on("click",SELECTORS_CLOSELAYOUTBTNSEL,(function(){let layoutid=$(this).data("layoutid");$("".concat(SELECTORS_PREVIEWLAYOUT,"-").concat(layoutid)).addClass("d-none")}))};return{init:()=>{fetchLanguages(),registerEvents()},initLayoutSelector:pageid=>{LANGS=fetchLanguages();setTimeout((()=>{openLayoutSelector((function(layoutid){addLayoutOnPage(pageid,layoutid)}),true)}),"1000")}}}));

//# sourceMappingURL=custompages.min.js.map