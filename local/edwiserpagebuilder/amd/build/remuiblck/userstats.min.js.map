{"version":3,"file":"userstats.min.js","sources":["../../src/remuiblck/userstats.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable max-len */\n/* eslint-disable require-jsdoc */\ndefine(['jquery', 'core/ajax', 'local_edwiserpagebuilder/remuiblck/chartjs','local_edwiserpagebuilder/remuiblck/bootstrap-select'], function($, Ajax) {\n\n    var SELECTORS = {\n        PIE_CHART_BLOCK: '#epb-pieChartblock',\n        COURSE_CATEGORY_LISTBLOCK: '#epb-coursecategorylistblock',\n        ENROLL_STATS_NOUSERERROR: '.epb-enroll-stats-nouserserror',\n        CHART_LEGEND: '.epb-chart-legend',\n        ENROLL_STATS_ERROR: '.epb-enroll-stats-error',\n    };\n\n    var myDoughnuts = {};\n    var legendtemplatestr1 = \"<ul class=\\\"<%=name.toLowerCase()%>-legend\\\"><% for (var i=0; i<segments.length; i++){%>\";\n    var legendtemplatestr2 = \"<span style=\\\"background-color:<%=segments[i].fillColor%>\\\"></span>\";\n    var legendtemplatestr3 = \"<%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>\";\n    var pieOptions = {\n        // Boolean - Whether we should show a stroke on each segment\n        segmentShowStroke: true,\n        // String - The colour of each segment stroke\n        segmentStrokeColor: \"#fff\",\n        // Number - The width of each segment stroke\n        segmentStrokeWidth: 1,\n        // Number - The percentage of the chart that we cut out of the middle\n        percentageInnerCutout: 50, // This is 0 for Pie charts\n        // Number - Amount of animation steps\n        animationSteps: 100,\n        // String - Animation easing effect\n        /* animation: {\n            duration: 2000,\n            easing: \"easeOutBounce\"\n        },*/\n        // Boolean - Whether we animate the rotation of the Doughnut\n        animateRotate: true,\n        // Boolean - Whether we animate scaling the Doughnut from the centre\n        animateScale: false,\n        // Boolean - whether to make the chart responsive to window resizing\n        responsive: true,\n        // Boolean - whether to maintain the starting aspect ratio or not when responsive,\n        // if set to false, will take up entire container\n        maintainAspectRatio: true,\n        // String - A legend template\n        legendTemplate: legendtemplatestr1 + legendtemplatestr2 + legendtemplatestr3,\n        // String - A tooltip template\n        tooltipTemplate: \"<%=value %> <%=label%> users\",\n        legend: {\n            display: false,\n        },\n        plugins: {\n            legend: {\n              display: false\n            }\n        }\n    };\n\n    /**\n     * @param {String} response\n     */\n    function renderPieChart(response, root, uniqid) {\n\n        if (myDoughnuts[uniqid] && myDoughnuts[uniqid] !== null) {\n            myDoughnuts[uniqid].destroy();\n        }\n\n        var pieChartCanvas = $(root + \" \" + SELECTORS.PIE_CHART_BLOCK).get(0).getContext(\"2d\");\n\n        var doughnutData = {\n            labels: response.labels,\n            datasets: [{\n                data: response.data,\n                backgroundColor: response.background_color,\n                hoverBackgroundColor: response.hoverBackground_color,\n            }]\n        };\n\n        myDoughnuts[uniqid] = new Chart(pieChartCanvas, {type: 'doughnut', data: doughnutData, options: pieOptions});\n    }\n\n\n    /**\n     *\n     */\n    function createpiechart(root, uniqid) {\n        var categoryId = $(root + \" \" + SELECTORS.COURSE_CATEGORY_LISTBLOCK + ' option:selected').data('id');\n        Ajax.call([{\n            methodname: 'local_edwiserpagebuilder_remuiblck_action',\n            args: {\n                action: \"get_enrolled_users_by_category\",\n                config: JSON.stringify({\n                    \"categoryid\": categoryId,\n                })\n            }\n\n        }])[0].done(function(response) {\n            response = JSON.parse(response);\n            if (response === null) {\n                $(root + ' canvas' + SELECTORS.PIE_CHART_BLOCK).hide();\n                $(root + ' ' + SELECTORS.ENROLL_STATS_NOUSERERROR).hide();\n                $(root + ' ' + SELECTORS.CHART_LEGEND).hide();\n                $(root + ' ' + SELECTORS.ENROLL_STATS_ERROR).show();\n            } else {\n                $(root + ' ' + SELECTORS.ENROLL_STATS_ERROR).hide();\n                $(root + ' ' + SELECTORS.ENROLL_STATS_NOUSERERROR).hide();\n                $(root + ' ' + SELECTORS.CHART_LEGEND).show();\n                $(root + ' canvas' + SELECTORS.PIE_CHART_BLOCK).show();\n\n                $(root + ' ' + SELECTORS.CHART_LEGEND).empty();\n                var colors = ['#264485', '#0051F9', '#37BE71', '#4caf50', '#8bc34a', '#ffeb3b', '#ff9800', '#f44336', '#9c27b0', '#673ab7', '#3f51b5'];\n                $.each(response.labels, function (index, value) {\n                    $(root + ' ' + SELECTORS.CHART_LEGEND).append('<li class=\"list-group-item d-flex align-items-center flex-gap-4 p-0\"><span class=\"badge badge-round text-trasparent\" style=\"background-color:' + colors[index] + ';\">1</span>' + '<span >' + value + ':' + '<span class=\"st-count\">' + response.data[index] + '</span>' + '</span>' + '</li>');\n                });\n\n                renderPieChart(response, root, uniqid);\n            }\n\n        }).fail(function() {\n            $(root + ' canvas' + SELECTORS.PIE_CHART_BLOCK).hide();\n            $(root + ' ' + SELECTORS.ENROLL_STATS_ERROR).show();\n        });\n    }\n\n    // Update pie chart on category selection\n    function initializeEvents(root, uniqid) {\n        if ($(root + ' select').length) {\n            $(root + ' select' + SELECTORS.COURSE_CATEGORY_LISTBLOCK).on('change', function() {\n                createpiechart(root, uniqid);\n            });\n            createpiechart(root, uniqid);\n        }\n        $(root + ' ' + SELECTORS.COURSE_CATEGORY_LISTBLOCK).selectpicker();\n    }\n\n\n    var init = function(root, uniqid) {\n        $(document).ready(function() {\n            initializeEvents(root, uniqid);\n        });\n    };\n\n    return {\n        init: init\n    };\n    // ----------------------------------\n    // - END PIE CHART - DOUGHNUT\n    // ----------------------------------\n\n});\n"],"names":["define","$","Ajax","SELECTORS","myDoughnuts","pieOptions","segmentShowStroke","segmentStrokeColor","segmentStrokeWidth","percentageInnerCutout","animationSteps","animateRotate","animateScale","responsive","maintainAspectRatio","legendTemplate","legendtemplatestr1","tooltipTemplate","legend","display","plugins","createpiechart","root","uniqid","categoryId","data","call","methodname","args","action","config","JSON","stringify","done","response","parse","hide","show","empty","colors","each","labels","index","value","append","destroy","pieChartCanvas","get","getContext","doughnutData","datasets","backgroundColor","background_color","hoverBackgroundColor","hoverBackground_color","Chart","type","options","renderPieChart","fail","init","document","ready","length","on","selectpicker","initializeEvents"],"mappings":"AAGAA,sDAAO,CAAC,SAAU,YAAa,6CAA6C,wDAAwD,SAASC,EAAGC,UAExIC,0BACiB,qBADjBA,oCAE2B,+BAF3BA,mCAG0B,iCAH1BA,uBAIc,oBAJdA,6BAKoB,0BAGpBC,YAAc,GAIdC,WAAa,CAEbC,mBAAmB,EAEnBC,mBAAoB,OAEpBC,mBAAoB,EAEpBC,sBAAuB,GAEvBC,eAAgB,IAOhBC,eAAe,EAEfC,cAAc,EAEdC,YAAY,EAGZC,qBAAqB,EAErBC,eAAgBC,8NAEhBC,gBAAiB,+BACjBC,OAAQ,CACJC,SAAS,GAEbC,QAAS,CACLF,OAAQ,CACNC,SAAS,cAgCVE,eAAeC,KAAMC,YACtBC,WAAavB,EAAEqB,KAAO,IAAMnB,oCAAsC,oBAAoBsB,KAAK,MAC/FvB,KAAKwB,KAAK,CAAC,CACPC,WAAY,4CACZC,KAAM,CACFC,OAAQ,iCACRC,OAAQC,KAAKC,UAAU,YACLR,iBAItB,GAAGS,MAAK,SAASC,aAEA,QADjBA,SAAWH,KAAKI,MAAMD,WAElBjC,EAAEqB,KAAO,UAAYnB,2BAA2BiC,OAChDnC,EAAEqB,KAAO,IAAMnB,oCAAoCiC,OACnDnC,EAAEqB,KAAO,IAAMnB,wBAAwBiC,OACvCnC,EAAEqB,KAAO,IAAMnB,8BAA8BkC,WAC1C,CACHpC,EAAEqB,KAAO,IAAMnB,8BAA8BiC,OAC7CnC,EAAEqB,KAAO,IAAMnB,oCAAoCiC,OACnDnC,EAAEqB,KAAO,IAAMnB,wBAAwBkC,OACvCpC,EAAEqB,KAAO,UAAYnB,2BAA2BkC,OAEhDpC,EAAEqB,KAAO,IAAMnB,wBAAwBmC,YACnCC,OAAS,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAC5HtC,EAAEuC,KAAKN,SAASO,QAAQ,SAAUC,MAAOC,OACrC1C,EAAEqB,KAAO,IAAMnB,wBAAwByC,OAAO,gJAAkJL,OAAOG,OAAzJ,qBAA8LC,MAA9L,2BAAwOT,SAAST,KAAKiB,OAAtP,mCAnDtCR,SAAUZ,KAAMC,QAEhCnB,YAAYmB,SAAmC,OAAxBnB,YAAYmB,SACnCnB,YAAYmB,QAAQsB,cAGpBC,eAAiB7C,EAAEqB,KAAO,IAAMnB,2BAA2B4C,IAAI,GAAGC,WAAW,MAE7EC,aAAe,CACfR,OAAQP,SAASO,OACjBS,SAAU,CAAC,CACPzB,KAAMS,SAAST,KACf0B,gBAAiBjB,SAASkB,iBAC1BC,qBAAsBnB,SAASoB,yBAIvClD,YAAYmB,QAAU,IAAIgC,MAAMT,eAAgB,CAACU,KAAM,WAAY/B,KAAMwB,aAAcQ,QAASpD,aAqCxFqD,CAAexB,SAAUZ,KAAMC,YAGpCoC,MAAK,WACJ1D,EAAEqB,KAAO,UAAYnB,2BAA2BiC,OAChDnC,EAAEqB,KAAO,IAAMnB,8BAA8BkC,gBAsB9C,CACHuB,KAPO,SAAStC,KAAMC,QACtBtB,EAAE4D,UAAUC,OAAM,qBAZIxC,KAAMC,QACxBtB,EAAEqB,KAAO,WAAWyC,SACpB9D,EAAEqB,KAAO,UAAYnB,qCAAqC6D,GAAG,UAAU,WACnE3C,eAAeC,KAAMC,WAEzBF,eAAeC,KAAMC,SAEzBtB,EAAEqB,KAAO,IAAMnB,qCAAqC8D,eAMhDC,CAAiB5C,KAAMC"}