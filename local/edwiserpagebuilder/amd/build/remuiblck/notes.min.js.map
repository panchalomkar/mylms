{"version":3,"file":"notes.min.js","sources":["../../src/remuiblck/notes.js"],"sourcesContent":["/* eslint-disable @babel/no-unused-expressions */\ndefine(['jquery', 'core/ajax', 'core/str'], function($, Ajax, Str) {\n     /* Add Notes Block */\n     var SELECTORS = {\n        ADD_NOTE_BUTTON: '.epb-add-notes-button',\n        ADD_NOTE_SELECT: '.epb-add-notes-select',\n        SITE_NOTE: '.epb-site-note',\n        COURSE_NOTE: '.epb-course-note',\n        PERSONAL_NOTE: '.epb-personal-note',\n        STUDENT_LABEL: '.epb-select2-studentlist-label',\n        STUDENT_LIST: '.epb-select2-studentlist',\n        SELECT_STUDENT_NOTE: '.epb-select-note-student',\n        ADD_NOTES_BUTTON_WRAPPER: \".epb-add-notes-button-wrapper\",\n    };\n\n    // ****** IMPORTANT ******\n    // Do not change the sequence.\n    // If you want to add new strings here, add it at the bottom.\n    // Do not remove any string from the array.\n    // There is no way we can revert back if sequence is changed.\n    // ****** IMPORTANT ******\n    const strings = [\n        {key: 'selectastudent', component: 'local_edwiserpagebuilder'},\n        {key: 'nousersenrolledincourse', component: 'local_edwiserpagebuilder'},\n        {key: 'total', component: 'moodle'}\n    ];\n\n    var LANGS; // Gloabl variable to store languages.\n\n    // Functionality to fetch strings.\n    const fetchLanguages = () => {\n        Str.get_strings(strings).then(function(results) {\n            LANGS = results;\n            return results;\n        });\n    };\n\n    function initializeEvents(root) {\n\n        if ($(root + \" \" + SELECTORS.ADD_NOTE_SELECT).length) {\n            $(root + \" \" + SELECTORS.ADD_NOTE_BUTTON).hide();\n            $(root + \" \" + SELECTORS.STUDENT_LABEL).hide();\n            $(root + \" \" + SELECTORS.STUDENT_LIST).hide();\n            var courseId, studentCount, userId, courseName;\n\n            $(root + \" \" + SELECTORS.ADD_NOTE_SELECT + ' select').on('change', function() {\n                $(root + \" \" + SELECTORS.ADD_NOTE_BUTTON).hide();\n                $(root + \" \" + SELECTORS.SELECT_STUDENT_NOTE).removeClass('d-none');\n                courseId = $(this).children(\":selected\").attr(\"id\");\n                courseName = $(this).children(\":selected\").text();\n                if (courseId === undefined) {\n                    $(root + \" \" + SELECTORS.STUDENT_LABEL).hide();\n                    $(root + \" \" + SELECTORS.STUDENT_LIST).empty();\n                    $(root + \" \" + SELECTORS.STUDENT_LIST).hide();\n                    return;\n                }root + \" \" +\n\n                Ajax.call([{\n                    methodname: 'local_edwiserpagebuilder_remuiblck_action',\n                    args: {\n                        action: \"get_enrolled_users_by_course\",\n                        config: JSON.stringify({\n                            \"courseid\": courseId,\n                        })\n                    }\n                }])[0].done(function(response) {\n                    response = JSON.parse(response);\n                    studentCount = Object.keys(response).length;\n                    $(root + \" \" + SELECTORS.STUDENT_LABEL).show();\n                    $(root + \" \" + SELECTORS.STUDENT_LIST).show();\n                    $(root + \" \" + SELECTORS.STUDENT_LIST).empty();\n                    if (studentCount) {\n                        $(root + \" \" + SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\n                            \"selectastudent\", \"local_edwiserpagebuilder\") + ' (' + M.util.get_string(\"total\", \"moodle\") +\n                            ': ' + studentCount + ')</option>');\n\n                        $.each(response, function(index, student) {\n                            $(root + \" \" + SELECTORS.STUDENT_LIST).append('<option value=\"' + student.id + '\">' + student.fullname + '</option>');\n                        });\n\n                    } else {\n                        $(root + \" \" + SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\"nousersenrolledincourse\",\n                            \"local_edwiserpagebuilder\", courseName) + '</option>');\n                    }\n\n                }).fail(function(ex) {\n                    $(root + \" \" + SELECTORS.STUDENT_LIST).html('<option>' + ex.message + '</option>');\n                });\n            });\n\n            $(root + \" \" + SELECTORS.STUDENT_LIST).on('change', function() {\n                $(root + \" \" + SELECTORS.ADD_NOTE_BUTTON).show();\n                $(root + \" \" + SELECTORS.ADD_NOTES_BUTTON_WRAPPER).removeClass('d-none');\n                userId = $(this).find('option:selected').val();\n                var notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                    '&userid=' + userId + '&publishstate=site';\n                $(root + \" \" + SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.SITE_NOTE).attr('href', notesLink);\n                notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                    '&userid=' + userId + '&publishstate=public';\n                $(root + \" \" + SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.COURSE_NOTE).attr('href', notesLink);\n                notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                    '&userid=' + userId + '&publishstate=draft';\n                $(root + \" \" + SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.PERSONAL_NOTE).attr('href', notesLink);\n            });\n        }\n    }\n\n    var init = async function(root) {\n        await fetchLanguages();\n        $(document).ready(function() {\n            initializeEvents(root);\n        });\n    };\n\n    return {\n        init: init\n    };\n    /* End - Add Notes Block */\n});\n"],"names":["define","$","Ajax","Str","SELECTORS","strings","key","component","init","async","root","get_strings","then","results","document","ready","courseId","studentCount","userId","courseName","length","hide","on","removeClass","this","children","attr","text","undefined","empty","call","methodname","args","action","config","JSON","stringify","done","response","parse","Object","keys","show","append","M","util","get_string","each","index","student","id","fullname","fail","ex","html","message","find","val","notesLink","cfg","wwwroot","initializeEvents"],"mappings":"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"}