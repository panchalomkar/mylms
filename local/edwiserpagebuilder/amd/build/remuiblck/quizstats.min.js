define("local_edwiserpagebuilder/remuiblck/quizstats",["local_edwiserpagebuilder/jquery","core/ajax","core/str","local_edwiserpagebuilder/remuiblck/chartjs"],(function($,Ajax,Str){var SELECTORS_CHART="#barChart",SELECTORS_CHART_AREA="#quiz-chart-area",SELECTORS_COURSE_LIST="#quiz-course-list",SELECTORS_QUIZ_LIST="#quiz-list",SELECTORS_LIST_SELECTED="option:selected",SELECTORS_ERROR=".quiz-stats-error";const strings=[{key:"noofstudents",component:"local_edwiserpagebuilder"}];var barCharts={},getStepSize=function(datasets){let current,max=0;return datasets.forEach((function(data){current=Math.max.apply(Math,data.data),max=current>max?current:max})),Math.ceil(max/20)};function createBarChart(root,uniqid){var courseId=getSelectedCourseID(root),quizId=getSelectedQuizID(root);Ajax.call([{methodname:"local_edwiserpagebuilder_remuiblck_action",args:{action:"get_quiz_participation",config:JSON.stringify({courseid:courseId,quizid:quizId})}}])[0].done((function(response){if(void 0===(response=JSON.parse(response)).datasets)$(root).find(SELECTORS_CHART_AREA).hide(),$(root).find(SELECTORS_ERROR).show();else{barCharts[uniqid]&&null!==barCharts[uniqid]&&barCharts[uniqid].destroy();var barcontext=$(root).find(SELECTORS_CHART).get(0).getContext("2d");barcontext.canvas.height=400;var barData={labels:response.labels,datasets:response.datasets};barCharts[uniqid]=new Chart(barcontext,{type:"bar",data:barData,options:{responsive:!0,maintainAspectRatio:!1,scales:{yAxes:[{scaleLabel:{display:!0,labelString:M.util.get_string("noofstudents","local_edwiserpagebuilder"),fontColor:"#4C5A73"},ticks:{min:0,stepSize:getStepSize(response.datasets)},gridLines:{drawBorder:!1}}],xAxes:[{gridLines:{drawBorder:!1,display:!0,borderDash:[8,4],color:"#EBF0F9"},barThickness:38}]},legend:{display:!0,position:"bottom",align:"left",labels:{fontColor:"#4C5A73"}}}})}})).fail((function(){$(root).find(SELECTORS_CHART_AREA).hide(),$(root).find(SELECTORS_ERROR).show()}))}var getSelectedCourseID=function(root){return $(root).find(SELECTORS_COURSE_LIST+" "+SELECTORS_LIST_SELECTED).data("courseid")},getSelectedQuizID=function(root){return $(root).find(SELECTORS_QUIZ_LIST+" "+SELECTORS_LIST_SELECTED).data("quizid")},initEvents=function(root,uniqid){$(root).find(SELECTORS_COURSE_LIST).on("change",(function(){!function(root,uniqid){var courseId=getSelectedCourseID(root);Ajax.call([{methodname:"local_edwiserpagebuilder_remuiblck_action",args:{action:"get_quizzes_of_course",config:JSON.stringify({courseid:courseId})}}])[0].done((function(response){response=JSON.parse(response),response=Object.values(response);for(var option="",i=0;i<response.length;i++)option=(option=option+"<option data-id='"+response[i].courseid+"' data-quizid='"+response[i].quizid+"'>")+response[i].quizname+"</option>";$(root).find(SELECTORS_QUIZ_LIST).empty().append(option),createBarChart(root,uniqid)})).fail((function(){$(root).find(SELECTORS_CHART_AREA).hide(),$(root).find(SELECTORS_ERROR).show()}))}(root,uniqid)})),$(root).find(SELECTORS_QUIZ_LIST).on("change",(function(){createBarChart(root,uniqid)}))};return{init:function(root,uniqid){$(document).ready((async function(){!async function(){await Str.get_strings(strings).then((function(results){return results,results}))}(),initEvents(root,uniqid),$(root).find(SELECTORS_CHART).length&&createBarChart(root,uniqid)}))}}}));

//# sourceMappingURL=quizstats.min.js.map