/**
 * Main js for template importer
 *
 * @module     local/edwisersiteimporter
 * @author     Yogesh Shirsath
 * @copyright  (c) 2020 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_edwisersiteimporter/main",["jquery","core/modal_factory","core/modal_events","core/fragment","core/templates","core/notification","core/ajax","core/modal_save_cancel"],(function($,ModalFactory,ModalEvents,Fragment,Templates,Notification,Ajax){let PROMISES_refresh_templates=function(){return Ajax.call([{methodname:"local_edwisersiteimporter_refresh_templates",args:{}}])[0]},loaded=!1;function initTemplateChooser(){$(".view-template").on("click",(function(event){var _this=this;event.preventDefault();var type=$(this).data("type");return Templates.render("local_edwisersiteimporter/"+type+"_modal",$(this).data()).done((function(html,js){!function(element,html,js){var type=$(element).data("type");require(["local_edwisersiteimporter/"+type],(function(template){ModalFactory.create({title:M.util.get_string("import"+type,"local_edwisersiteimporter"),type:ModalFactory.types.SAVE_CANCEL},$("#create")).done((function(modal){Templates.replaceNodeContents(modal.body,html,js),modal.show(),modal.setSaveButtonText(M.util.get_string("import","local_edwisersiteimporter")),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),template.importTemplate($(element).data(),modal)})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()}))}))}))}(_this,html,js)})).fail(Notification.exception),!1}))}function loadView(){1!=loaded&&($("#edwisersiteimporter .templates-list").hide(),$("#edwisersiteimporter .loader-wrapper").show(),Fragment.loadFragment("local_edwisersiteimporter","load_view",contextid,{}).done((function(html,js){Templates.replaceNodeContents("#edwisersiteimporter .templates-list",html,js),$("#edwisersiteimporter .loader-wrapper").hide(),$("#edwisersiteimporter .templates-list").show(),loaded=!0})).fail(Notification.exception))}return{init:function(root){initTemplateChooser(),function(root){$(root+" .nav-tabs a").on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$(root+" #refresh-templates").on("click",(function(){PROMISES_refresh_templates().done((function(status){status&&(loaded=!1,loadView())})).fail(Notification.exception)}))}(root)},initLoader:function(){$(document).ready((function(){$('[href="#edwisersiteimporter"]').on("click",(function(){loadView()})),$('[href="#edwisersiteimporter"]').is(".active")&&loadView()}))}}}));

//# sourceMappingURL=main.min.js.map