var lang_locale="",lang=document.getElementsByTagName("html")[0].getAttribute("lang");""!=lang&&"en"!=lang&&"en-us"!=lang&&(lang_locale="local_people/"+lang),define(["jquery","core/ajax","core/notification","theme_remui/select2",lang_locale,"theme_remui/bootbox","theme_remui/notify","core/modal_factory","local_people/bootstrap-datetimepicker","core/modal_events","core/str"],function(e,t,n,a,o,i,c,s,r,l,d){function u(){if(""==e("#selectcourses").val())return e("span.select2-selection.select2-selection--multiple").css("border","1px solid red"),!1}function f(e,t,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="expires="+a.toUTCString();document.cookie=e+"="+t+"; "+o}function m(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}return{init:function(a){e(document).on("click",".enroll",function(e){return e.preventDefault(),u()}),e(document).on("submit","#EnrolForm",function(e){return u()}),e(document).ready(function(){e('.filterslist .panel-heading a[data-toggle="collapse"]').on("click",function(){e('.filterslist .panel-heading a[data-toggle="collapse"]').removeClass("active"),e(this).addClass("active")}),e("#form-suspended .form-radio").click(function(){e("#form-suspended .form-radio label").removeClass("form-radio-inactive")}),e("#form-confirmed .form-radio").click(function(){e("#form-confirmed .form-radio label").removeClass("form-radio-inactive")});e("#message_bulk_container").html();e("#btn_invite_user").click(function(t){t.preventDefault(),t.stopPropagation(),i.dialog({message:M.util.get_string("invite_message","local_people")+" "+e(".custom-search-form #txt").attr("value")+" ?",title:M.util.get_string("invite_title","local_people"),buttons:{success:{label:M.util.get_string("send_invite","local_people"),className:"btn btn-round btn-primary",callback:function(){e.post("invite_people.php",{email:e(".custom-search-form #txt").attr("value")}).done(function(t){1==jQuery.parseJSON(t).status?e.notify(M.util.get_string("invitation_sent","local_people"),{className:"success",autoHideDelay:3e3}):e.notify(M.util.get_string("invite_error","local_people"),{className:"error",autoHideDelay:3e3})})}}}})}),e("form[id^=form-]").submit(function(e){event.preventDefault(),event.stopPropagation(),u(e)}),e("#id_userperpage").change(function(){e(this).parents("form:first").submit()});var o=[];if(m("selected_bulks"))o=e.parseJSON(m("selected_bulks"));function c(e,t){var n=window.location.href,a=location.hash;if((n=n.replace(a,"")).indexOf(e+"=")>=0){var o=n.substring(0,n.indexOf(e)),i=n.substring(n.indexOf(e));n=o+e+"="+t+(i=(i=i.substring(i.indexOf("=")+1)).indexOf("&")>=0?i.substring(i.indexOf("&")):"")}else n.indexOf("?")<0?n+="?"+e+"="+t:n+="&"+e+"="+t;return n+a}e(".chosen-people").select2(),e("#form-firstaccessd .form-checkbox").click(function(t){var n=e(this).find("input[name=neveraccess]");n.is(":checked")?n.parent().addClass("active"):n.parent().removeClass("active")}),e("#form-lastaccessed .form-checkbox").click(function(t){var n=e(this).find("input[name=neveraccess]");n.is(":checked")?n.parent().addClass("active"):n.parent().removeClass("active")}),e("#lastaccessid").click(function(){if(e(this).is(":checked")){var t=new Date,n=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear();e("#lastaccessedgt").val(n),e("#lastaccessedlt").val(n)}else e("#lastaccessedgt").val(""),e("#lastaccessedlt").val("")}),e("#form-lastmodified .form-checkbox").click(function(t){var n=e(this).find("input[name=nevermodified]");n.is(":checked")?n.parent().addClass("active"):n.parent().removeClass("active")}),e("#menucompany").change(function(){if(window.history.pushState("object","title",c("company",this.value)),0!=e(document).find(".reset").length){var t=e(document).find("a.reset").closest(".panel").find("form"),n=t.find(".btn").attr("value"),a=t.find(".btn").attr("name");e("<input>").attr({name:a,value:n,type:"hidden"}).appendTo(t),t.get(0).submit()}else window.location.href=c("company",this.value)}),e("#accordion form").click(function(e){window.history.pushState("object","title",c("page","0"))});var r=function(t){t.preventDefault(),window.history.pushState("object","title",c("search",e("#txt").val())),window.location.href=c("search",e("#txt").val())};e("#txt").keypress(function(e){13==e.which&&r(e)}),e("#txt").on("input",function(t){""!=e.trim(e(this).val())?(e("#searchbutton i").addClass("fa-close"),e("#searchbutton").css("cursor","pointer"),e("#searchbutton").removeClass("hidden"),e("#searchbutton").addClass("d-block")):(e("#searchbutton i").removeClass("fa-close"),e("#searchbutton").removeClass("d-block"),e("#searchbutton").addClass("hidden"),e("#searchbutton").css("cursor","default"))}),e("#search-icon").click(function(e){r(e)}),e("#searchbutton").click(function(t){e("i",this).hasClass("fa-close")&&(e("#txt").val(""),e("#searchbutton i").removeClass("fa-close"),e("#searchbutton").removeClass("d-block"),e("#searchbutton").addClass("hidden"),e("#searchbutton").css("cursor","default"),function(e){var t,n,a=decodeURIComponent(window.location.search.substring(1)).split("&");for(n=0;n<a.length;n++)if((t=a[n].split("="))[0]===e)return void 0===t[1]||t[1]}("search")&&r(t))});var u=function(t){if(t.preventDefault(),!function(){e.each(["firstaccessd","lastaccessed","lastmodified"],function(t,n){e("#form-"+n+" .filter-true").length&&e("#form-"+n).closest(".filterslist")}),e("#form-courserole .filter-true").length;return!0}())return!1;var n={},a={},o=e("form"),i=null,c=null;new Array;o.each(function(){n={},e("input, select",this).each(function(){(c=e(this).closest("form").attr("id"))&&c.indexOf("form-")>-1&&(i=e(this)[0].name,e(this).is(":checkbox")||e(this).is(":radio")?e(this).prop("checked")&&(n[i]=!!e(this).prop("checked")||""):n[i]=e(this).val())}),(c&&c.indexOf("form-")>-1||e(".filter-true",this).length)&&(a[c]=n)}),data=JSON.stringify(a),e("<form method='post'>").append(e('<input type="hidden" name="filters" id="data">').val(data)).appendTo("body").submit()};e("#send, #send-footer").click(function(e){return e.preventDefault(),e.stopPropagation(),u(e)}),e(".report-left-block-acordeon.col-md-3").keypress(function(e){"13"==e.which&&u(e)});var h=function(t){t.preventDefault();var n=e(this).closest("form"),a=e("<input>").attr("type","hidden").attr("class","filter-true").val("true");if(a.attr("name","filter-true"),e(n).append(a),function(t){if("form-courserole"==e(t).closest("form").attr("id"))return!1;var n=e(t).closest(".panel");if(e(".form-checkbox",n).length&&e(t).attr("name").match(/^never.*/)&&null==e(t).attr("checked"))return!0;if(""==e.trim(e(t).val()))return!0;return!1}(this))p(this,t);else{var o=e(this).closest(".filterslist"),i=d.get_string("clear","local_people"),c="";e.when(i).done(function(t){e(".reset",o).remove(),c=e("<a>").attr("class","reset").text(t),e(".panel-body div.clr_button",o).append(c),e(".reset",o).click(function(t){var n,a=function(e,t){var n=0,a=!1;do{1==e.hasClass(t)?a=!0:(n++,e.parent()&&(e=e.parent()))}while(n<7&&0==a);return 1==a&&e}(e(this),"filterslist");0!=a&&((n=a).find("input[type=text], textarea").val(""),n.find("select").val("").trigger("select2:updated"),n.find("form[id^='form-'] .date input").val(""),n.find("small.help-block").hide(),n.find("form[id^='form-'] input[name^='never']").removeAttr("checked"),n.find("form[id^='form-'] input[name^='never']").closest("label").removeClass("active"),n.find(".has-error").removeClass("has-error"),n.find(".has-success").removeClass("has-success"),n.find(".form-control-feedback").remove(),n.find(".form-check").removeClass("active"),n.find(".form-check input:radio").prop("checked",!1))}),e(".suspend-form .reset").click(function(t){e(".suspend-form .form-radio label").addClass("form-radio-inactive"),e(".suspend-form .filter-true").remove(),p(this,t)}),e(".confirm-form .reset").click(function(t){e(".confirm-form .form-radio label").addClass("form-radio-inactive"),e(".confirm-form .filter-true").remove(),p(this,t)}),e(".select-city .reset").click(function(){e(".select-city .custom-select").select2("val","All")}),e(".select-country .reset").click(function(){e(".select-country .custom-select").select2("val","All")}),e(".select-course .reset").click(function(){e(".select-course .custom-select").select2("val","All")})})}};function p(t,n){var a=n.currentTarget.id,o=e(t).closest(".filterslist");e("input:radio[name='suspended']").each(function(e){this.checked=!1}),e("#confirmed").each(function(e){this.checked=!1}),"reset-form"==a&&(o=e(t).closest("#SearchParameters")),e(".reset",o).remove(),e(".filter-true",o).remove(),e("input[type=text], textarea",o).val(""),e("select",o).val("").trigger("select2:updated"),e("form[id^='form-'] .date input",o).val(""),e("small.help-block",o).hide(),e("form[id^='form-'] input[name^='never']",o).removeAttr("checked"),e("form[id^='form-'] input[name^='never']",o).closest("label").removeClass("active"),e("form[id^='form-'] input[name^='confirmed']",o).removeAttr("checked"),e("form[id^='form-'] input[name^='unconfirmed']",o).removeAttr("checked"),e("form[id^='form-'] input[name^='suspended']",o).removeAttr("checked"),e("form[id^='form-'] input[name^='unsuspended']",o).removeAttr("checked"),e(o).find(".has-error").removeClass("has-error"),e(o).find(".has-success").removeClass("has-success"),e(o).find(".form-control-feedback").remove()}e("form[id^='form-'] input[name^='never']").change(h),e("form[id^='form-'] input:radio").change(h),e("form[id^='form-'] input[name$='t'], form[id^='form-'] select").change(h),e("form[id^='form-'] input, form[id^='form-'] select").on("input",h),e("#reset-form").click(function(t){p(this,t),e("#send").click()}),e("a.reset",this).click(function(t){p(this,t),e("#send").click()}),e("a.reset").click(function(e){e.preventDefault()}),e("div.reset").click(function(t){e("#form-bulk-actions input:checkbox").prop("checked",!1),t.preventDefault(),e("#send").click();var n=e(this).closest("div.btn-primary").data("name");e("#form-"+n).closest(".filterslist").find(".panel-body .reset").click()}),e("form[id^='form-'] input[name^='never']").change(function(t){var n="#"+e(this).closest("form").attr("id");e("form[id^='form-'] .date input").val(""),e(n+" input[name^='never']").is(":checked")||(e(n).find(".has-error").removeClass("has-error"),e(n).find(".has-success").removeClass("has-success"),e(n).find(".form-control-feedback").remove())}),e("form[id^='form-'] .date input").change(function(){var t="#"+e(this).closest("form").attr("id");e(t+" input[name^='never']").removeAttr("checked"),e(t+" input[name^='never']").closest("label").removeClass("active")}),e(".btn-bulk-action").click(function(a){if("enrol_user"==e(this).attr("id"))return!1;a.preventDefault();var o=[],i=e(this).data("action");if(e("input[name^=id]:checked:enabled").each(function(){o.push(e(this).val())}),o.length>0)if(f("selected_bulks",[],1),e(this).data("showmodal")){var c=e("#modal-bulk-action"),r="",u=i,m=!0,h="",p="";t.call([{methodname:"local_people_get_people",args:{form:i,message:"na",q:!1,title:"na",user:JSON.stringify(o),getter:!0,action:"na",modaldata:"na"}}])[0].done(function(a){var f=JSON.parse(JSON.stringify(a));r=f.form,u=f.title,f.q||(m=f.q,h=f.message);var v=d.get_string("choose","core");e.when(v).done(function(e){e}),m?(console.log(),s.create({type:s.types.SAVE_CANCEL,title:u,body:r,large:!0},c).done(function(a){switch(a.show(),i){case"cohortadd":p="#frmcohortsadd #cohortlist";break;case"message":e("#message_bulk_container").appendTo(".modal-dialog .modal-body"),e(".modal-dialog .modal-body").find("form").removeClass("hidden"),e('.modal-dialog .modal-body form input[name="users"]').val(o.join(",")),p=".modal-dialog .modal-body #id_messagebody"}a.getRoot().on(l.save,function(c){var s="error",r="";if(c.preventDefault(),e(p).length>0&&""!=e(p).val()){t.call([{methodname:"local_people_get_people",args:{form:"na",message:"na",q:!1,title:"na",user:"na",getter:!1,action:i,modaldata:JSON.stringify({users:o,input_value:e(p).val()})}}])[0].done(function(t){var n=JSON.parse(JSON.stringify(t));if(s=n.error?"":"success",e.trim(n))r=n.message;else{var a=d.get_string("success_message_users","local_people");e.when(a).done(function(t){e.notify(t,"success")})}}).fail(function(e){n.exception}),e.notify(r,s)}else{var l=d.get_string("warning_fields","local_people");e.when(l).done(function(t){e.notify(t,"error")})}a.hide()})})):e.notify(h,"error")}).fail(function(e){n.exception})}else{var v=JSON.stringify({name:i,data:o});e("<form method='post'>").append(e('<input type="hidden" name="bulk_action" id="data">').val(v)).appendTo("body").submit()}}),e(".btn-bulk-suspend_unsuspend").click(function(t){t.preventDefault();var n=[],a=e(this).data("action");if(e("input[name^=id]:checked:enabled").each(function(){n.push(e(this).val())}),n.length>0){f("selected_bulks",[],1);var o=JSON.stringify({name:"suspend_unsuspend",data:n}),i=e("<form method='post' action='"+M.cfg.wwwroot+"/local/people/actions/user_bulk_suspend_unsuspend.php'>").append(e('<input type="hidden" name="bulk_action" id="data">').val(o));i.append(e('<input type="hidden" name="'+a+'">').val(1)),i.append(e('<input type="hidden" name="sesskey">').val(M.cfg.sesskey)),i.appendTo("body").submit()}}),e("input:radio[name='unsuspended']").click(function(){this.checked=!0,e("input:radio[name='suspended']").each(function(e){this.checked=!1})}),e("input:radio[name='suspended']").click(function(){this.checked=!0,e("input:radio[name='unsuspended']").each(function(e){this.checked=!1})}),e("label[for='unconfirmed']").click(function(){this.checked=!0,e("#confirmed").each(function(e){this.checked=!1})}),e("label[for='confirmed']").click(function(){this.checked=!0,e("#unconfirmed").each(function(e){this.checked=!1})}),e("#enrol_user").click(function(t){var n=[];if(e("input[name^=id]:checked:enabled").each(function(){n.push(e(this).val())}),!(n.length<=0)){var o=e("#enrollModal");s.create({title:a.title,body:a.body,footer:a.footer},o).done(function(t){t.show();var n={icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-screenshot",clear:"fa fa-trash",close:"fa fa-remove"},format:"MM/DD/YYYY"};e("#EnrolForm #selectcourses").select2({width:"50%"}),e("#EnrolForm #startdate").datetimepicker(n),e("#EnrolForm #enddate").datetimepicker(n),$("#clearstartdate").click(function(){$("#startdate").val("")}),$("#clearenddate").click(function(){$("#enddate").val("")});e("#EnrolForm #selectroles").select2({width:"50%"});var a=[];e('form#EnrolForm input[name^="id"]').remove(),e("input[name^=id]:checked:enabled").each(function(){a.push(e(this).val())}),a.length>0&&(f("selected_bulks",[],1),e.each(a,function(t,n){e("form#EnrolForm").append('<input type="hidden" name="id[]" value="'+n+'" />')})),e("button#enroll").click(function(){e("form#EnrolForm").submit()})})}}),e("#form-bulk-actions input:checkbox").eq(0).attr("value","0"),e("#bulk-select-all").click(function(){if(document.getElementById("bulk-select-all").checked)e("#form-bulk-actions input:checkbox").attr("checked","checked"),e("#form-bulk-actions input:checkbox").prop("checked",!0),e("#form-bulk-actions tbody tr").addClass("table-active"),e("#form-bulk-actions label.form-checkbox").each(function(t){-1==e.inArray(e("input",this).val(),o)&&null!=e("input",this).val()&&o.push(e("input[name^=id]:enabled",this).val())});else{e("#form-bulk-actions input:checkbox").removeAttr("checked"),e("#form-bulk-actions input:checkbox").prop("checked",!1),e("#form-bulk-actions tbody tr").removeClass("table-active");e("input[name^=id]:enabled",this).val();e("#form-bulk-actions label.form-checkbox").each(function(t){var n=e("input[name^=id]:enabled",this).val();o=e.grep(o,function(e){return e!=n})})}f("selected_bulks",JSON.stringify(o),1)});var v=e("#show_tenat_company_val").val();1==v?(e("#show_tenat_company").prop("checked",!0),e("td:nth-child(7),th:nth-child(7)").show()):0==v&&(e("#show_tenat_company").prop("checked",!1),e("td:nth-child(7),th:nth-child(7)").hide()),e("#show_tenat_company").click(function(){M.cfg.wwwroot,M.cfg.sesskey;e("#show_tenat_company").is(":checked")?t.call([{methodname:"local_people_get_local_people",args:{tenant_val:1,activity:"na",status:"na",message:"na"}}])[0].done(function(t){e("td:nth-child(7),th:nth-child(7)").show()}).fail(function(e){n.exception}):t.call([{methodname:"local_people_get_local_people",args:{tenant_val:0,activity:"na",status:"na",message:"na"}}])[0].done(function(t){e("td:nth-child(7),th:nth-child(7)").hide()}).fail(function(e){n.exception})}),e("#bulk-select-all").click(function(){var t=e('#form-bulk-actions input[checked="checked"]').length>1;k(t)});var k=function(t){e(["delete","download","message","cohortadd","suspend","unlock"]).each(function(n,a){t?(e('#enrol_user, a[data-action="'+a+'"]').css("opacity","1"),e('#enrol_user, a[data-action="'+a+'"]').css("cursor","pointer"),e('#enrol_user, a[data-action="'+a+'"]').addClass("active-bulk"),e('#enrol_user, a[data-action="'+a+'"]').find(".add-tooltip").tooltip("enable"),e("#enrol_user").attr("data-target","#enrollModal")):(e('#enrol_user, a[data-action="'+a+'"]').css("opacity","0.3"),e('#enrol_user, a[data-action="'+a+'"]').css("cursor","default"),e('#enrol_user, a[data-action="'+a+'"]').removeClass("active-bulk"),e('#enrol_user, a[data-action="'+a+'"]').find(".add-tooltip").tooltip("disable"),e("#enrol_user").attr("data-target",""))})};e("#form-bulk-actions input").change(function(t){var n=e("#form-bulk-actions input:checked").length>0;k(n),e(this).closest("tr").hasClass("table-active")?e(this).closest("tr").removeClass("table-active"):e(this).closest("tr").addClass("table-active")});var b=parseInt(e(".table-people input:checked").length)>0;k(b),e("#form-bulk-actions .form-checkbox").change(function(t){if(e("input[name^=id]:checked:enabled",this).val())-1==e.inArray(e("input",this).val(),o)&&o.push(e("input[name^=id]:checked:enabled",this).val());else{var n=e("input[name^=id]:enabled",this).val();o=e.grep(o,function(e){return e!=n})}f("selected_bulks",JSON.stringify(o),1)}),e("#form-bulk-actions label.form-checkbox").each(function(t){-1!==e.inArray(e("input",this).val(),o)&&e(this).click()}),e("input:radio").click(function(){var t=e(this).parent();t.hasClass("active")||t.addClass("active")}),e(".filter-true").each(function(){var t=e(this).closest("form").attr("id");if(""!=t){var n=e("#"+t).closest("div.panel-collapse").attr("id");e("#"+n).addClass("show")}})})}}});