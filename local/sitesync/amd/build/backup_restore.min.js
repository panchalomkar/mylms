/**
 * @module     local_sitesync/backup_restore
 * @copyright (c) 2020 WisdmLabs (https://wisdmlabs.com/)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_sitesync/backup_restore",["jquery","core/ajax","local_sitesync/main"],(function($,ajax,Syncnmain){var SELECTORS_RESTORE_BACKUP="#restorebackup",SELECTORS_BACKUP_MODAL_NOTIFICATIN_WRAPPER="#backupModal .notification-wrapper",SELECTORS_BACKUP_MODAL="#backupModal",SELECTORS_BACKUP_DATA_CONTINAER=".backupdatacontainer",currentversion=!1;const registerEvents=()=>{$(SELECTORS_BACKUP_MODAL).on("show.bs.modal",(function(event){var version=$(event.relatedTarget).attr("data-version");currentversion=version;const lastVersion=$(SELECTORS_BACKUP_DATA_CONTINAER).last().data("version-content");var backup=$("".concat(SELECTORS_BACKUP_DATA_CONTINAER,'[data-version-content="').concat(version,'"]')).html(),modal=$(this);modal.find("#modalVersion").text("Version: "+version),modal.find("#modalBackupContent").html(backup),lastVersion==currentversion?$(SELECTORS_RESTORE_BACKUP).attr("disabled","disabled"):$(SELECTORS_RESTORE_BACKUP).removeAttr("disabled")})),$(document).on("click",SELECTORS_RESTORE_BACKUP,(async function(){$(this).attr("disabled","disabled");let alerthtml=Syncnmain.alerthtml(M.util.get_string("restoreinprogress","local_sitesync"),"warning");if($(SELECTORS_BACKUP_MODAL_NOTIFICATIN_WRAPPER).empty().append(alerthtml),currentversion){let args={action:"restore_backup",config:JSON.stringify({restoreconfig:currentversion,pluginname:"theme_remui"})},response=await trigger_backup(args);if(response=JSON.parse(response),response){let alerthtml=Syncnmain.alerthtml(M.util.get_string("restorecompleted","local_sitesync"),"success");$(SELECTORS_BACKUP_MODAL_NOTIFICATIN_WRAPPER).empty().append(alerthtml),setTimeout((()=>{window.location.reload()}),300)}}}))},trigger_backup=async args=>{const request={methodname:"local_sitesync_do_sync_action",args:args};return await ajax.call([request])[0]};return{init:()=>{registerEvents()}}}));

//# sourceMappingURL=backup_restore.min.js.map