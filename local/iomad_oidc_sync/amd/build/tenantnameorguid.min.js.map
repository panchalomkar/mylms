{"version":3,"file":"tenantnameorguid.min.js","sources":["../src/tenantnameorguid.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * local_iomad_oidc_sync tenantnameorguid Modal form.\n *\n * @module     local_iomad_oidc_sync\n * @copyright  2024 E-Learn Design\n * @author     Derick Turner\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport {add as toastAdd, addToastRegion} from 'core/toast';\nimport {\n    exception as displayException,\n} from 'core/notification';\nconst selectors = {\n    showTenantorguidform: '[data-action=\"show-tenantorguidform\"]',\n};\n\nexport const init = () => {\n    const showTenantorguidform = document.querySelectorAll(selectors.showTenantorguidform);\n    if (showTenantorguidform === null) {\n        return;\n    }\n\n    for (let i = 0; i < showTenantorguidform.length; i++) {\n        showTenantorguidform[i].addEventListener('click', event => {\n            event.preventDefault();\n\n            const title = getString('settenantnameorguid', 'local_iomad_oidc_sync');\n            const form = new ModalForm({\n                formClass: 'local_iomad_oidc_sync\\\\form\\\\tenantnameorguid',\n                args: {companyid: showTenantorguidform[i].getAttribute('data-companyid')},\n                modalConfig: {title},\n                returnFocus: showTenantorguidform[i],\n            });\n            form.show().then(() => {\n                addToastRegion(form.modal.getRoot()[0]);\n                return true;\n            }).catch(displayException);\n            form.addEventListener(form.events.FORM_SUBMITTED, (e) => {\n\n                // Remove toast region as if not it will be displayed on the closed modal.\n                const modalElement = form.modal.getRoot()[0];\n                const regions = modalElement.querySelectorAll('.toast-wrapper');\n                regions.forEach((reg) => reg.remove());\n                if (e.detail.result) {\n                    if (e.detail.returnmessage != '') {\n                        toastAdd(getString('tenantnameorguid_changed_warning', 'local_iomad_oidc_sync'),\n                            {\n                                type: 'warning',\n                            }\n                        );\n                    } else {\n                        toastAdd(getString('tenantnameorguid_changed_success', 'local_iomad_oidc_sync'),\n                        {\n                            type: 'success',\n                        });\n                    }\n\n                    //Replace the string in the admin approve link\n                    if (e.detail.tenantnameorguid != e.detail.oldname) {\n                        var companyID = e.detail.companyid;\n                        var approveLink = document.querySelector('[data-approvelink' +\n                                                                 companyID +\n                                                                 '=\"' +\n                                                                 companyID +\n                                                                 '\"]');\n\n                        // Get the new URL text.\n                        var newapprovalURL = approveLink.getAttribute('href').replace(e.detail.oldname, e.detail.tenantnameorguid);\n\n                        // Set it.\n                        approveLink.setAttribute('href', newapprovalURL);\n\n                        // Remove the style preventing clicking on it.\n                        approveLink.setAttribute('style', '');\n\n                        // Un-dim the link icon.\n                        var iconLink = approveLink.innerHTML;\n                        var newiconClass = iconLink.replace('dimmed_text', '');\n                        approveLink.innerHTML = newiconClass;\n\n                        // Change the tick to a cross.\n                        var approveIcon = document.querySelector('[data-approveicon' +\n                                                                 companyID +\n                                                                 '=\"' +\n                                                                 companyID +\n                                                                 '\"]');\n                        var newapproveIconLink = approveIcon.getAttribute('src').replace('yes', 'no');\n                        approveIcon.setAttribute('src', newapproveIconLink);\n\n                        getString('no')\n                           .then((noString) => {\n                               approveIcon.setAttribute('alt', noString);\n                               approveIcon.setAttribute('title', noString);\n                            })\n                           .catch();\n\n                        // Change the slider to off.\n                        var enableIcon = document.querySelector('[data-enableicon' +\n                                                                 companyID +\n                                                                 '=\"' +\n                                                                 companyID +\n                                                                 '\"]');\n                        enableIcon.setAttribute('class', 'icon fa fa-toggle-off fa-fw  dimmed_text');\n\n                        getString('enable')\n                           .then((enableString) => {\n                               enableIcon.setAttribute('alt', enableString);\n                               enableIcon.setAttribute('title', enableString);\n                            })\n                           .catch();\n\n                        var enableLink = document.querySelector('[data-enablelink' +\n                                                                 companyID +\n                                                                 '=\"' +\n                                                                 companyID +\n                                                                 '\"]');\n                        enableLink.setAttribute('style', 'pointer-events:none;');\n\n                    }\n                }\n            });\n        });\n    }\n};"],"names":["e","_modalform","__esModule","default","selectors","_exports","init","showTenantorguidform","document","querySelectorAll","i","length","addEventListener","event","preventDefault","title","getString","form","ModalForm","formClass","args","companyid","getAttribute","modalConfig","returnFocus","show","then","addToastRegion","modal","getRoot","catch","displayException","events","FORM_SUBMITTED","forEach","reg","remove","detail","result","returnmessage","toastAdd","type","tenantnameorguid","oldname","companyID","approveLink","querySelector","newapprovalURL","replace","setAttribute","newiconClass","innerHTML","approveIcon","newapproveIconLink","noString","enableIcon","enableString"],"mappings":"uLAwB4C,IAAAA;;;;;;;;kFAA5CC,YAA4CD,EAA5CC,aAA4CD,EAAAE,WAAAF,EAAAG,CAAAA,QAAAH,GAM5C,MAAMI,+BACoB,wCA8GxBC,SAAAC,KA3GkBA,KAChB,MAAMC,qBAAuBC,SAASC,iBAAiBL,gCACvD,GAA6B,OAAzBG,qBAIJ,IAAK,IAAIG,EAAI,EAAGA,EAAIH,qBAAqBI,OAAQD,IAC7CH,qBAAqBG,GAAGE,iBAAiB,SAASC,QAC9CA,MAAMC,iBAEN,MAAMC,OAAQ,EAAAC,KAAAA,YAAU,sBAAuB,yBACzCC,KAAO,IAAIC,WAAAA,QAAU,CACvBC,UAAW,gDACXC,KAAM,CAACC,UAAWd,qBAAqBG,GAAGY,aAAa,mBACvDC,YAAa,CAACR,aACdS,YAAajB,qBAAqBG,KAEtCO,KAAKQ,OAAOC,MAAK,MACb,EAAAC,OAAcA,gBAACV,KAAKW,MAAMC,UAAU,KAC7B,KACRC,MAAMC,yBACTd,KAAKL,iBAAiBK,KAAKe,OAAOC,gBAAiBjC,IAM/C,GAHqBiB,KAAKW,MAAMC,UAAU,GACbpB,iBAAiB,kBACtCyB,SAASC,KAAQA,IAAIC,WACzBpC,EAAEqC,OAAOC,SACqB,IAA1BtC,EAAEqC,OAAOE,eACT,EAAAC,OAAAA,MAAS,EAAAxB,KAAAA,YAAU,mCAAoC,yBACnD,CACIyB,KAAM,aAId,EAAAD,OAAAA,MAAS,EAAAxB,KAAAA,YAAU,mCAAoC,yBACvD,CACIyB,KAAM,YAKVzC,EAAEqC,OAAOK,kBAAoB1C,EAAEqC,OAAOM,SAAS,CAC/C,IAAIC,UAAY5C,EAAEqC,OAAOhB,UACrBwB,YAAcrC,SAASsC,cAAc,oBACAF,UACA,KACAA,UACA,MAGrCG,eAAiBF,YAAYvB,aAAa,QAAQ0B,QAAQhD,EAAEqC,OAAOM,QAAS3C,EAAEqC,OAAOK,kBAGzFG,YAAYI,aAAa,OAAQF,gBAGjCF,YAAYI,aAAa,QAAS,IAGlC,IACIC,aADWL,YAAYM,UACCH,QAAQ,cAAe,IACnDH,YAAYM,UAAYD,aAGxB,IAAIE,YAAc5C,SAASsC,cAAc,oBACAF,UACA,KACAA,UACA,MACrCS,mBAAqBD,YAAY9B,aAAa,OAAO0B,QAAQ,MAAO,MACxEI,YAAYH,aAAa,MAAOI,qBAEhC,EAAArC,KAAAA,YAAU,MACNU,MAAM4B,WACHF,YAAYH,aAAa,MAAOK,UAChCF,YAAYH,aAAa,QAASK,SAAS,IAE9CxB,QAGJ,IAAIyB,WAAa/C,SAASsC,cAAc,mBACCF,UACA,KACAA,UACA,MACzCW,WAAWN,aAAa,QAAS,6CAEjC,EAAAjC,KAAAA,YAAU,UACNU,MAAM8B,eACHD,WAAWN,aAAa,MAAOO,cAC/BD,WAAWN,aAAa,QAASO,aAAa,IAEjD1B,QAEatB,SAASsC,cAAc,mBACCF,UACA,KACAA,UACA,MAC9BK,aAAa,QAAS,uBAErC,CACJ,GACF,GAEV,CACF"}