define(["jquery","core/str"],function(f,t){t.get_strings([{key:"error:sessionstartafterend",component:"ilt"}]);return{init:function(){f(document).ready(function(){if(f("#id_sessionlocation").on("change",function(){var t=f(this).val();t?f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"location="+t,success:function(t){f("#id_classroom").html(t)}}):(f("#id_sessionlocation").html('<option value="">Select Location</option>'),f("#id_sessioncapacity").val("Classroom Capacity"))}),f("#id_classroom").on("change",function(){var t=f(this).val();t?f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"classroom="+t,success:function(t){f("#id_sessioncapacity").val(t)}}):(f("#id_classroom").html('<option value="">Select Classroom</option>'),f("#id_sessioncapacity").html("Classroom Capacity"));var e=f(this).val();e?f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"classroomres="+e,success:function(t){f("#id_sessionresource").html(t)}}):(f("#id_classroom").html('<option value="">Select Classroom</option>'),f("#id_sessioncapacity").html("Classroom Capacity"))}),"1"!=f("#allowoverbook").val()){var t=f("#sessionid").val();f("#addselect").on("change",function(){f(this).val().length;if(1==f("#removeselect option").length&&""===f.trim(f("#removeselect option").val()))var s=0;else s=f("#removeselect option").length;var a=f("#addselect option:selected").length;a&&f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"sessionids="+t,success:function(t){if(s)var e=parseInt(s)+parseInt(a);else e=s;var i=a;e>parseInt(t)&&(f(".alert-danger").fadeTo(2e3,500).slideUp(500,function(){f(".alert-danger").slideUp(500)}),f("#addselect option").prop("selected",!1)),t<i&&(f(".alert-danger").fadeTo(2e3,500).slideUp(500,function(){f(".alert-danger").slideUp(500)}),f("#addselect option:selected").prop("selected",!1))}})})}f("input:radio[id=id_allusers]").click(function(){var t=f("#id_allusers").val(),e=f("#sessionid").val();f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"coursetype="+t+"&sessionid="+e,success:function(t){f("#addselect").html(t)}})}),f("input:radio[id=id_courseusers]").click(function(){var t=f("#id_courseusers").val(),e=f("#sessionid").val(),i=f("#courseid").val();f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"coursetype="+t+"&sessionid="+e+"&courseid="+i,success:function(t){f("#addselect").html(t)}})}),f("#addselect").on("change",function(){var t=f(this).val(),e=f("#sessionid").val();f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"addselect="+t+"&current_sessionid="+e,success:function(t){t&&(f(".alert-info").html(t),f(".alert-info").fadeTo(1e3,500).slideUp(500,function(){f(".alert-info").slideUp(500),f(".alert-info").empty()}),f("#addselect option").prop("selected",!1))}})}),f("#id_sessioninstructor").on("change",function(){var t=f(this).val(),e=f("input[name=s]").val(),i=f("#id_timestart_0_hour").val(),s=f("#id_timestart_0_minute").val(),a=f("#id_timestart_0_day").val(),n=f("#id_timestart_0_month").val(),o=f("#id_timestart_0_year").val(),l=f("#id_timefinish_0_hour").val(),r=f("#id_timefinish_0_minute").val(),d=f("#id_timefinish_0_day").val(),c=n+"/"+a+"/"+o+" "+i+":"+s+":00",_=f("#id_timefinish_0_month").val()+"/"+d+"/"+f("#id_timefinish_0_year").val()+" "+l+":"+r+":00";f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"sessioninstructor="+t+"&current_session="+e+"&start="+c+"&finish="+_,success:function(t){t&&(f(".alert-danger").html(t),f(".alert-danger").fadeTo(1e3,500).slideUp(500,function(){f(".alert-danger").slideUp(500),f(".alert-danger").empty()}),f("#id_sessioninstructor option:selected").prop("selected",!1))}})}),f("#id_classroom").on("change",function(){var t=f(this).val(),e=f("#id_sessionlocation").val(),i=f("input[name=s]").val(),s=f("input[name=f]").val();if(0!=i)var a=f("input[name=s]").val();else if(0!=s)a=f("input[name=f]").val();var n=f("#id_timestart_0_hour").val(),o=f("#id_timestart_0_minute").val(),l=f("#id_timestart_0_day").val(),r=f("#id_timestart_0_month").val(),d=f("#id_timestart_0_year").val(),c=f("#id_timefinish_0_hour").val(),_=f("#id_timefinish_0_minute").val(),p=f("#id_timefinish_0_day").val(),m=r+"/"+l+"/"+d+" "+n+":"+o+":0",u=f("#id_timefinish_0_month").val()+"/"+p+"/"+f("#id_timefinish_0_year").val()+" "+c+":"+_+":0";f.ajax({type:"POST",url:"fetch_sessionlocation.php",data:"sessionlocation="+e+"&sessionclassroom="+t+"&current_session="+a+"&start="+m+"&finish="+u,success:function(t){t&&(f(".alert-info").html(t),f(".alert-info").fadeTo(1e3,500).slideUp(500,function(){f(".alert-info").slideUp(500),f(".alert-info").empty()}),f("#id_classroom option").prop("selected",!1))}})}),f("#id_date_add_fields").click(function(){f("#mform1").submit()}),f("#mform1").submit(function(t){for(var e=f("input[name*='date_repeats']").val()-1,i=0;i<=e;i++){var s=f("#id_timestart_"+i+"_hour").val(),a=f("#id_timestart_"+i+"_minute").val(),n=f("#id_timestart_"+i+"_day").val(),o=f("#id_timestart_"+i+"_month").val(),l=f("#id_timestart_"+i+"_year").val(),r=f("#id_timefinish_"+i+"_hour").val(),d=f("#id_timefinish_"+i+"_minute").val(),c=f("#id_timefinish_"+i+"_day").val(),_=f("#id_timefinish_"+i+"_month").val(),p=f("#id_timefinish_"+i+"_year").val(),m=new Date(o+"/"+n+"/"+l+" "+s+":"+a+":00");new Date(_+"/"+c+"/"+p+" "+r+":"+d+":00")<m?(f("#id_timestart_"+i+"_day").parent().parent().parent().next().html(M.util.get_string("error:sessionstartafterend","ilt")),f("#id_timestart_"+i+"_day").parent().parent().parent().next().css("display",""),f("#id_timestart_"+i+"_day").parent().parent().parent().next().css("color","#721c24"),f(window).scrollTop(0),t.preventDefault(t)):(f("#id_timestart_"+i+"_day").parent().parent().parent().next().html(""),f("#id_timestart_"+i+"_day").parent().parent().parent().next().css("display","none"))}})})}}});