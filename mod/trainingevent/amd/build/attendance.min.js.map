{"version":3,"file":"attendance.min.js","sources":["../src/attendance.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * mod_trainingevent attendance Modal form.\n *\n * @module     mod_trainingevent\n * @copyright  2024 E-Learn Design\n * @author     Derick Turner\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport {add as toastAdd, addToastRegion} from 'core/toast';\nimport {\n    exception as displayException,\n} from 'core/notification';\nconst selectors = {\n    showAttendanceform: '[data-action=\"show-Attendanceform\"]',\n};\n\nexport const init = () => {\n    const showAttendanceform = document.querySelectorAll(selectors.showAttendanceform);\n    if (showAttendanceform === null) {\n        return;\n    }\n\n    for (let i = 0; i < showAttendanceform.length; i++) {\n        showAttendanceform[i].addEventListener('click', event => {\n            event.preventDefault();\n\n            const attendanceID = showAttendanceform[i].getAttribute('data-attendanceid');\n            const waitListed = showAttendanceform[i].getAttribute('data-waitlisted');\n            const approvalType = showAttendanceform[i].getAttribute('data-approvaltype');\n            var title = getString('attend', 'trainingevent');\n            if (attendanceID != 0) {\n                if (waitListed == 0) {\n                    title = getString('updateattendance', 'trainingevent');\n                } else {\n                    title = getString('updatewaitlist', 'trainingevent');\n                }\n            } else {\n                if (waitListed == 0) {\n                    if (approvalType == 0) {\n                        title = getString('attend', 'trainingevent');\n                    } else {\n                        title = getString('request', 'trainingevent');\n                    }\n                } else {\n                    title = getString('waitlist', 'trainingevent');\n                }\n            }\n            const form = new ModalForm({\n                formClass: 'mod_trainingevent\\\\form\\\\attendance',\n                args: {companyid: showAttendanceform[i].getAttribute('data-companyid'),\n                       trainingeventid: showAttendanceform[i].getAttribute('data-trainingeventid'),\n                       cmid: showAttendanceform[i].getAttribute('data-cmid'),\n                       waitlisted: waitListed,\n                       attendanceid: attendanceID,\n                       approvaltype: approvalType,\n                       userid: showAttendanceform[i].getAttribute('data-userid'),\n                       courseid: showAttendanceform[i].getAttribute('data-courseid'),\n                       requesttype: showAttendanceform[i].getAttribute('data-requesttype'),\n                       dorefresh: showAttendanceform[i].getAttribute('data-dorefresh'),\n                       },\n                modalConfig: {title},\n                returnFocus: showAttendanceform[i],\n            });\n            form.show().then(() => {\n                addToastRegion(form.modal.getRoot()[0]);\n                return true;\n            }).catch(displayException);\n            form.addEventListener(form.events.FORM_SUBMITTED, (e) => {\n\n                // Remove toast region as if not it will be displayed on the closed modal.\n                const modalElement = form.modal.getRoot()[0];\n                const regions = modalElement.querySelectorAll('.toast-wrapper');\n                regions.forEach((reg) => reg.remove());\n                if (e.detail.result) {\n                    if (e.detail.returnmessage != '') {\n                        toastAdd(e.detail.returnmessage,\n                            {\n                                type: 'success',\n                            }\n                        );\n                    }\n                }\n                if (e.detail.dorefresh) {\n                    location.reload(false);\n                }\n\n                var userID =  e.detail.userid;\n                var bookingNotes = document.querySelector(\"[data-bookingnotesid='\" +  userID + \"']\");\n                var currentNotes = bookingNotes.getAttribute(\"data-content\");\n                var textFrom = \"<br>\" + e.detail.oldnotes + \"</div>\";\n                var textTo = \"<br>\" + e.detail.newnotes + \"</div>\";\n                bookingNotes.setAttribute(\"data-content\", currentNotes.replace(textFrom, textTo));\n            });\n        });\n    }\n};"],"names":["selectors","showAttendanceform","document","querySelectorAll","i","length","addEventListener","event","preventDefault","attendanceID","getAttribute","waitListed","approvalType","title","form","ModalForm","formClass","args","companyid","trainingeventid","cmid","waitlisted","attendanceid","approvaltype","userid","courseid","requesttype","dorefresh","modalConfig","returnFocus","show","then","modal","getRoot","catch","displayException","events","FORM_SUBMITTED","e","forEach","reg","remove","detail","result","returnmessage","type","location","reload","userID","bookingNotes","querySelector","currentNotes","textFrom","oldnotes","textTo","newnotes","setAttribute","replace"],"mappings":";;;;;;;;sJA8BMA,6BACkB,oDAGJ,WACVC,mBAAqBC,SAASC,iBAAiBH,iCAC1B,OAAvBC,uBAIC,IAAIG,EAAI,EAAGA,EAAIH,mBAAmBI,OAAQD,IAC3CH,mBAAmBG,GAAGE,iBAAiB,SAASC,QAC5CA,MAAMC,uBAEAC,aAAeR,mBAAmBG,GAAGM,aAAa,qBAClDC,WAAaV,mBAAmBG,GAAGM,aAAa,mBAChDE,aAAeX,mBAAmBG,GAAGM,aAAa,yBACpDG,OAAQ,mBAAU,SAAU,iBAGxBA,MAFY,GAAhBJ,aACkB,GAAdE,YACQ,mBAAU,mBAAoB,kBAE9B,mBAAU,iBAAkB,iBAGtB,GAAdA,WACoB,GAAhBC,cACQ,mBAAU,SAAU,kBAEpB,mBAAU,UAAW,kBAGzB,mBAAU,WAAY,uBAGhCE,KAAO,IAAIC,mBAAU,CACvBC,UAAW,sCACXC,KAAM,CAACC,UAAWjB,mBAAmBG,GAAGM,aAAa,kBAC9CS,gBAAiBlB,mBAAmBG,GAAGM,aAAa,wBACpDU,KAAMnB,mBAAmBG,GAAGM,aAAa,aACzCW,WAAYV,WACZW,aAAcb,aACdc,aAAcX,aACdY,OAAQvB,mBAAmBG,GAAGM,aAAa,eAC3Ce,SAAUxB,mBAAmBG,GAAGM,aAAa,iBAC7CgB,YAAazB,mBAAmBG,GAAGM,aAAa,oBAChDiB,UAAW1B,mBAAmBG,GAAGM,aAAa,mBAErDkB,YAAa,CAACf,MAAAA,OACdgB,YAAa5B,mBAAmBG,KAEpCU,KAAKgB,OAAOC,MAAK,+BACEjB,KAAKkB,MAAMC,UAAU,KAC7B,KACRC,MAAMC,yBACTrB,KAAKR,iBAAiBQ,KAAKsB,OAAOC,gBAAiBC,IAG1BxB,KAAKkB,MAAMC,UAAU,GACb9B,iBAAiB,kBACtCoC,SAASC,KAAQA,IAAIC,WACzBH,EAAEI,OAAOC,QACqB,IAA1BL,EAAEI,OAAOE,8BACAN,EAAEI,OAAOE,cACd,CACIC,KAAM,YAKlBP,EAAEI,OAAOf,WACTmB,SAASC,QAAO,OAGhBC,OAAUV,EAAEI,OAAOlB,OACnByB,aAAe/C,SAASgD,cAAc,yBAA4BF,OAAS,MAC3EG,aAAeF,aAAavC,aAAa,gBACzC0C,SAAW,OAASd,EAAEI,OAAOW,SAAW,SACxCC,OAAS,OAAShB,EAAEI,OAAOa,SAAW,SAC1CN,aAAaO,aAAa,eAAgBL,aAAaM,QAAQL,SAAUE"}