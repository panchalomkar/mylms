define(["jquery","core/ajax","core/notification","core/str"],(function(e,t,o,i){return{init:function(i,n,a,d,r,c,s,m){var l;no_save=!1,t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:0,countstatus:0,cmid:i,seekval:0,percentage:0,second:0,course:0,id:0}}])[0].done((function(t){var o=JSON.parse(JSON.stringify(t));l=o;var i=JSON.parse(JSON.stringify(l.last));e("video[id^=videofile-]").attr("id");i[0].second,attemptlastsid=void 0!==l.last[0].id?l.last[0].id:0,attemptcurrentsid=void 0!==l.current_id?l.current_id:0})).fail((function(e){o.exception}));var u=0,p=1,v=0,f=e("video[id^=videofile-]").attr("id");videojs(f).on("ended",(function(d){d.preventDefault();video[0].duration;clearInterval(g),video=document.getElementsByTagName("video"),percentage=100/video[0].duration*video[0].currentTime,v=void 0!==l.last?attempts[0].id:l.current_id,a<=percentage&&p?(u=1,p=0):u=1,t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:v,countstatus:u,cmid:i,seekval:0,percentage:parseInt(100),second:video[0].duration,course:n,id:0}}])[0].done((function(t){"completed"==JSON.parse(JSON.stringify(t)).status&&(e("#module-"+i).find(".autocompletion img").remove(),e("#module-"+i).find(".autocompletion").append("<img class=icon src="+m+"/theme/image.php/paradiso/core/1564492370/i/completion-manual-y>"),window.location.reload())})).fail((function(e){o.exception}))}));var g=setInterval((function(){(video=document.getElementsByTagName("video"),percentage=100/video[0].duration*video[0].currentTime,percentage>98&&(percentage=100),percentage>0)&&(a<=percentage&&p?(u=1,p=0):(u=0,u=1),t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:attemptcurrentsid,countstatus:u,cmid:i,seekval:0,percentage:parseInt(percentage),second:parseInt(video[0].currentTime),course:n,id:attemptlastsid}}])[0].done((function(t){"completed"==JSON.parse(JSON.stringify(t)).status&&(e("#module-"+i).find(".autocompletion img").remove(),e("#module-"+i).find(".autocompletion").append("<img class=icon src="+m+"/theme/image.php/paradiso/core/1564492370/i/completion-manual-y>"))})).fail((function(e){o.exception})))}),5e3);if(videojs(f).on("pause",(function(){clearInterval(g)})),videojs(f).on("play",(function(){setInterval(g)})),1==d&&(get_video=document.getElementsByTagName("video"),reseek=!0,get_video[0].onseeking=function(){0==reseek&&(no_save=!0)},get_video[0].onseeked=function(){0==reseek?reseek=!0:(seek=!0,t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:0,countstatus:0,cmid:i,seekval:get_video[0].currentTime,percentage:0,second:0,course:0,id:0}}])[0].done((function(e){no_save=!1,reseek=!1})).fail((function(e){o.exception})))}),1==r){var _=videojs(f,{plugins:{videoJsResolutionSwitcher:{default:"low",dynamicLabel:!0}}});_.ready((function(){_.updateSrc([{src:c,type:"video/mp4",label:"HD"},{src:s,type:"video/mp4",res:480,label:"SD"}]),_.on("resolutionchange",(function(){console.info("Source changed to %s",_.src())}))}))}}}}));