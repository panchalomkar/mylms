define(["jquery","core/ajax","core/notification","core/str"],function(e,t,a,n){return{init:function(n,o,r,i,c,d,s){var p;save=!1,seek_to=0;var l=document.createElement("script");function m(e){t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:0,countstatus:0,cmid:n,seekval:0,percentage:0,second:0,course:0,id:0},done:function(e){var t=JSON.parse(JSON.stringify(e));t.last.second=parseInt(t.last.second),p=t,t.last.second>0&&player.seekTo(t.last.second)},fail:a.exception}])}e(document).ready(function(){l.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(l,e)}),window.onYouTubeIframeAPIReady=function(){player=new YT.Player("plms-video",{height:c,width:i,videoId:d,events:{onReady:m,onStateChange:f}})};var u=!1;function f(i){if(i.data==YT.PlayerState.PLAYING&&i.data!=YT.PlayerState.BUFFERING&&!u){t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:0,countstatus:0,cmid:n,seekval:0,percentage:0,second:0,course:o,id:0},done:function(e){var t=JSON.parse(JSON.stringify(e));t.last.second=parseInt(t.last.second),p=t},fail:a.exception}]);var c=0,d=1;setInterval(function(){percent=parseInt(100/player.getDuration()*player.getCurrentTime()),attemptid=void 0!==p.current_id?parseInt(p.current_id):0,seconds=parseInt(player.getCurrentTime()),percent>98&&(percent=100),r<=percent&&d?(c=1,d=0):c=0,t.call([{methodname:"mod_videofile_data_for_video_attempt",args:{attempt_id:attemptid,countstatus:c,cmid:n,seekval:0,percentage:percent,second:seconds,course:o,id:p.current_id},done:function(t){"completed"==JSON.parse(JSON.stringify(t)).status&&(e("#module-"+n).find(".autocompletion img").remove(),e("#module-"+n).find(".autocompletion").append("<img class=icon src="+s+"/theme/image.php/paradiso/core/1564492370/i/completion-manual-y>"))},fail:a.exception}])},5e3),u=!0}i.data==YT.PlayerState.ENDED&&(percent=100/player.getDuration()*player.getCurrentTime(),seconds=player.getCurrentTime(),percent>98&&(player.seekTo(5),player.pauseVideo()))}}}});